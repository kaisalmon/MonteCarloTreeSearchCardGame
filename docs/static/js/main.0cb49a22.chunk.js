(this["webpackJsonpcard-game-ai"]=this["webpackJsonpcard-game-ai"]||[]).push([[0],{36:function(e,t,n){},37:function(e,t,n){},66:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(12),o=n.n(i),c=(n(36),n(7)),s=(n(37),n(4)),l=n(5),d=n(3),u=function(){function e(t,n,a){Object(s.a)(this,e),this.template=void 0,this.regex=void 0,this.slots=void 0,this.factory=void 0,this.template=n,this.regex=new RegExp("^"+n.replace(/%\w+/g,"(.+)?")+"$"),this.factory=a,this.slots=Object(d.a)(this.template.matchAll(/%(\w+)/gi)).map((function(e){return e[1]})),e.templates[t].push(this)}return Object(l.a)(e,null,[{key:"parse",value:function(t,n){var a=e.templates[t].filter((function(e){return n.toLowerCase().match(e.regex)}));if(0===a.length)throw new Error("Invalid text for slot ".concat(t,": ").concat(n));var r=[],i=a.map((function(t){try{var a=n.toLowerCase().match(t.regex),i=a?a.splice(1):[],o=t.slots.map((function(t,n){return e.parse(t,i[n])}));return t.factory.apply(t,Object(d.a)(o))}catch(c){return void r.push(c)}})).filter((function(e){return e}));if(0===i.length)throw r.length>1?new Error("Invalid text: "+n):r[0];var o=Object(c.a)(i,1)[0];if(!o)throw Error();return o}}]),e}();u.templates={Eff:[],Player:[],N:[]};var f=function(){function e(t,n){Object(s.a)(this,e),this.a=void 0,this.b=void 0,this.a=t,this.b=n}return Object(l.a)(e,[{key:"applyEffect",value:function(e,t){var n=this.a.applyEffect(e,t);return this.b.applyEffect(n,t)}}]),e}();var h=n(10),p=n(9),y=n(6),b=n(1),v=function(){function e(t,n,a){Object(s.a)(this,e),this.target=void 0,this.from=void 0,this.to=void 0,this.target=t,this.from=n,this.to=a}return Object(l.a)(e,[{key:"applyEffect",value:function(e,t){var n,a=this.target.resolvePlayerKey(e,t),r=e[a],i=Object(d.a)(r[this.from]),o=Object(d.a)(r[this.to]),c=Math.floor(Math.random()*i.length);return o.push.apply(o,Object(d.a)(i.splice(c,1))),Object(b.a)(Object(b.a)({},e),{},Object(y.a)({},a,Object(b.a)(Object(b.a)({},r),{},(n={},Object(y.a)(n,this.to,o),Object(y.a)(n,this.from,i),n))))}}]),e}(),O=function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(e){return Object(s.a)(this,n),t.call(this,e||k,"deck","hand")}return n}(v);var j=function(){function e(t,n){Object(s.a)(this,e),this.target=void 0,this.amount=void 0,this.target=t,this.amount=n}return Object(l.a)(e,[{key:"applyEffect",value:function(e,t){var n=this.target.resolvePlayerKey(e,t);return Object(b.a)(Object(b.a)({},e),{},Object(y.a)({},n,Object(b.a)(Object(b.a)({},e[n]),{},{health:e[n].health+this.amount})))}}]),e}();var m,g=n(23),w=n.n(g),k={resolvePlayerKey:function(e,t){return t}},x={resolvePlayerKey:function(e,t){return"playerOne"===t?"playerTwo":"playerOne"}},P=function(){for(var e=function(e){new u("N",w.a.toWords(e),(function(){return e})),new u("N","".concat(e),(function(){return e}))},t=0;t<25;t++)e(t);new u("Player","yourself",(function(){return k})),new u("Player","you",(function(){return k})),new u("Player","your opponent",(function(){return x})),new u("Player","the other player",(function(){return x})),new u("Eff","%Eff and %Eff",(function(e,t){return new f(e,t)})),new u("Eff","%Eff, and %Eff",(function(e,t){return new f(e,t)})),new u("Eff","%Eff, %Eff",(function(e,t){return new f(e,t)})),new u("Eff","%Eff then %Eff",(function(e,t){return new f(e,t)})),new u("Eff","%Eff, then %Eff",(function(e,t){return new f(e,t)})),new u("Eff","%Player draws? a card",(function(e){return new O(e)})),new u("Eff","draw a card",(function(){return new O})),new u("Eff","draw the top card of your deck",(function(){return new O})),new u("Eff","draw a card from your deck",(function(){return new O})),new u("Eff","discard a random card(?: from your hand)",(function(){return new v(k,"hand","discardPile")})),new u("Eff","%Player discards? a random card(?: from your hand)",(function(e){return new v(e,"hand","discardPile")})),new u("Eff","discard the top card (?:from|of) your deck",(function(){return new v(k,"deck","discardPile")})),new u("Eff","%Player discards? the top card (?:from|of) (?:their|your) deck",(function(e){return new v(e,"deck","discardPile")})),new u("Eff","deal %N damage to %Player",(function(e,t){return new j(t,-e)})),new u("Eff","remove %N damage to %Player",(function(e,t){return new j(t,e)})),new u("Eff","%Player loses? %N health",(function(e,t){return new j(e,-t)})),new u("Eff","%Player gains? %N health",(function(e,t){return new j(e,t)}))},E=function(){function e(){Object(s.a)(this,e)}return Object(l.a)(e,[{key:"preEffect",value:function(e,t,n){var a=e[n],r=Object(d.a)(a.hand);return r.splice(r.indexOf(t),1),Object(b.a)(Object(b.a)({},e),{},Object(y.a)({},n,Object(b.a)(Object(b.a)({},a),{},{hand:r})))}},{key:"postEffect",value:function(e,t,n){return Object(b.a)(Object(b.a)({},e),{},Object(y.a)({},n,Object(b.a)(Object(b.a)({},e[n]),{},{discardPile:[t].concat(Object(d.a)(e[n].discardPile))})))}},{key:"play",value:function(e,t){var n=1===e.activePlayer?"playerOne":"playerTwo",a=this.preEffect(e,t,n),r=this.applyEffect(a,n);return this.postEffect(r,t,n)}}]),e}(),N=function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(e,a,r){var i;return Object(s.a)(this,n),(i=t.call(this)).effect=void 0,i.name=void 0,i.text=void 0,i.effect=e,i.text=a,i.name=r,i}return Object(l.a)(n,[{key:"getName",value:function(){return this.name}},{key:"getText",value:function(){return this.text}},{key:"applyEffect",value:function(e,t){return this.effect.applyEffect(e,t)}}]),n}(E),M=["Deal one damage to your opponent","Deal two damage to your opponent","Deal three damage to your opponent and deal one damage to yourself","Deal one damage to yourself then draw a card","Deal one damage to yourself then draw a card","You gain one health","You gain one health and you draw a card","Your opponent discards the top card from their deck","Discard the top card from your deck, then you gain two health","Deal two damage to your opponent","Deal three damage to your opponent"],I=n(28),C=(n(29),n(8),n(11)),S=n.n(C),T=n(24);n.n(T)()();!function(e){e.IN_PLAY="IN_PLAY",e.LOSE="RED_WIN",e.WIN="BLUE_WIN",e.DRAW="DRAW"}(m||(m={}));var A=function(e){return 1===e?m.WIN:m.LOSE},D=function(){function e(){Object(s.a)(this,e),this.mood="none"}return Object(l.a)(e,[{key:"pickMove",value:function(e,t){var n=S.a.sample(e.getSensibleMoves(t));if(n)return this.mood="Sensible",n;this.mood="Not Sensible";var a=S.a.sample(e.getValidMoves(t));if(a)return a;throw new Error("No valid moves")}}]),e}(),L=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:60,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){return 0},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new D;Object(s.a)(this,e),this.mood="waiting...",this.simulationStrategy=void 0,this.samples=void 0,this.depth=void 0,this.inPlayHeuristic=void 0,this.simulationStrategy=r,this.depth=n,this.samples=t,this.inPlayHeuristic=a}return Object(l.a)(e,[{key:"pickMove",value:function(e,t){var n=this,a=e.getValidMoves(t).map((function(e){return{move:e,score:0,outOf:0,depth:0,unfinished:0}}));if(0===a.length)throw new Error("No valid moves");for(var r=A(t.activePlayer),i=0;i<this.samples;i++)a.forEach((function(a){var i=e.randomizeHiddenInfo(t),o=e.applyMove(i,a.move),c=n.simulateGame(e,o);if(a.outOf++,c.status===r)a.score++;else if(c.status!==m.DRAW&&c.status!==m.IN_PLAY)a.score--;else if(void 0!==c.heuristic){var s=1===t.activePlayer?1:-1;a.score+=c.heuristic*s,a.unfinished++}a.depth+=c.length}));var o=S.a.maxBy(a,"score"),c=o.score/o.outOf,s=a.filter((function(e){return e.score/e.outOf>c-.01}));if(c>.9){var l=S.a.minBy(s,"depth");return this.mood=JSON.stringify({score:(l.score/l.outOf).toFixed(2),goal:"Minimizing Length to Victory",depth:(l.depth/l.outOf).toFixed(2),unfinished:(l.unfinished/l.outOf).toFixed(2)}),l.move}if(c<-.9){var d=S.a.maxBy(s,"depth");return this.mood=JSON.stringify({score:(d.score/d.outOf).toFixed(2),goal:"Delaying time till loss",depth:(d.depth/d.outOf).toFixed(2),unfinished:(d.unfinished/d.outOf).toFixed(2)}),d.move}var u=S.a.maxBy(s,"score");return this.mood=JSON.stringify({score:(u.score/u.outOf).toFixed(3),depth:(u.depth/u.outOf).toFixed(2),unfinished:(u.unfinished/u.outOf).toFixed(2)}),u.move}},{key:"simulateGame",value:function(e,t){for(var n=t,a=0;a<this.depth;a++){var r=e.getStatus(n);if(r!==m.IN_PLAY)return{status:r,length:a};try{var i=this.simulationStrategy.pickMove(e,n);if(!i)return{status:m.DRAW,length:a};n=e.applyMove(n,i)}catch(o){if(o.message.includes("No valid move"))return{status:m.DRAW,length:a};throw o}}return{status:m.IN_PLAY,length:this.depth,heuristic:this.inPlayHeuristic(n)}}}]),e}(),F=n(16),H=n.n(F),W=function(){function e(t,n,a){Object(s.a)(this,e),this.cardIndex=void 0,this.deckOne=void 0,this.deckTwo=void 0,this.cardIndex=t,this.deckOne=n||Object.keys(this.cardIndex).map((function(e){return parseInt(e)})),this.deckTwo=a||this.deckOne}return Object(l.a)(e,[{key:"applyMove",value:function(e,t){if("end"===t.type)return this.applyEndMove(e);if("play"===t.type)return this.applyCardPlay(e,t.cardNumber);if("discard"===t.type)return this.applyCardDiscard(e,t.cardNumber);throw new Error("Unknown move")}},{key:"getSensibleMoves",value:function(e){return[]}},{key:"getStatus",value:function(e){var t=0===e.playerOne.deck.length||e.playerOne.health<=0,n=0===e.playerTwo.deck.length||e.playerTwo.health<=0;return t&&n?m.DRAW:t?m.LOSE:n?m.WIN:m.IN_PLAY}},{key:"getValidMoves",value:function(e){return"draw"===e.step?this.getDiscardMoves(e):[{type:"end"}].concat(Object(d.a)(this.getCardMoves(e)))}},{key:"newGame",value:function(){var e={hand:[],health:30,discardPile:[],board:[]},t={activePlayer:2,step:"play",playerOne:Object(b.a)({deck:this.deckOne},e),playerTwo:Object(b.a)({deck:this.deckTwo},e)};return this.applyEndMove(t)}},{key:"print",value:function(e){var t=e.playerOne,n=e.playerTwo,a=Object(I.a)(e,["playerOne","playerTwo"]);console.log(H.a.white(JSON.stringify(a,null,4))),console.log(H.a.blue(JSON.stringify(t,null,4))),console.log(H.a.red(JSON.stringify(n,null,4)))}},{key:"randomizeHiddenInfo",value:function(e){for(var t=1===e.activePlayer?"playerTwo":"playerOne",n=[].concat(Object(d.a)(e[t].deck),Object(d.a)(e[t].hand)),a=[],r=0;r<e[t].hand.length;r++){var i=Math.floor(Math.random()*n.length);a.push.apply(a,Object(d.a)(n.splice(i,1)))}return Object(b.a)(Object(b.a)({},e),{},Object(y.a)({},t,Object(b.a)(Object(b.a)({},e[t]),{},{hand:a,deck:n})))}},{key:"getCardMoves",value:function(e){return(1===e.activePlayer?e.playerOne:e.playerTwo).hand.map((function(e){return{type:"play",cardNumber:e}}))}},{key:"getDiscardMoves",value:function(e){return(1===e.activePlayer?e.playerOne:e.playerTwo).hand.map((function(e){return{type:"discard",cardNumber:e}}))}},{key:"applyEndMove",value:function(e){for(var t,n=1===e.activePlayer?2:1,a=1===n?"playerOne":"playerTwo",r=e[a],i=Object(d.a)(r.deck),o=Object(d.a)(r.hand);o.length<7&&i.length>0;){var c=Math.floor(Math.random()*i.length);o.push.apply(o,Object(d.a)(i.splice(c,1)))}var s=Object(b.a)(Object(b.a)({},r),{},{deck:i,hand:o});return Object(b.a)(Object(b.a)({},e),{},(t={step:"draw"},Object(y.a)(t,a,s),Object(y.a)(t,"activePlayer",n),t))}},{key:"applyCardPlay",value:function(e,t){return this.cardIndex[t].play(e,t)}},{key:"applyCardDiscard",value:function(e,t){var n=1===e.activePlayer?"playerOne":"playerTwo",a=e[n],r=Object(d.a)(a.hand),i=Object(d.a)(a.discardPile);return i.push.apply(i,Object(d.a)(r.splice(r.indexOf(t),1))),Object(b.a)(Object(b.a)({},e),{},Object(y.a)({step:r.length>6?"draw":"play"},n,Object(b.a)(Object(b.a)({},a),{},{hand:r,discardPile:i})))}},{key:"getHeuristic",value:function(e){var t=Math.max(0,e.playerOne.health*e.playerOne.deck.length),n=Math.max(0,e.playerTwo.health*e.playerTwo.deck.length);return t===n?0:(t-n)/(n+t)}}]),e}(),Y=n(2),B={position:"relative",backgroundColor:"white",border:"1px solid black",fontSize:11,borderRadius:3,width:80,height:120,margin:5,top:0,display:"inline-block",transition:"transform 0.3s, margin 0.35s ease-in 0.3s, top 0.4s ease-in-out 0.5s",cursor:"not-allowed",overflow:"hidden",zIndex:0},R={fontWeight:"bold",fontSize:16},_=Object(b.a)(Object(b.a)({},B),{},{color:"blue",borderColor:"black",transform:"scale(1.3)",marginLeft:-40,marginRight:-40,zIndex:1}),z=Object(b.a)(Object(b.a)({},B),{},{borderColor:"red",borderWidth:3,cursor:"pointer"}),J=Object(b.a)(Object(b.a)({},B),{},{borderColor:"blue",borderWidth:3,cursor:"pointer"}),V={top:160},G={top:-160},K={backgroundColor:"darkgray",color:"darkgray",transform:"rotate3d(0,1,0,0.5turn)"},U=function(e){var t=e.card,n=e.beingPlayed,a=e.canBeDiscarded?z:e.canBePlayed?J:{},r=e.beingPlayed&&e.isOpponent?V:e.beingPlayed&&!e.isOpponent?G:{},i=e.isHidden?K:{},o=e.canBeDiscarded||e.canBePlayed?e.onClick:function(){};return Object(Y.jsxs)("div",{style:Object(b.a)(Object(b.a)(Object(b.a)(Object(b.a)({},n?_:B),a),r),i),onClick:o,children:[Object(Y.jsx)("div",{style:R,children:t.getName()}),Object(Y.jsx)("div",{children:t.getText()})]})},$=n(26),q=n(27),Q=(n(65),{border:"1px solid black",fontSize:10,borderRadius:3,width:40,height:60,margin:5,display:"inline-block"}),X={maxHeight:200,fontSize:10,textAlign:"left",width:150,overflowY:"auto"},Z=function(e){e.label;var t=e.cards,n=Object(q.a)({interactive:!0,delayHide:100}),a=n.getArrowProps,r=n.getTooltipProps,i=n.setTooltipRef,o=n.setTriggerRef,c=n.visible;return Object(Y.jsxs)(Y.Fragment,{children:[Object(Y.jsxs)("div",{style:Q,ref:o,children:[e.label,Object(Y.jsx)("div",{children:t.length})]}),c&&Object(Y.jsxs)("div",Object(b.a)(Object(b.a)({ref:i},r({className:"tooltip-container"})),{},{children:[0===t.length&&Object(Y.jsx)("i",{children:"Empty"}),Object(Y.jsx)("ul",{style:X,children:t.map((function(e){return Object(Y.jsxs)("li",{children:[Object(Y.jsx)("b",{children:"string"===typeof e?e:e.getName()})," ","string"!==typeof e&&e.getText()]})}))}),Object(Y.jsx)("div",Object(b.a)({},a({className:"tooltip-arrow"})))]}))]})},ee={display:"flex",alignItems:"center",placeContent:"center"},te=Object(b.a)(Object(b.a)({},ee),{},{background:"gold"}),ne={display:"inline-flex",minWidth:400,justifyContent:"center"},ae={fontSize:60,position:"relative"},re={position:"absolute",bottom:25,left:18,width:20,fontSize:16,color:"white",textAlign:"center"},ie=function(e){var t=e.onCardClick,n=e.game,a=e.player,i=e.isActive,o=e.isHidden,s=e.lastmove,l=e.gamestate,u=r.a.useState(!0),f=Object(c.a)(u,2),h=f[0],p=(f[1],s&&"play"===s.type?[s.cardNumber]:[]),y=[].concat(Object(d.a)(a.hand),p).sort((function(e,t){return e-t}));return Object(Y.jsxs)("div",{style:i?te:ee,children:[Object(Y.jsxs)("div",{style:ae,children:["\u2764",Object(Y.jsx)("div",{style:re,children:a.health})]}),Object(Y.jsxs)($.a,{style:Object(b.a)({},ne),children:[0===y.length&&Object(Y.jsx)("pre",{children:"(Empty Hand)"}),y.map((function(e){return(h||!p.includes(e))&&Object(Y.jsx)("div",{children:Object(Y.jsx)(U,{onClick:function(){return t(e)},isOpponent:o,isHidden:o&&!p.includes(e),card:n.cardIndex[e],canBePlayed:i&&!o&&"play"===l.step&&!p.includes(e),canBeDiscarded:i&&!o&&"draw"===l.step&&!p.includes(e),beingPlayed:p.includes(e)})},e)}))]}),Object(Y.jsx)(Z,{label:"deck",cards:a.deck.map((function(e){return o?"?":n.cardIndex[e]}))}),Object(Y.jsx)(Z,{label:"discard",cards:a.discardPile.map((function(e){return n.cardIndex[e]}))})]})},oe=function(e){var t=e.gamestate,n=e.game,a=e.lastmove,r=e.onCardClick;return Object(Y.jsxs)(Y.Fragment,{children:[Object(Y.jsxs)("div",{children:["Step: ",t.step]}),Object(Y.jsx)(ie,{onCardClick:function(){},game:n,gamestate:t,player:t.playerTwo,lastmove:2===t.activePlayer?a:void 0,isActive:2===t.activePlayer,isHidden:!0}),Object(Y.jsx)("div",{style:{height:"50vh"}}),Object(Y.jsx)(ie,{onCardClick:r,game:n,gamestate:t,player:t.playerOne,lastmove:1===t.activePlayer?a:void 0,isActive:1===t.activePlayer,isHidden:!1})]})};var ce=function(){var e=Object(a.useMemo)((function(){return P(),[].concat(M,M,M,M).map((function(e,t){var n=u.parse("Eff",e);return new N(n,e,"#".concat(t))}))}),[]),t=Object(a.useMemo)((function(){return Object.keys(e).map((function(e){return parseInt(e)}))}),[e]),n=Object(a.useMemo)((function(){return new W(e,t)}),[e,t]),i=new D,o=new L(1,1,(function(e){return n.getHeuristic(e)})),s=new L(45,45,(function(e){return n.getHeuristic(e)}),o),l=r.a.useState(n.newGame()),d=Object(c.a)(l,2),f=d[0],h=d[1],p=Object(a.useMemo)((function(){return n.getStatus(f)}),[n,f]),y=r.a.useState(NaN),b=Object(c.a)(y,2),v=b[0],O=b[1],j=r.a.useState(s.mood),g=Object(c.a)(j,2),w=g[0],k=g[1],x=r.a.useState({type:"end"}),E=Object(c.a)(x,2),I=E[0],C=E[1];return Object(Y.jsxs)("div",{className:"App",children:[p!==m.IN_PLAY&&Object(Y.jsx)("h1",{children:p}),Object(Y.jsx)(oe,{gamestate:f,game:n,lastmove:I,onCardClick:function(e){if(p===m.IN_PLAY){var t=function(e,t){return"draw"==e.step?{type:"discard",cardNumber:t}:{type:"play",cardNumber:t}}(f,e),a=n.applyMove(f,t);h(a),C(t)}}}),Object(Y.jsxs)("button",{disabled:p!==m.IN_PLAY||1===f.activePlayer,onClick:function(){var e=performance.now(),t=1===f.activePlayer?i:s,a=t.pickMove(n,f);O(performance.now()-e);var r=n.applyMove(f,a);h(r),k(t.mood),C(a)},children:["step AI ",v?"(".concat(v.toFixed(2)," ms)"):""]}),Object(Y.jsx)("button",{disabled:p!==m.IN_PLAY||2===f.activePlayer||!n.getValidMoves(f).find((function(e){return"end"===e.type})),onClick:function(){var e={type:"end"},t=n.applyMove(f,e);h(t),C(e)},children:"End Turn"}),Object(Y.jsx)("div",{children:w})]})},se=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,71)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,i=t.getLCP,o=t.getTTFB;n(e),a(e),r(e),i(e),o(e)}))};o.a.render(Object(Y.jsx)(r.a.StrictMode,{children:Object(Y.jsx)(ce,{})}),document.getElementById("root")),se()}},[[66,1,2]]]);
//# sourceMappingURL=main.0cb49a22.chunk.js.map