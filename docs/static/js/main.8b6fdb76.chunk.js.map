{"version":3,"sources":["webpack:///./src/client/worker/worker.ts?3305","mcts/mcts.ts","cardgame/Components/TextTemplate.ts","cardgame/Card.ts","cardgame/Components/Effects/RandomTransferEffect.ts","cardgame/Components/Effects/ListEffect.ts","cardgame/Components/Effects/ChangePlayerValue.ts","cardgame/Components/Effects/ConditionalEffect.ts","cardgame/Components/GameConditions/PlayerLessThanCondition.ts","cardgame/Components/Abilities/OnEventAbility.ts","cardgame/Components/ChoiceActions/ChooseAPlayer.ts","cardgame/Components/Effects/MovePlayerEffect.ts","cardgame/Components/ChoiceActions/ContextualExtreme.ts","cardgame/Components/Effects/MoveDemographicEffect.ts","cardgame/Components/ChoiceActions/ChooseAnExtreme.ts","cardgame/Components/ChoiceActions/ChooseOne.ts","cardgame/Components/GameConditions/PlayerPositionCondition.ts","cardgame/Components/setup.ts","cardgame/CreateStartingDemographics.ts","cardgame/CardGame.ts","client/ChoiceArrow.tsx","client/DelayHover.tsx","client/CardComponent.tsx","client/CardWrapper.tsx","client/assets/bg.png","client/TransitionProps.tsx","client/DemographicDisplay.tsx","client/CardPile.tsx","client/PlayerHand.tsx","client/Tooltip.tsx","client/MoveHistory.tsx","client/GameBoard.tsx","client/worker/index.ts","cardgame/Data/ExampleDecks.ts","client/pages/main.tsx","App.tsx","reportWebVitals.ts","index.tsx","client/worker/worker.ts","client/assets/icons sync nonrecursive /.(png)$","client/assets/icons/card-draw.png","client/assets/icons/card-exchange.png","client/assets/icons/card-pickup.png","client/assets/icons/card-random.png","client/assets/icons/contract.png","client/assets/icons/expand.png","client/assets/icons/move.png","client/assets/icons/overhead.png","client/assets/icons/quill-ink.png","client/assets/icons/star.png"],"names":["module","exports","Worker","promptSync","GameStatus","ResolveConstant","constructor","value","ctxKey","super","this","resolveValue","state","ctx","game","r","Effect","applyEffectNoFizzle","executionContext","applyEffect","e","Fizzle","isFizzle","returnState","TextTemplate","slot","template","factory","regex","slots","pattern","toLowerCase","replace","RegExp","matchAll","map","match","templates","push","_text","text","trim","candidates","filter","length","Error","errors","results","matches","subTexts","splice","args","i","parse","x","errorMessages","_","uniq","message","join","result","Eff","ChoiceAction","Player","N","Cond","Ability","Demos","Position","Card","cardNumber","cost","preEffect","playerKey","player","hand","capitalCost","Math","min","capital","popCost","indexOf","endRoundAfterThisTurn","popularity","postEffect","cardPlayedThisTurn","discardPile","play","activePlayer","afterPreEffect","afterEffect","EffectCard","getName","name","getText","getIcon","effect","ChoiceActionCard","choiceAction","cancelState","step","cardBeingPlayed","c","hasOwnProperty","cancel","ItemCard","ability","board","RandomTransferEffect","target","from","to","n","s","transfer","targetKey","fromPile","toPile","drawIndex","floor","random","DrawCardEffect","processEvent","cardNumbers","xor","ListEffect","a","b","afterA","ChangePlayerValue","amount","field","icon","modifier","ConditionalEffect","eff","condition","PlayerLessThanCondition","mapping","OnEventAbility","eventType","abilityType","trigger","eventParams","triggerCtx","lastPlayer","FilteredOnEventAbility","ChooseAPlayer","move","choice","getChoices","type","MovePlayerEffect","position","shift","MovePlayerTowardsPointEffect","point","stepSize","pos","deltaX","deltaY","y","deltaMag","sqrt","clampedStepSize","clamp","max","shiftTowardsPoint","MoveDemographicEffect","getIconModiferFromPoint","ContextualExtreme","lastExtreme","EXTREMES","hearts","clubs","diamonds","spades","demos","indexes","demographics","demo","includes","pointResolver","is","undefined","MoveDemographicTowardsPointEffect","resolveAllDemographics","resolveFollowers","playerTarget","getDemographicVote","resolveUndecided","ListDemographic","aDemos","bDemos","resolveQuadrantDemographics","inQuad","sign","inSource","intersectionWith","ResolvePlayerPosition","EXTREMES_BY_ID","1","2","3","4","ID_BY_EXTREME","ChooseAnExtreme","ChooseOne","aText","bText","PlayerInQuadrantCondition","extreme","quad","hasTarget","resolveActivePlayer","resolveOpponent","resolvePlayerContextually","setupEffects","numberToWords","toWords","reversedConditionalFactory","cond","setupConditional","forEach","Object","entries","createStartingDemographics","eighth","Array","fill","points","thresholdSquared","pointGroups","putInGroup","group","other","dx","dy","reduce","mergeByDistance","quadrant","flatMap","coord","reflectAcrossBothAxes","POP_RANGE","PASS_TURN_DRAW_EFFECT","CardGame","applyMoveChain","chain","isArray","applyMove","cardIndex","deckOne","deckTwo","keys","parseFloat","onTurnEnd","applyCardPlay","applyCardDiscard","applyChoiceMove","applyCancelMove","getSensibleMoves","roundsUntilElection","votes","getVotes","getCardMoves","bPop","playerOne","rPop","playerTwo","bdistSquared","pow","rdistSquared","rScore","bScore","identity","countBy","getStatus","IN_PLAY","WIN","LOSE","DRAW","getValidMoves","card","getDiscardMoves","newGame","newPlayer","preGame","isFirstTurn","deck","blueDrawCardsEffect","STARTING_HAND_SIZE","redDrawCardsEffect","p1Draw","print","console","log","chalk","white","JSON","stringify","blue","red","randomizeHiddenInfo","opponentKey","playMove","roundEnding","afterRoundUpdateState","onRoundEnd","afterTurnEndState","getHeuristic","bluePoints","redPoints","baseState","isItemCard","isOnEventAbility","listener","afterEvents","updatePlayer","newState","drawEffect","getActiveActionChoice","ARROW_STYLE","boxSizing","background","width","zIndex","left","top","marginBottom","transformOrigin","display","flexDirection","alignItems","cursor","pointerEvents","HEAD_STYLE","borderLeft","borderRight","borderTop","ChoiceArrow","height","setHeight","React","useState","theta","setTheta","element","useRef","dynamicStyle","transform","useEffect","event","current","domRect","getBoundingClientRect","clientX","clientY","atan2","window","addEventListener","removeEventListener","ref","style","DelayHover","props","tId","setTId","hovered","setHovered","handleHoverCancel","className","onMouseOver","setTimeout","handleHoverTrigger","delay","onMouseOut","clearTimeout","children","icons","moduleArr","key","default","keyBy","mapValues","importAll","require","CARD_STYLE","backfaceVisibility","border","borderRadius","fontFamily","fontSize","padding","transition","overflow","color","OUTLINE_WRAPPER_STYLE","flexGrow","BACKGROUND_ICONS_STYLE","backgroundSize","backgroundRepeat","opacity","BACKFACE_STYLE","backgroundColor","CARD_TITLE_STYLE","fontWeight","lineHeight","textAlign","justifyContent","CARD_COST_STYLE","CARD_TEXT_STYLE","VERTICAL_CENTER_STYLE","HIDDEN_STYLE","VerticalCenter","IconComponent","hsv","iconName","src","size","TextFillSpace","setFontSize","clientHeight","scrollHeight","clientWidth","scrollWidth","CardComponent","rotationStyle","isHidden","useMemo","backgroundImage","onClick","BEING_PLAYED_CARD_STYLE","borderColor","margin","CAN_BE_DISCADED_STYLE","borderWidth","CAN_BE_PLAYED_STYLE","MOVE_DOWN_STYLE","MOVE_UP_STYLE","VANISHED_STYLE","CHOICE_BUBBLE_STYLE","WRAPPER_STYLE","CardWrapper","hasAppearedOnBoard","setHasAppearedOnBoard","onBoard","beingPlayed","situationalStyle","canBeDiscarded","canBePlayed","positionStyling","isOpponent","activeChoice","gamestate","chooseOneActive","choiceTexts","setPreview","TransitionProps","component","propList","rest","visibleProps","setVisibleProps","newVisibleProps","requiresUpdate","currentValue","diff","abs","newValue","COMPASS_STYLE","PLAYER_STYLE","DEMOGRAPHIC_STYLE","VOTES_BAR_STYLE","coordsToTransform","shaders","Shaders","create","helloBlue","frag","GLSL","Background","blueX","redPop","redX","bluePop","blueY","redY","pblueX","predPop","predX","pbluePop","pblueY","predY","coef","bg","mixBlendMode","shader","uniforms","AnimatedBackground","Component","render","VoteBars","redVotes","blueVotes","round","DemographicDisplay","previewState","onChoiceClick","previewVotes","isChoosingPlayer","isChoosingExtreme","bluePlayer","redPlayer","vote","preview","ghostStyling","PILE_STYLE","CARD_LIST_STYLE","maxHeight","overflowY","CardPile","label","cards","getArrowProps","getTooltipProps","setTooltipRef","setTriggerRef","visible","usePopperTooltip","interactive","delayHide","HAND_STYLE","PlayerHand","displayHand","onCardClick","isActive","cardsBeingPlayed","Tooltip","opts","MoveHistoryElement","placement","MoveHistory","moveHistory","m","placeContent","ACTIVE_WRAPPER_STYLE","HEALTH_WRAPPER_STYLE","HEALTH_STYLE","bottom","PLAYER_BOARD_STYLE","PlayerDisplay","lastmove","sort","GameBoard","parseCard","raw","getExampleDeck","values","some","arr","rawCards","ExampleDeckCsv","worker","Main","combinedGameState","setCombinedGameState","status","mood","setMood","setPreviewState","isLoading","setIsLoading","nextTimeout","async","delay_time","lastMove","Promise","all","processData","canEndTurn","find","slice","handler","preventDefault","document","disabled","App","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","StrictMode","getElementById","inst","wrap","f","webpackContext","req","id","webpackContextResolve","__webpack_require__","o","code","resolve"],"mappings":"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","file":"static/js/main.8b6fdb76.chunk.js","sourcesContent":["module.exports = function() {\n  return new Worker(__webpack_public_path__ + \"439b30deb2fd5c8ceeb7.worker.js\");\n};","import _ from 'lodash';\r\nimport promptSync from 'prompt-sync'\r\nimport objectHash from 'object-hash'\r\nconst prompt = promptSync();\r\n\r\nexport enum GameStatus{\r\n    IN_PLAY='IN_PLAY',\r\n    LOSE='RED_WIN',\r\n    WIN='BLUE_WIN',\r\n    DRAW='DRAW'\r\n}\r\n\r\nconst getPlayerGoal = (player:1|2) => player === 1 ? GameStatus.WIN : GameStatus.LOSE;\r\n\r\ninterface GameState{\r\n    activePlayer: 1|2,\r\n}\r\n\r\nexport abstract class Game<STATE extends GameState, T>{\r\n    abstract newGame():STATE;\r\n    abstract getValidMoves(state:STATE):(T|T[])[];\r\n    abstract print(state:STATE):void;\r\n     abstract randomizeHiddenInfo(state:STATE):STATE;\r\n     abstract applyMove(state:STATE, move:T):STATE;\r\n    abstract getStatus(state:STATE):GameStatus;\r\n\r\n    applyMoveChain(state: STATE, chain: T[]|T): STATE{\r\n        if(!Array.isArray(chain)) return this.applyMove(state, chain)\r\n        return  chain.reduce((s,move)=>this.applyMove(s, move), state);\r\n    }\r\n}\r\n\r\nexport interface Strategy<STATE extends GameState, T>{\r\n    mood: string;\r\n    pickMove(game:Game<STATE,T>, state:STATE):T|T[];\r\n}\r\n\r\nexport type StateFromGame<G> = G extends Game<infer U,any> ?  U : never;\r\nexport type MoveFromGame<G> = G extends Game<any, infer U> ?  U : never;\r\n\r\nexport function wilsonScore(successes:number, trails:number, z=1.96){\r\n    const failures = trails - successes;\r\n    const base = (successes + 0.5 * z * z)/(trails + z*z);\r\n    const plusMinus = z / (trails+z*z) * Math.sqrt(successes*failures/trails + z*z/4)\r\n    return {lowerBound:base-plusMinus, upperBound:base+plusMinus}\r\n}\r\n\r\nexport class RandomStrategy<STATE extends GameState, T> implements Strategy<STATE, T>{\r\n    mood = \"none\";\r\n    trueRandom: boolean;\r\n\r\n    constructor(trueRandom:boolean = false) {\r\n        this.trueRandom = trueRandom;\r\n    }\r\n\r\n    pickMove(game:Game<STATE, T>, state: STATE): T|T[] {\r\n        const validMove = _.sample(game.getValidMoves(state))\r\n        if (validMove) {\r\n            return validMove;\r\n        }\r\n        throw new Error('No valid moves')\r\n    }\r\n}\r\n\r\nexport class InputStrategy<STATE extends GameState, T> implements Strategy<STATE, T> {\r\n    mood=\"player\"\r\n    transform:(str:string)=>T;\r\n    constructor(transform:(str:string)=>T) {\r\n        this.transform = transform;\r\n    }\r\n\r\n    pickMove(game: Game<STATE, T>, state: STATE): T {\r\n        game.print(state);\r\n        return this.transform(prompt(\"What's your move?\"))\r\n    }\r\n\r\n}\r\n\r\n\r\nexport class MCTSStrategy<STATE extends GameState, T>implements Strategy<STATE, T>{\r\n    mood = \"waiting...\"\r\n    private simulationStrategy: Strategy<STATE, T>;\r\n    private samples:number;\r\n    private depth:number;\r\n    private inPlayHeuristic:(state:STATE)=>number;\r\n\r\n    usePruning:boolean=false;\r\n    z: number = 1.96;\r\n    pruningPeriod: number = 50;\r\n    useCache:boolean=false;\r\n\r\n    secondaryObjective?:(state:STATE)=>number;\r\n\r\n    private cache:Record<string,T|T[]> = {};\r\n\r\n    constructor(samples=60, depth=100, inPlayHeuristic: (state:STATE)=>number = ()=>0, simulationStrategy:Strategy<STATE, T> = new RandomStrategy()) {\r\n        this.simulationStrategy = simulationStrategy;\r\n        this.depth = depth;\r\n        this.samples = samples;\r\n        this.inPlayHeuristic = inPlayHeuristic;\r\n    }\r\n\r\n    pickMove(game:Game<STATE, T>, state: STATE): T|T[] {\r\n        if(!this.useCache)return this.performPickMove(game, state);\r\n        const hash = objectHash(state);\r\n        if(!this.cache[hash]){\r\n            this.cache[hash] = this.performPickMove(game, state);\r\n        }\r\n        return this.cache[hash];\r\n    }\r\n    performPickMove(game:Game<STATE, T>, state: STATE): T|T[] {\r\n        let evaluations = game.getValidMoves(state).map(move=>({move, score:0, outOf:0, depth: 0,unfinished:0, wins:0, secondaryObjective:0}));\r\n        if(evaluations.length === 0) throw new Error('No valid moves')\r\n        const playerGoal = getPlayerGoal(state.activePlayer);\r\n        const iterations = Math.ceil(this.samples/evaluations.length);\r\n        for(let i = 0; i < iterations; i++){\r\n            evaluations.forEach(evaluation=>{\r\n                const desire = state.activePlayer === 1 ? 1 : -1;\r\n                const stateWithScrambledUnknowns = game.randomizeHiddenInfo(state);\r\n                const moves = Array.isArray(evaluation.move) ? evaluation.move : [evaluation.move]\r\n                const newState = game.applyMoveChain(stateWithScrambledUnknowns, moves)\r\n                const simulation = this.simulateGame(game, newState) ;\r\n                evaluation.outOf++;\r\n                evaluation.secondaryObjective += simulation.secondaryObjective * desire;\r\n                if(simulation.status === playerGoal){\r\n                    evaluation.score++;\r\n                    evaluation.wins++;\r\n                }else if(simulation.status !== GameStatus.DRAW && simulation.status !== GameStatus.IN_PLAY){\r\n                    evaluation.score--;\r\n                }else if(simulation.heuristic !== undefined){\r\n                    evaluation.score += simulation.heuristic * desire ;\r\n                    evaluation.wins += (evaluation.score+1)/2;\r\n                    evaluation.unfinished++;\r\n                }else if(simulation.status === GameStatus.DRAW){\r\n                    evaluation.wins += 0.5;\r\n                }\r\n                evaluation.depth += simulation.length;\r\n            })\r\n            if(this.usePruning && (i % this.pruningPeriod) === (this.pruningPeriod - 1)){\r\n                 const highestEval =  _.maxBy(evaluations, 'score')!;\r\n                 const bestWilsonScore = wilsonScore(highestEval.wins, highestEval.outOf, this.z)\r\n                 evaluations = evaluations.filter(evaluation=> {\r\n                     if(evaluation === highestEval) return true;\r\n                     const evaluationWilsonScore = wilsonScore(evaluation.wins, evaluation.outOf, this.z)\r\n                     const confidentIsSuboptimal =  bestWilsonScore.lowerBound > evaluationWilsonScore.upperBound;\r\n                     return !confidentIsSuboptimal\r\n                 });\r\n            }\r\n            if(evaluations.length === 1){\r\n                break;\r\n            }\r\n        }\r\n        const highestEval =  _.maxBy(evaluations, 'score')!;\r\n        const highestScore = highestEval.score / highestEval.outOf\r\n        const bestMoves = evaluations.filter(({score,outOf})=>(score/outOf) > highestScore - 0.01)\r\n\r\n        if(highestScore > 0.95) {\r\n            const result = this.secondaryObjective ? _.maxBy(bestMoves, 'secondaryObjective')!  : _.minBy(bestMoves, 'depth')!\r\n            this.mood = JSON.stringify({\r\n                score: (result.score/result.outOf).toFixed(2),\r\n                goal: this.secondaryObjective ? 'Maximizing Secondary Objective' : 'Minimizing Length to Victory',\r\n                depth: (result.depth / result.outOf).toFixed(2),\r\n                unfinished: (result.unfinished / result.outOf).toFixed(2)\r\n            })\r\n            return result.move;\r\n        }else if(highestScore < -0.95){\r\n            const result = this.secondaryObjective ? _.maxBy(bestMoves, 'secondaryObjective')!  :  _.maxBy(bestMoves, 'depth')!\r\n            this.mood = JSON.stringify({\r\n                score: (result.score/result.outOf).toFixed(2),\r\n                goal: this.secondaryObjective ? 'Maximizing Secondary Objective' : 'Delaying time till loss',\r\n                depth: (result.depth / result.outOf).toFixed(2),\r\n                unfinished: (result.unfinished / result.outOf).toFixed(2)\r\n            })\r\n            return result.move;\r\n        }else{\r\n            const result =  _.maxBy(bestMoves, 'score')!\r\n            this.mood = JSON.stringify({\r\n                score: (result.score / result.outOf).toFixed(3),\r\n                depth: (result.depth / result.outOf).toFixed(2),\r\n                unfinished: (result.unfinished / result.outOf).toFixed(2)\r\n            })\r\n            return  result.move;\r\n        }\r\n    }\r\n    simulateGame(game:Game<STATE, T>, state:STATE):{status:GameStatus, length:number, heuristic?:number, secondaryObjective:number}{\r\n        let curState = state;\r\n        for(let i = 0; i < this.depth; i++){\r\n            const status = game.getStatus(curState);\r\n            const secondaryObjective = this.secondaryObjective ? this.secondaryObjective(curState) : 0;\r\n            if(status !== GameStatus.IN_PLAY) return {status, length: i, secondaryObjective};\r\n            try{\r\n                const move = this.simulationStrategy.pickMove(game, curState);\r\n                if(!move) return {status: GameStatus.DRAW, length: i, secondaryObjective};\r\n                curState = game.applyMoveChain(curState, move)\r\n            }catch(e){\r\n                if(e.message.includes('No valid move')) return {status: GameStatus.DRAW, length: i, secondaryObjective};\r\n                throw e;\r\n            }\r\n        }\r\n        const secondaryObjective = this.secondaryObjective ? this.secondaryObjective(curState) : 0;\r\n        return {status: GameStatus.IN_PLAY, length: this.depth, heuristic: this.inPlayHeuristic(curState), secondaryObjective};\r\n    }\r\n}\r\n\r\n","import CardGame, {CardGameChoiceMove, CardGameMove, CardGameState} from \"../CardGame\";\r\nimport {Card, Icon, PlayerKey} from \"../Card\";\r\nimport _ from 'lodash'\r\nimport {EventParams, EventType} from \"./Abilities/OnEventAbility\";\r\n\r\ntype KeysMatching<T, V> = {[K in keyof T]?: T[K] extends V ? K : never}[keyof T] | {[K in keyof T]?: T[K] extends (V|undefined) ? K : never}[keyof T] ;\r\ntype Component = ResolveSlot<any>|string[]\r\ntype GetSlot<T extends Component> = T extends ResolveSlot<infer R> ? R : any;\r\ntype Slot = 'Eff'|'Player'|'N'|'Cond'|'Ability'|'ChoiceAction'|'Demos'|'Position'\r\ntype ResolveSlot<SLOT extends Slot> = SLOT extends 'Eff' ? Effect\r\n                                    : SLOT extends 'Ability' ? Ability\r\n                                    : SLOT extends 'Player' ? PlayerTarget\r\n                                    : SLOT extends 'ChoiceAction' ? ChoiceAction\r\n                                    : SLOT extends 'Cond' ? Resolver<boolean>\r\n                                    : SLOT extends 'Demos' ? Resolver<number[]>\r\n                                    : SLOT extends 'Position' ? Resolver<{x:number, y:number}>\r\n                                    : SLOT extends 'N' ? number\r\n                                    : never;\r\n\r\n\r\nexport type ExecutionContext = {\r\n  playerKey: PlayerKey\r\n  lastPlayer?: PlayerKey;\r\n  lastExtreme?: Coord;\r\n} & (EventContext<EventType> | {})\r\n\r\nexport type Coord = {x:number, y:number};\r\n\r\ntype EventContext<E extends EventType> = {\r\n    eventType: E,\r\n    eventParams:EventParams<E>\r\n}\r\n\r\nexport abstract class Resolver<T>{\r\n   abstract resolveValue(state:CardGameState, ctx:ExecutionContext, game:CardGame):T;\r\n}\r\n\r\nexport class ResolveConstant<T> extends Resolver<T>{\r\n  value:T;\r\n  ctxKey?: KeysMatching<ExecutionContext, T>;\r\n  constructor(value:T, ctxKey?: KeysMatching<ExecutionContext, T>) {\r\n    super();\r\n    this.value = value;\r\n    this.ctxKey = ctxKey;\r\n  }\r\n    resolveValue(state:CardGameState, ctx:ExecutionContext, game:CardGame):T{\r\n      if(this.ctxKey){\r\n        (ctx as any)[this.ctxKey] = this.value;\r\n      }\r\n      return this.value;\r\n    }\r\n\r\n  static is(r: Resolver<any>) : r is ResolveConstant<unknown> {\r\n      return r instanceof ResolveConstant;\r\n  }\r\n}\r\n\r\n\r\nexport type PlayerTarget = Resolver<PlayerKey>\r\n\r\nexport interface Ability {\r\n  abilityType: string;\r\n}\r\n\r\nexport interface ChoiceAction {\r\n  getChoices(state:CardGameState, executionContext:ExecutionContext, game:CardGame):CardGameChoiceMove[];\r\n  applyEffect(move:CardGameChoiceMove, state:CardGameState, executionContext:ExecutionContext, game:CardGame):CardGameState;\r\n}\r\n\r\nexport abstract class Effect{\r\n  abstract applyEffect(state:CardGameState, executionContext:ExecutionContext, game:CardGame):CardGameState;\r\n  applyEffectNoFizzle(state:CardGameState, executionContext:ExecutionContext, game:CardGame):CardGameState{\r\n     try{\r\n        return this.applyEffect(state, executionContext, game);\r\n    }catch(e){\r\n        if(!Fizzle.isFizzle(e))throw e;\r\n        return e.returnState;\r\n    }\r\n  }\r\n\r\n  abstract getIcon(): Icon;\r\n}\r\n\r\nexport default class TextTemplate<T extends Component, ARGS extends Component[]=Component[]>{\r\n  template: string;\r\n  regex: RegExp;\r\n  slots: Slot[];\r\n  factory:(...args:ARGS)=>T;\r\n\r\n  static templates:{\r\n    [S in Slot]: TextTemplate<ResolveSlot<S>>[]\r\n  } = {\r\n    Eff: [],\r\n    Player: [],\r\n    N:[],\r\n    Cond:[],\r\n    ChoiceAction:[],\r\n    Ability:[],\r\n    Demos:[],\r\n    Position:[],\r\n  }\r\n\r\n  constructor(slot: GetSlot<T>, template:string, factory:(...args:ARGS)=>T){\r\n    this.template = template;\r\n    const pattern = template\r\n        .toLowerCase()\r\n        .replace(/%\\w+\\s+/g, '(.*\\\\s+|)?')\r\n        .replace(/%\\w+/g, '(.*|)?')\r\n    this.regex = new RegExp('^'+pattern+'$');\r\n    this.factory = factory;\r\n    this.slots = [...this.template.matchAll(/%(\\w+)/gi)].map(match=>match[1]) as Slot[]\r\n    TextTemplate.templates[slot].push(this as any);\r\n  }\r\n\r\n  static parse<SLOT extends Slot>(slot: SLOT, _text:string):ResolveSlot<SLOT>{\r\n    const text = (_text||\"\").trim()\r\n    const templates = TextTemplate.templates[slot] as TextTemplate<ResolveSlot<SLOT>>[];\r\n    const candidates = templates.filter((template:TextTemplate<Component>) => text.toLowerCase().match(template.regex));\r\n    if(candidates.length === 0) throw new Error(`Invalid text for slot ${slot}: ${text}`);\r\n    const errors:Error[] = [];\r\n    const results = candidates.map((template:TextTemplate<Component>)=>{\r\n      try{\r\n        const matches = text.toLowerCase().match(template.regex);\r\n        const subTexts = matches ? matches.splice(1) : [];\r\n        const args = template.slots.map((slot, i)=>{\r\n          return TextTemplate.parse(slot, subTexts[i])\r\n        })\r\n        return template.factory(...args as any, subTexts) as unknown as ResolveSlot<SLOT>;\r\n      }catch(e){\r\n        errors.push(e);\r\n        return undefined;\r\n      }\r\n    }).filter(x=>x);\r\n    if(results.length === 0){\r\n      const errorMessages = _.uniq(errors.map(e=>e.message));\r\n      if(errorMessages.length > 1){\r\n        throw new Error(errorMessages.join(\"; \"));\r\n      }else{\r\n        throw errors[0];\r\n      }\r\n    }\r\n    // TODO: select by shortest depth\r\n    const [result] = results;\r\n    if(!result){\r\n      throw Error()\r\n    }\r\n    return result;\r\n  }\r\n\r\n  static clear() {\r\n    this.templates = {\r\n      Eff: [],\r\n      ChoiceAction:[],\r\n      Player: [],\r\n      N:[],\r\n      Cond:[],\r\n      Ability:[],\r\n      Demos:[],\r\n      Position:[],\r\n    }\r\n  }\r\n}\r\n\r\nexport class Fizzle extends Error{\r\n  isFizzle = true\r\n  returnState: CardGameState;\r\n  constructor(returnState: CardGameState) {\r\n    super(\"Effect Fizzle!\");\r\n    this.returnState = returnState;\r\n  }\r\n  static isFizzle(e:any):e is Fizzle{\r\n    return e.isFizzle;\r\n  }\r\n}","import CardGame, {CardGameState} from \"./CardGame\";\r\nimport {Ability, ChoiceAction, Effect, Fizzle} from \"./Components/TextTemplate\";\r\n\r\nexport type PlayerKey = 'playerOne'|'playerTwo'\r\n\r\nexport type IconModifier = 'plus'|'minus'|'hearts'|'clubs'|'spades'|'diamonds'\r\nexport type Icon = string|{icon:string, modifier?:IconModifier}\r\n\r\nexport abstract class Card{\r\n    cardNumber: number;\r\n    cost: number;\r\n    abstract getName():string;\r\n    abstract getText():string;\r\n\r\n    abstract getIcon():Icon;\r\n\r\n    abstract applyEffect(state:CardGameState, playerKey:PlayerKey, game:CardGame):CardGameState;\r\n\r\n    constructor(cardNumber: number, cost:number) {\r\n        this.cardNumber = cardNumber;\r\n        this.cost = cost;\r\n    }\r\n\r\n\r\n    protected preEffect(state:CardGameState, playerKey:PlayerKey):CardGameState{\r\n        const player = state[playerKey];\r\n        const hand = [...player.hand]\r\n        const capitalCost = Math.min(player.capital, this.cost);\r\n        const popCost = this.cost - capitalCost\r\n        hand.splice(hand.indexOf(this.cardNumber), 1);\r\n        return {\r\n            ...state,\r\n            endRoundAfterThisTurn: false,\r\n            [playerKey]: {\r\n                ...player,\r\n                popularity: player.popularity - popCost,\r\n                capital: player.capital - capitalCost,\r\n                hand\r\n            }\r\n        }\r\n    }\r\n\r\n    protected postEffect(state:CardGameState, playerKey:PlayerKey):CardGameState{\r\n        return {\r\n            ...state,\r\n            cardPlayedThisTurn: true,\r\n            endRoundAfterThisTurn: false,\r\n            [playerKey]: {\r\n                ...state[playerKey],\r\n                discardPile: [this.cardNumber, ...state[playerKey].discardPile]\r\n            }\r\n        }\r\n    }\r\n\r\n    play(state:CardGameState, cardNumber:number, game:CardGame):CardGameState{\r\n        const playerKey = state.activePlayer  === 1 ? 'playerOne' : 'playerTwo';\r\n        try{\r\n            const afterPreEffect = this.preEffect(state,playerKey);\r\n            const afterEffect = this.applyEffect(afterPreEffect, playerKey, game);\r\n            return this.postEffect(afterEffect,playerKey);\r\n        }catch(e){\r\n            if(!Fizzle.isFizzle(e)) throw e;\r\n            return this.postEffect(e.returnState, playerKey)\r\n        }\r\n    }\r\n}\r\n\r\nexport class EffectCard extends Card{\r\n    effect: Effect;\r\n    name: string;\r\n    text: string;\r\n\r\n    getName(): string {\r\n        return this.name;\r\n    }\r\n\r\n    getText(): string {\r\n        return this.text;\r\n    }\r\n\r\n    getIcon(): Icon {\r\n        return this.effect.getIcon();\r\n    }\r\n\r\n    constructor(effect:Effect, text:string, name:string, cardNumber:number, cost=1) {\r\n        super(cardNumber, cost);\r\n        this.effect = effect;\r\n        this.text = text;\r\n        this.name = name;\r\n    }\r\n    applyEffect(state: CardGameState, playerKey:PlayerKey, game:CardGame): CardGameState {\r\n        const ctx = {\r\n            playerKey\r\n        }\r\n        return this.effect.applyEffect(state, ctx, game)\r\n    }\r\n}\r\nexport class ChoiceActionCard extends Card{\r\n    choiceAction: ChoiceAction;\r\n    name: string;\r\n    text: string;\r\n    getName(): string {\r\n        return this.name;\r\n    }\r\n\r\n    getText(): string {\r\n        return this.text;\r\n    }\r\n    constructor(choiceAction:ChoiceAction, text:string, name:string,cardNumber:number, cost=1) {\r\n        super(cardNumber, cost);\r\n        this.choiceAction = choiceAction;\r\n        this.text = text;\r\n        this.name = name;\r\n    }\r\n    protected preEffect(state:CardGameState, playerKey:PlayerKey):CardGameState {\r\n        return {\r\n            ...super.preEffect(state,playerKey),\r\n            cancelState: state\r\n        };\r\n    }\r\n    applyEffect(state: CardGameState, playerKey:PlayerKey, game:CardGame): CardGameState {\r\n        return {\r\n            ...state,\r\n            step:'choice',\r\n            endRoundAfterThisTurn: false,\r\n            cardPlayedThisTurn: true,\r\n            cardBeingPlayed: this.cardNumber,\r\n        }\r\n    }\r\n    protected postEffect(state:CardGameState, playerKey:PlayerKey):CardGameState {\r\n        return state;\r\n    }\r\n    static is(c:Card): c is ChoiceActionCard{\r\n        if(!c) return false;\r\n        return (c as Record<string, any>).hasOwnProperty('choiceAction')\r\n    }\r\n    getIcon(){\r\n        return \"overhead\";\r\n    }\r\n\r\n    cancel(state:CardGameState):CardGameState {\r\n        if(!state.cancelState){\r\n            throw new Error(\"No cancel state to return to\")\r\n        }\r\n        return state.cancelState;\r\n    }\r\n}\r\n\r\nexport class ItemCard extends Card{\r\n    ability: Ability;\r\n    name: string;\r\n    text: string;\r\n    getName(): string {\r\n        return this.name;\r\n    }\r\n\r\n    getText(): string {\r\n        return this.text;\r\n    }\r\n    constructor(ability:Ability, text:string, name:string, cardNumber:number, cost=1) {\r\n        super(cardNumber, cost);\r\n        this.ability = ability;\r\n        this.text = text;\r\n        this.name = name;\r\n    }\r\n\r\n    applyEffect(state: CardGameState): CardGameState {\r\n        return state;\r\n    }\r\n\r\n    protected postEffect(state:CardGameState, playerKey:PlayerKey):CardGameState{\r\n        return {\r\n            ...state,\r\n            cardPlayedThisTurn: true,\r\n            endRoundAfterThisTurn: false,\r\n            [playerKey]: {\r\n                ...state[playerKey],\r\n                board: [this.cardNumber, ...state[playerKey].board]\r\n            }\r\n        }\r\n    }\r\n\r\n    static isItemCard(c:Card):c is ItemCard{\r\n        return (c as Object).hasOwnProperty('ability')\r\n    }\r\n\r\n    getIcon(){\r\n        return \"quill-ink\";\r\n    }\r\n}\r\n","import TextTemplate, {Effect, ExecutionContext, Fizzle, PlayerTarget} from \"../TextTemplate\";\r\nimport CardGame, {CardGamePlayerState, CardGameState} from \"../../CardGame\";\r\nimport _ from 'lodash';\r\nimport {Icon} from \"../../Card\";\r\n\r\ntype KeysMatching<T, V> = {[K in keyof T]-?: T[K] extends V ? K : never}[keyof T];\r\n\r\nexport type CardSource = KeysMatching<CardGamePlayerState, readonly number[]>;\r\nexport type CardDest = KeysMatching<CardGamePlayerState, readonly number[]>;\r\n\r\nclass RandomTransferEffect extends Effect{\r\n    target:PlayerTarget;\r\n    from:CardSource;\r\n    to:CardDest;\r\n    n: number;\r\n    constructor(target:PlayerTarget, from:CardSource, to:CardDest, n:number) {\r\n        super();\r\n        this.target = target;\r\n        this.from = from;\r\n        this.to = to;\r\n        this.n = n;\r\n    }\r\n\r\n    applyEffect(state: CardGameState, ctx:ExecutionContext, game:CardGame): CardGameState {\r\n        let s = state;\r\n        for(let i = 0; i<this.n;i++){\r\n            s = this.transfer(s, ctx, game);\r\n        }\r\n        return s;\r\n    }\r\n    transfer(state: CardGameState, ctx:ExecutionContext, game:CardGame): CardGameState {\r\n        const targetKey = this.target.resolveValue(state, ctx, game);\r\n        const player = state[targetKey];\r\n        const fromPile = [...player[this.from]];\r\n        const toPile = [...player[this.to]];\r\n        if(fromPile.length === 0 ){\r\n            throw new Fizzle(state);\r\n        }\r\n        const drawIndex = Math.floor(Math.random() * fromPile.length);\r\n        toPile.push(...fromPile.splice(drawIndex, 1))\r\n        return  {\r\n            ...state,\r\n            [targetKey]:{\r\n                ...player,\r\n                [this.to]:toPile,\r\n                [this.from]:fromPile\r\n            }\r\n        }\r\n    }\r\n\r\n    getIcon(): Icon{\r\n        if(this.to === 'hand'){\r\n            return this.from === 'deck' ? 'card-draw' : 'card-pickup';\r\n        }\r\n        if(this.from === 'hand'){\r\n            return 'card-random'\r\n        }\r\n        return 'card-exchange';\r\n    }\r\n}\r\nexport class DrawCardEffect extends RandomTransferEffect{\r\n    constructor(target:PlayerTarget, n:number) {\r\n        super(target,'deck', 'hand', n);\r\n    }\r\n    transfer(state: CardGameState, ctx:ExecutionContext, game:CardGame): CardGameState {\r\n        const s = super.transfer(state, ctx, game);\r\n        const targetKey = this.target.resolveValue(state, ctx, game);\r\n        if(!game)debugger\r\n        return game.processEvent(s, 'player_draws', {\r\n            player: targetKey,\r\n            cardNumbers: _.xor(s[targetKey].hand, state[targetKey].hand),\r\n            from: 'deck'\r\n        })\r\n    }\r\n}\r\n\r\n\r\nexport default function setup(){\r\n    new TextTemplate('Eff', '%Player draws? %N cards?', (target:PlayerTarget, n:number)=>new DrawCardEffect(target, n));\r\n    new TextTemplate('Eff', '%Player draws? up to %N cards?', (target:PlayerTarget, n:number)=>new DrawCardEffect(target, n));\r\n    new TextTemplate('Eff', '%Player discards? %N random cards?', (target:PlayerTarget, n:number)=>new RandomTransferEffect(target, 'hand','discardPile', n));\r\n    new TextTemplate('Eff', '%Player discards? the top card (?:from|of) (?:their|your) deck', (target:PlayerTarget)=>new RandomTransferEffect(target, 'deck','discardPile', 1));\r\n    new TextTemplate('Eff', '%Player discards? %N cards? from the top of (?:their|your) deck', (target:PlayerTarget, n:number)=>new RandomTransferEffect(target, 'deck','discardPile', n));\r\n    new TextTemplate('Eff', '%Player draws? %N random cards? from (?:their|your) discard pile', (target:PlayerTarget, n:number)=>new RandomTransferEffect(target, 'discardPile','hand', n));\r\n}","import TextTemplate, {Effect, ExecutionContext} from \"../TextTemplate\";\r\nimport CardGame, {CardGameState} from \"../../CardGame\";\r\nimport {Icon, PlayerKey} from \"../../Card\";\r\n\r\nexport default class ListEffect extends Effect{\r\n    a:Effect;\r\n    b:Effect;\r\n    constructor(a:Effect, b:Effect) {\r\n        super();\r\n        this.a = a;\r\n        this.b = b;\r\n    }\r\n    applyEffect(state: CardGameState, ctx:ExecutionContext, game:CardGame): CardGameState {\r\n        const afterA = this.a.applyEffect(state, ctx, game);\r\n        return this.b.applyEffect(afterA, ctx, game);\r\n    }\r\n\r\n    getIcon(): Icon {\r\n        return this.b.getIcon();\r\n    }\r\n}\r\n\r\nexport function setupListEffects(){\r\n    new TextTemplate('Eff', '%Eff and %Eff', (a:Effect, b:Effect)=>new ListEffect(a,b));\r\n    new TextTemplate('Eff', '%Eff, and %Eff', (a:Effect, b:Effect)=>new ListEffect(a,b));\r\n    new TextTemplate('Eff', '%Eff, %Eff', (a:Effect, b:Effect)=>new ListEffect(a,b));\r\n    new TextTemplate('Eff', '%Eff twice', (a:Effect)=>new ListEffect(a,a));\r\n    new TextTemplate('Eff', '%Eff\\\\. %Eff', (a:Effect, b:Effect)=>new ListEffect(a,b));\r\n    new TextTemplate('Eff', '%Eff then %Eff', (a:Effect, b:Effect)=>new ListEffect(a,b));\r\n    new TextTemplate('Eff', '%Eff, then %Eff', (a:Effect, b:Effect)=>new ListEffect(a,b));\r\n}","import TextTemplate, {Effect, ExecutionContext, PlayerTarget} from \"../TextTemplate\";\r\nimport CardGame, {CardGamePlayerState, CardGameState} from \"../../CardGame\";\r\nimport {Icon, PlayerKey} from \"../../Card\";\r\n\r\ntype KeysMatching<T, V> = { [K in keyof T]-?: T[K] extends V ? K : never }[keyof T];\r\n\r\nexport class ChangePlayerValue extends Effect {\r\n    target:PlayerTarget\r\n    amount:number;\r\n    field: KeysMatching<CardGamePlayerState, number>;\r\n    constructor(target:PlayerTarget, amount:number, field: KeysMatching<CardGamePlayerState, number>) {\r\n        super();\r\n        this.target=target;\r\n        this.amount=amount;\r\n        this.field=field;\r\n    }\r\n    applyEffect(state: CardGameState, ctx:ExecutionContext, game:CardGame): CardGameState {\r\n        const {field} = this;\r\n        const targetKey = this.target.resolveValue(state, ctx, game);\r\n        return   {\r\n            ...state,\r\n            [targetKey]:{\r\n                ...state[targetKey],\r\n                [field]:state[targetKey][field] + this.amount\r\n            }\r\n        }\r\n        /*return game.processEvent(s, 'player_take_damage', {\r\n            amount: this.amount,\r\n            player: targetKey\r\n        })*/\r\n    }\r\n    getIcon(): Icon {\r\n        const icon = this.field === 'popularity' ? 'star' : 'capital';\r\n        const modifier = this.amount > 0 ? 'plus' : 'minus';\r\n        return {icon, modifier};\r\n    }\r\n}\r\n\r\nexport default function setup(){\r\n\r\n    new TextTemplate('Eff', '%Player loses? %N popularity', (target:PlayerTarget, n:number)=>new ChangePlayerValue(target, -n, 'popularity'));\r\n    new TextTemplate('Eff', '%Player gains? %N popularity', (target:PlayerTarget, n:number)=>new ChangePlayerValue(target, n, 'popularity'));\r\n    new TextTemplate('Eff', '%Player gains? %N political capital', (target:PlayerTarget, n:number)=>new ChangePlayerValue(target, n, 'capital'));\r\n    new TextTemplate('Eff', '%Player loses? %N political capital', (target:PlayerTarget, n:number)=>new ChangePlayerValue(target, -n, 'capital'));\r\n\r\n}","import TextTemplate, {Effect, ExecutionContext, PlayerTarget, Resolver} from \"../TextTemplate\";\r\nimport CardGame, {CardGameState} from \"../../CardGame\";\r\nimport {PlayerKey} from \"../../Card\";\r\nimport {hasTarget, resolvePlayerContextually} from \"../setup\";\r\n\r\nexport class ConditionalEffect extends Effect{\r\n    eff:Effect;\r\n    condition:Resolver<boolean>;\r\n    constructor(eff:Effect, condition:Resolver<boolean>) {\r\n        super();\r\n        this.eff = eff;\r\n        this.condition = condition;\r\n    }\r\n    applyEffect(state: CardGameState, ctx:ExecutionContext, game:CardGame): CardGameState {\r\n        if(this.condition.resolveValue(state, ctx, game)){\r\n            return this.eff.applyEffect(state, ctx, game);\r\n        }\r\n        return state;\r\n    }\r\n    getIcon(){\r\n        return this.eff.getIcon();\r\n    }\r\n}\r\n\r\nexport default function setup(){\r\n    const reversedConditionalFactory = (eff:Effect, cond:Resolver<boolean>)=>{\r\n        if(hasTarget(eff) && hasTarget(cond) && cond.target === resolvePlayerContextually){\r\n            cond.target = eff.target;\r\n            eff.target = resolvePlayerContextually;\r\n        }\r\n        return new ConditionalEffect(eff,cond)\r\n    };\r\n    new TextTemplate('Eff', '%Eff, if %Cond', reversedConditionalFactory);\r\n    new TextTemplate('Eff', '%Eff if %Cond', reversedConditionalFactory);\r\n    new TextTemplate('Eff', 'if %Cond, %Eff', (cond:Resolver<boolean>, eff:Effect)=>new ConditionalEffect(eff,cond));\r\n}","import TextTemplate, {Effect, ExecutionContext, PlayerTarget, Resolver} from \"../TextTemplate\";\r\nimport CardGame, {CardGamePlayerState, CardGameState} from \"../../CardGame\";\r\nimport {PlayerKey} from \"../../Card\";\r\n\r\nexport class PlayerLessThanCondition implements Resolver<boolean>{\r\n    target:PlayerTarget\r\n    n:number\r\n    mapping:(target:CardGamePlayerState)=>number\r\n    constructor(target:PlayerTarget, n:number, mapping:(target:CardGamePlayerState)=>number) {\r\n        this.target = target;\r\n        this.n = n;\r\n        this.mapping = mapping;\r\n    }\r\n    resolveValue(state: CardGameState, ctx: ExecutionContext, game:CardGame){\r\n        const targetKey = this.target.resolveValue(state, ctx, game);\r\n        const player = state[targetKey];\r\n        return this.mapping(player) < this.n;\r\n    }\r\n}\r\n\r\nexport default function setup(){\r\n    new TextTemplate(\r\n        'Cond',\r\n        '%Player\\\\s?(?:has|have) less than %N cards in (?:their|your) hand',\r\n        (target:PlayerTarget, n:number) => new PlayerLessThanCondition(target, n, player=>player.hand.length)\r\n    );\r\n    new TextTemplate(\r\n        'Cond',\r\n        '%Player\\\\s?(?:has|have) less than %N popularity',\r\n        (target:PlayerTarget, n:number) => new PlayerLessThanCondition(target, n, player=>player.popularity)\r\n    );\r\n}","import TextTemplate, {Ability, Effect, ExecutionContext, PlayerTarget} from \"../TextTemplate\";\r\nimport {PlayerKey} from \"../../Card\";\r\nimport {CardSource} from \"../Effects/RandomTransferEffect\";\r\nimport CardGame, {CardGameState} from \"../../CardGame\";\r\nimport {resolveActivePlayer} from \"../setup\";\r\n\r\nexport type TargetedEventType = 'player_draws'|'turn_start';\r\nexport type EventType = TargetedEventType|'round_end';\r\nexport type EventParams<E extends EventType> =\r\n    E extends 'player_draws' ? PlayerDrawsEventParams\r\n    : E extends 'turn_start' ?  {player: PlayerKey}\r\n    : E extends 'round_end' ?  {}\r\n    : never;\r\n\r\n\r\n\r\nexport type PlayerDrawsEventParams = {\r\n    player: PlayerKey,\r\n    cardNumbers: number[],\r\n    from: CardSource\r\n}\r\n\r\nexport type PlayerTakesDamageEventParams = {\r\n    player: PlayerKey,\r\n    amount: number\r\n}\r\n\r\n\r\n\r\nexport class OnEventAbility<E extends EventType> implements Ability{\r\n    abilityType = 'onEventAbility';\r\n    eventType: E;\r\n    eff: Effect;\r\n\r\n    constructor(eventType:E, eff:Effect) {\r\n        this.eventType = eventType;\r\n        this.eff = eff;\r\n    }\r\n\r\n    trigger(state:CardGameState, eventParams: EventParams<E>, ctx:ExecutionContext, game:CardGame):CardGameState{\r\n        const triggerCtx:ExecutionContext = {\r\n            ...ctx,\r\n            ...((eventParams as any)?.player && {lastPlayer:(eventParams as any).player}),\r\n            eventType: this.eventType,\r\n            eventParams\r\n        }\r\n        return this.eff.applyEffect(state, triggerCtx, game);\r\n    }\r\n\r\n    static isOnEventAbility<E extends EventType>(a:Ability, eventType:E): a is OnEventAbility<E>{\r\n        return a.abilityType === 'onEventAbility' && (a as OnEventAbility<any>).eventType === eventType;\r\n    }\r\n\r\n}\r\n\r\nclass FilteredOnEventAbility<E extends TargetedEventType> extends OnEventAbility<E>{\r\n    filter: PlayerTarget;\r\n\r\n    constructor(eventType:E, eff:Effect, filter: PlayerTarget) {\r\n        super(eventType, eff);\r\n        this.filter = filter\r\n    }\r\n    trigger(state:CardGameState, eventParams: EventParams<E>, ctx:ExecutionContext, game:CardGame):CardGameState{\r\n        if(this.filter.resolveValue(state, ctx, game) != eventParams.player) return state;\r\n        return super.trigger(state, eventParams, ctx, game);\r\n    }\r\n}\r\n\r\nexport function setup(){\r\n    const playerEventTypes:{eventType:TargetedEventType, text:string}[] = [\r\n        {eventType: 'player_draws', text: 'draws? a card'},\r\n    ]\r\n    playerEventTypes.forEach(({eventType, text})=>{\r\n      new TextTemplate('Ability', `When(?:ever) %Player ${text}, %Eff`, (target:PlayerTarget, eff:Effect)=> new FilteredOnEventAbility(eventType, eff, target));\r\n      new TextTemplate('Ability', `When(?:ever) a player ${text}, %Eff`, (eff:Effect)=> new OnEventAbility(eventType, eff));\r\n    });\r\n    new TextTemplate('Ability', `At the start of each turn, %Eff`, (eff:Effect)=> new OnEventAbility('turn_start', eff));\r\n    new TextTemplate('Ability', `At the start of your turn, %Eff`, (eff:Effect)=> new FilteredOnEventAbility('turn_start', eff, resolveActivePlayer));\r\n\r\n    new TextTemplate('Ability', `At the end of each round, %Eff`, (eff:Effect)=> new OnEventAbility('round_end', eff));\r\n}","import TextTemplate, {ChoiceAction, Effect, ExecutionContext, Resolver} from \"../TextTemplate\";\r\nimport CardGame, {CardGameChoiceMove, CardGameState} from \"../../CardGame\";\r\n\r\nexport class ChooseAPlayer implements ChoiceAction{\r\n    eff:Effect;\r\n    constructor(eff:Effect) {\r\n        this.eff = eff;\r\n    }\r\n\r\n    applyEffect(move: CardGameChoiceMove, state: CardGameState, ctx: ExecutionContext, game: CardGame): CardGameState {\r\n        return this.eff.applyEffect(state, {\r\n            ...ctx,\r\n            lastPlayer: move.choice === 1 ? 'playerOne' : 'playerTwo'\r\n        }, game)\r\n    }\r\n\r\n    getChoices(state: CardGameState, ctx:ExecutionContext, game: CardGame):CardGameChoiceMove[]{\r\n        return [{type: 'choice', choice:1}, {type: 'choice', choice: 2}];\r\n    }\r\n\r\n}\r\n\r\nexport function setupChooseAPlayer(){\r\n    new TextTemplate('ChoiceAction', 'Choose a player. %Eff', (eff:Effect)=> new ChooseAPlayer(eff))\r\n}","import TextTemplate, {Effect, ExecutionContext, PlayerTarget, ResolveConstant, Resolver} from \"../TextTemplate\";\r\nimport CardGame, {CardGamePlayerState, CardGameState} from \"../../CardGame\";\r\nimport {Icon, PlayerKey} from \"../../Card\";\r\nimport {MoveDemographicEffect} from \"./MoveDemographicEffect\";\r\n\r\ntype KeysMatching<T, V> = {[K in keyof T]-?: T[K] extends V ? K : never}[keyof T];\r\nexport abstract class MovePlayerEffect extends Effect{\r\n    target:PlayerTarget\r\n    protected constructor(target:PlayerTarget) {\r\n        super();\r\n        this.target=target;\r\n    }\r\n\r\n    abstract shift(pos:{x:number, y:number},state:CardGameState, ctx:ExecutionContext, game:CardGame): {x:number, y: number};\r\n    abstract getIcon(): Icon;\r\n\r\n    applyEffect(state: CardGameState, ctx:ExecutionContext, game:CardGame): CardGameState {\r\n        const playerKey = this.target.resolveValue(state, ctx, game);\r\n\r\n        return   {\r\n            ...state,\r\n            [playerKey]: {\r\n                ...state[playerKey],\r\n                position: this.shift(state[playerKey].position, state, ctx, game)\r\n            }\r\n        }\r\n    }\r\n}\r\nconst MIN_DISTANCE = 0.01;\r\nexport class MovePlayerTowardsPointEffect extends MovePlayerEffect{\r\n    point:Resolver<{x:number, y:number}>\r\n    stepSize:number;\r\n    constructor(target:PlayerTarget, point:Resolver<{x:number, y:number}>,stepSize:number) {\r\n        super(target);\r\n        this.point = point;\r\n        this.stepSize = stepSize;\r\n    }\r\n     static shiftTowardsPoint(point:Resolver<{x:number, y:number}>, stepSize: number, pos: { x: number; y: number }, state:CardGameState, ctx: ExecutionContext, game: CardGame): { x: number; y: number } {\r\n        const target = point.resolveValue(state, ctx, game)\r\n        const deltaX = target.x - pos.x;\r\n        const deltaY = target.y - pos.y;\r\n        const deltaMag = Math.sqrt(deltaX*deltaX + deltaY*deltaY);\r\n        const clampedStepSize = stepSize > 0 ? Math.min(deltaMag - MIN_DISTANCE, stepSize) : stepSize;\r\n        const clamp = (n:number)=>Math.max(-1, Math.min(1, n));\r\n        return {\r\n            x: clamp(pos.x + deltaX/deltaMag * clampedStepSize),\r\n            y: clamp(pos.y + deltaY/deltaMag * clampedStepSize),\r\n        }\r\n    }\r\n    shift(pos: { x: number; y: number }, state:CardGameState, ctx: ExecutionContext, game: CardGame): { x: number; y: number } {\r\n        return MovePlayerTowardsPointEffect.shiftTowardsPoint(this.point, this.stepSize, pos, state, ctx, game);\r\n    }\r\n    getIcon(): Icon{\r\n        return {\r\n            icon: 'move',\r\n            modifier: MoveDemographicEffect.getIconModiferFromPoint(this.point)\r\n        }\r\n    }\r\n\r\n}\r\nexport function setupMovePlayer(){\r\n    new TextTemplate('Eff',\r\n        '%Player shift towards %Position',\r\n        (playerTarget:PlayerTarget, point:Resolver<{x:number, y:number}>)=>new MovePlayerTowardsPointEffect(playerTarget, point, 2/21));\r\n    new TextTemplate('Eff',\r\n        '%Player shift away from %Position',\r\n        (playerTarget:PlayerTarget, point:Resolver<{x:number, y:number}>)=>new MovePlayerTowardsPointEffect(playerTarget, point, -2/21));\r\n\r\n}","import {ExecutionContext, Fizzle, Resolver} from \"../TextTemplate\";\r\nimport {CardGameState} from \"../../CardGame\";\r\n\r\nexport class ContextualExtreme implements Resolver<{ x: number, y: number }> {\r\n    resolveValue(state: CardGameState, ctx: ExecutionContext): { x: number, y: number } {\r\n        if (!ctx.lastExtreme) throw new Fizzle(state)\r\n        return ctx.lastExtreme;\r\n    }\r\n}","import TextTemplate, {Effect, ExecutionContext, PlayerTarget, ResolveConstant, Resolver} from \"../TextTemplate\";\r\nimport CardGame, {CardGamePlayerState, CardGameState} from \"../../CardGame\";\r\nimport {MovePlayerTowardsPointEffect} from \"./MovePlayerEffect\";\r\nimport {ContextualExtreme} from \"../ChoiceActions/ContextualExtreme\";\r\nimport _ from 'lodash'\r\nimport {Icon, IconModifier} from \"../../Card\";\r\n\r\nexport type Point = {x:number, y:number};\r\nexport const EXTREMES = {\r\n    hearts: {x:1, y:-1},\r\n    clubs: {x:-1, y:-1},\r\n    diamonds: {x:1, y:1},\r\n    spades: {x:-1, y:1},\r\n}\r\n\r\nexport abstract class MoveDemographicEffect extends Effect{\r\n    demos:Resolver<number[]>\r\n    protected constructor(demos:Resolver<number[]>) {\r\n        super();\r\n        this.demos=demos;\r\n    }\r\n\r\n    abstract shift(pos:{x:number, y:number},state:CardGameState, ctx:ExecutionContext, game:CardGame): {x:number, y: number};\r\n    abstract getIcon(): Icon;\r\n\r\n    applyEffect(state: CardGameState, ctx:ExecutionContext, game:CardGame): CardGameState {\r\n        const indexes = this.demos.resolveValue(state, ctx, game);\r\n\r\n        return   {\r\n            ...state,\r\n            demographics: state.demographics.map((demo, i)=>indexes.includes(i)\r\n                ? this.shift(demo, state, ctx, game)\r\n                : demo\r\n            )\r\n        }\r\n    }\r\n\r\n    static getIconModiferFromPoint(pointResolver: Resolver<Point>): IconModifier|undefined {\r\n        if(!ResolveConstant.is(pointResolver)){\r\n            return undefined;\r\n        }\r\n        return pointResolver.value === EXTREMES.clubs ? 'clubs' :\r\n            pointResolver.value === EXTREMES.hearts ? 'hearts' :\r\n            pointResolver.value === EXTREMES.diamonds ? 'diamonds' :\r\n            pointResolver.value === EXTREMES.spades ? 'spades' :\r\n            undefined;\r\n    }\r\n}\r\nexport class MoveDemographicTowardsPointEffect extends MoveDemographicEffect{\r\n    point:Resolver<Point>;\r\n    stepSize:number;\r\n    constructor(demos:Resolver<number[]>, point:Resolver<{x:number, y:number}>,stepSize:number) {\r\n        super(demos);\r\n        this.point = point;\r\n        this.stepSize = stepSize;\r\n    }\r\n\r\n    shift(pos: { x: number; y: number }, state:CardGameState, ctx: ExecutionContext, game: CardGame): { x: number; y: number } {\r\n        return MovePlayerTowardsPointEffect.shiftTowardsPoint(this.point, this.stepSize, pos, state, ctx, game);\r\n    }\r\n\r\n    getIcon(): Icon {\r\n        const icon = this.stepSize < 0 ? 'expand' : 'contract';\r\n\r\n        const modifier = MoveDemographicEffect.getIconModiferFromPoint(this.point);\r\n        return {\r\n            icon,\r\n            modifier\r\n        };\r\n    }\r\n\r\n}\r\n\r\nclass resolveAllDemographics implements Resolver<number[]>{\r\n    resolveValue(state: CardGameState, ctx: ExecutionContext){\r\n        return state.demographics.map((_,i)=>i);\r\n    }\r\n}\r\n\r\nclass resolveFollowers implements Resolver<number[]>{\r\n    playerTarget: PlayerTarget\r\n    constructor(playerTarget: PlayerTarget) {\r\n        this.playerTarget = playerTarget;\r\n    }\r\n\r\n    resolveValue(state: CardGameState, ctx: ExecutionContext, game:CardGame){\r\n        const target = this.playerTarget.resolveValue(state, ctx, game) === 'playerOne' ? 1 : 2;\r\n        return state.demographics\r\n            .map((demo,i)=>({demo, i}))\r\n            .filter(({demo})=>game.getDemographicVote(state,demo) === target)\r\n            .map(({i})=>i)\r\n    }\r\n}\r\n\r\nclass resolveUndecided implements Resolver<number[]>{\r\n    resolveValue(state: CardGameState, ctx: ExecutionContext, game:CardGame){\r\n        return state.demographics\r\n            .map((demo,i)=>({demo, i}))\r\n            .filter(({demo})=>game.getDemographicVote(state,demo) === undefined)\r\n            .map(({i})=>i)\r\n    }\r\n}\r\nclass ListDemographic implements Resolver<number[]>{\r\n    a:Resolver<number[]>;\r\n    b:Resolver<number[]>;\r\n\r\n    constructor(a:Resolver<number[]>, b:Resolver<number[]>) {\r\n        this.a = a;\r\n        this.b = b;\r\n    }\r\n\r\n    resolveValue(state: CardGameState, ctx: ExecutionContext, game:CardGame){\r\n        const aDemos = this.a.resolveValue(state, ctx, game);\r\n        const bDemos = this.b.resolveValue(state, ctx, game);\r\n        return _.uniq([...aDemos, ...bDemos]);\r\n    }\r\n}\r\nclass resolveQuadrantDemographics implements Resolver<number[]>{\r\n    point:Resolver<{x:number, y:number}>\r\n    demos:Resolver<number[]>;\r\n\r\n    constructor(demos: Resolver<number[]>, point: Resolver<{ x: number; y: number }>) {\r\n        this.point = point;\r\n        this.demos = demos\r\n    }\r\n    resolveValue(state: CardGameState, ctx: ExecutionContext, game:CardGame){\r\n        const {x,y} = this.point.resolveValue(state, ctx, game);\r\n        const inQuad = state.demographics\r\n            .map((demo,i)=>({demo, i}))\r\n            .filter(({demo})=> Math.sign(x)===Math.sign(demo.x) && Math.sign(y)===Math.sign(demo.y))\r\n            .map(({i})=>i)\r\n        const inSource = this.demos.resolveValue(state, ctx, game);\r\n        return _.intersectionWith(inQuad, inSource);\r\n    }\r\n}\r\n\r\nexport class ResolvePlayerPosition implements Resolver<{x:number, y:number}>{\r\n        playerTarget: PlayerTarget\r\n    constructor(playerTarget: PlayerTarget) {\r\n        this.playerTarget = playerTarget;\r\n    }\r\n\r\n  resolveValue(state: CardGameState, ctx: ExecutionContext, game:CardGame) {\r\n    const target = this.playerTarget.resolveValue(state, ctx, game)\r\n    return state[target].position;\r\n  }\r\n}\r\n\r\nexport function setupMoveDemographics(){\r\n    new TextTemplate('Demos', '(?:All )demographics', () => new resolveAllDemographics());\r\n    new TextTemplate('Demos', '%Player followers', (playerTarget:PlayerTarget) => new resolveFollowers(playerTarget));\r\n    new TextTemplate('Demos', 'undecided voters', () => new resolveUndecided());\r\n    new TextTemplate('Demos', `%Demos in that quadrant`, (demos:Resolver<number[]>) => new resolveQuadrantDemographics(demos, new ContextualExtreme()));\r\n    new TextTemplate('Demos', '%Demos and %Demos', (a:Resolver<number[]>, b:Resolver<number[]>) => new ListDemographic(a,b));\r\n\r\n\r\n    Object.entries(EXTREMES).forEach(([extreme, position]) => {\r\n        new TextTemplate('Position', `the ${extreme} (?:extreme|quadrant)`, () => new ResolveConstant(position, 'lastExtreme'));\r\n        new TextTemplate('Demos', `%Demos in the ${extreme} quadrant`, (demos:Resolver<number[]>) => new resolveQuadrantDemographics(demos, new ResolveConstant(position, 'lastExtreme')))\r\n    });\r\n\r\n    new TextTemplate('Position', 'the cente?re?', () => new ResolveConstant({x:0, y:0}));\r\n    new TextTemplate('Position', '%Player', (playerTarget:PlayerTarget) => new ResolvePlayerPosition(playerTarget));\r\n\r\n    new TextTemplate('Eff',\r\n        '%Demos shift towards %Position',\r\n        (demos:Resolver<number[]>, point:Resolver<{x:number, y:number}>)=>new MoveDemographicTowardsPointEffect(demos, point, 2/21));\r\n    new TextTemplate('Eff',\r\n        '%Demos shift away from %Position',\r\n        (demos:Resolver<number[]>, point:Resolver<{x:number, y:number}>)=>new MoveDemographicTowardsPointEffect(demos, point, -2/21));\r\n\r\n}","import TextTemplate, {ChoiceAction, Effect, ExecutionContext} from \"../TextTemplate\";\r\nimport CardGame, {CardGameChoiceMove, CardGameState} from \"../../CardGame\";\r\nimport {EXTREMES} from \"../Effects/MoveDemographicEffect\";\r\nimport {ContextualExtreme} from \"./ContextualExtreme\";\r\n\r\nconst EXTREMES_BY_ID = {\r\n    1: EXTREMES.hearts,\r\n    2: EXTREMES.clubs,\r\n    3: EXTREMES.diamonds,\r\n    4: EXTREMES.spades\r\n};\r\nexport const ID_BY_EXTREME:Record<string, number> = {\r\n    'hearts': 1,\r\n    'clubs': 2,\r\n    'diamonds':3,\r\n    'spades': 4\r\n}\r\n\r\nexport class ChooseAnExtreme implements ChoiceAction{\r\n    eff:Effect;\r\n    constructor(eff:Effect) {\r\n        this.eff = eff;\r\n    }\r\n\r\n    applyEffect(move: CardGameChoiceMove, state: CardGameState, ctx: ExecutionContext, game: CardGame): CardGameState {\r\n        return this.eff.applyEffect(state, {\r\n            ...ctx,\r\n            lastExtreme: EXTREMES_BY_ID[move.choice as 1|2|3|4]\r\n        }, game)\r\n    }\r\n\r\n    getChoices(state: CardGameState, ctx:ExecutionContext, game: CardGame):CardGameChoiceMove[]{\r\n        return [{type: 'choice', choice:1}, {type: 'choice', choice: 2},{type: 'choice', choice:3}, {type: 'choice', choice: 4}];\r\n    }\r\n\r\n}\r\n\r\nexport function setupChooseAnExtreme(){\r\n    new TextTemplate('ChoiceAction', 'Choose an extreme. %Eff', (eff:Effect)=> new ChooseAnExtreme(eff))\r\n    new TextTemplate('Position', 'that extreme', (e)=> new ContextualExtreme())\r\n}","import TextTemplate, {ChoiceAction, Effect, ExecutionContext, Resolver} from \"../TextTemplate\";\r\nimport CardGame, {CardGameChoiceMove, CardGameState} from \"../../CardGame\";\r\n\r\nexport class ChooseOne implements ChoiceAction{\r\n    a:Effect;\r\n    b:Effect;\r\n    aText:string;\r\n    bText: string;\r\n    constructor(a:Effect, b:Effect, aText:string, bText: string) {\r\n        this.a = a;\r\n        this.b = b;\r\n        this.aText = aText;\r\n        this.bText = bText;\r\n    }\r\n\r\n    applyEffect(move: CardGameChoiceMove, state: CardGameState, ctx: ExecutionContext, game: CardGame): CardGameState {\r\n        const eff = move.choice === 1 ? this.a : this.b;\r\n        return eff.applyEffect(state, ctx, game)\r\n    }\r\n\r\n    getChoices(state: CardGameState, ctx:ExecutionContext, game: CardGame):CardGameChoiceMove[]{\r\n        return [{type: 'choice', choice:1}, {type: 'choice', choice: 2}];\r\n    }\r\n}\r\n\r\nexport function setupChooseOne(){\r\n    new TextTemplate('ChoiceAction', 'Choose one: %Eff or %Eff', (a:Effect, b:Effect, [aText, bText]:string[])=> new ChooseOne(a, b, aText, bText))\r\n}","import TextTemplate, {Effect, ExecutionContext, PlayerTarget, Resolver} from \"../TextTemplate\";\r\nimport CardGame, {CardGamePlayerState, CardGameState} from \"../../CardGame\";\r\nimport {PlayerKey} from \"../../Card\";\r\n\r\nexport class PlayerInQuadrantCondition implements Resolver<boolean>{\r\n    target:PlayerTarget;\r\n    extreme: Resolver<{x:number, y:number}>;\r\n    constructor(target:PlayerTarget, extreme: Resolver<{x:number, y:number}>) {\r\n        this.target = target;\r\n        this.extreme = extreme;\r\n    }\r\n    resolveValue(state: CardGameState, ctx: ExecutionContext, game:CardGame){\r\n        const quad = this.extreme.resolveValue(state, ctx, game);\r\n        const playerKey = this.target.resolveValue(state, ctx, game);\r\n        const {position} = state[playerKey];\r\n        return Math.sign(position.x) === Math.sign(quad.x) && Math.sign(position.y) === Math.sign(quad.y)\r\n    }\r\n}\r\n\r\nexport default function setupPlayerPositionCondition(){\r\n    new TextTemplate(\r\n        'Cond',\r\n        '%Player (?:is|are) in %Position',\r\n        (target:PlayerTarget, pos:Resolver<{x:number, y:number}>) => new PlayerInQuadrantCondition(target, pos)\r\n    );\r\n}","import {setupListEffects} from './Effects/ListEffect';\r\nimport setupDraw from './Effects/RandomTransferEffect';\r\nimport setupDamage from './Effects/ChangePlayerValue';\r\nimport setupConditional from './Effects/ConditionalEffect'\r\nimport setupLessThan from './GameConditions/PlayerLessThanCondition'\r\nimport {setup as setupEventAbilities} from './Abilities/OnEventAbility'\r\nimport TextTemplate, {Effect, ExecutionContext, PlayerTarget} from \"./TextTemplate\";\r\nimport {PlayerKey} from \"../Card\";\r\nimport numberToWords from 'number-to-words';\r\nimport {setupChooseAPlayer} from \"./ChoiceActions/ChooseAPlayer\";\r\nimport {setupMoveDemographics} from './Effects/MoveDemographicEffect'\r\nimport {setupMovePlayer} from \"./Effects/MovePlayerEffect\";\r\nimport {setupChooseAnExtreme} from \"./ChoiceActions/ChooseAnExtreme\";\r\nimport {setupChooseOne} from \"./ChoiceActions/ChooseOne\";\r\nimport setupPlayerPositionCondition from \"./GameConditions/PlayerPositionCondition\";\r\n\r\nexport interface HasTarget{\r\n    target: PlayerTarget;\r\n}\r\n\r\nexport function hasTarget(x:any):x is HasTarget{\r\n    return x.hasOwnProperty(\"target\");\r\n}\r\n\r\nexport const resolveActivePlayer:PlayerTarget = {\r\n    resolveValue(_, ctx:ExecutionContext):PlayerKey {\r\n        ctx.lastPlayer = ctx.playerKey;\r\n        return ctx.playerKey;\r\n    }\r\n}\r\nexport const resolveOpponent:PlayerTarget = {\r\n    resolveValue(_, ctx):PlayerKey {\r\n        const target =  ctx.playerKey === 'playerOne' ? 'playerTwo' : 'playerOne';\r\n        ctx.lastPlayer = target;\r\n        return target;\r\n    }\r\n}\r\nexport const resolvePlayerContextually:PlayerTarget = {\r\n    resolveValue(_, ctx):PlayerKey {\r\n        return ctx.lastPlayer || ctx.playerKey\r\n    }\r\n}\r\n\r\n\r\nexport default function setupEffects() {\r\n        new TextTemplate('N',`a`,()=>1)\r\n    for(let n = 0; n < 25;n++){\r\n        new TextTemplate('N',numberToWords.toWords(n),()=>n)\r\n        new TextTemplate('N',`${n}`,()=>n)\r\n    }\r\n    new TextTemplate('Player','yourself',()=>resolveActivePlayer)\r\n    new TextTemplate('Player','you',()=>resolveActivePlayer)\r\n    new TextTemplate('Player','your',()=>resolveActivePlayer)\r\n    new TextTemplate('Player','your opponent',()=>resolveOpponent)\r\n    new TextTemplate('Player','your opponent\\'?s',()=>resolveOpponent)\r\n    new TextTemplate('Player','the other player',()=>resolveOpponent)\r\n    new TextTemplate('Player','they',()=>resolvePlayerContextually)\r\n    new TextTemplate('Player','them',()=>resolvePlayerContextually)\r\n    new TextTemplate('Player','their',()=>resolvePlayerContextually)\r\n    new TextTemplate('Player','that player',()=>resolvePlayerContextually)\r\n    new TextTemplate('Player','',()=>resolvePlayerContextually)\r\n    new TextTemplate('Eff','%Eff again',(e:Effect)=>e)\r\n    setupListEffects();\r\n    setupDraw();\r\n    setupDamage();\r\n    setupConditional();\r\n    setupLessThan();\r\n    setupEventAbilities();\r\n    setupMoveDemographics();\r\n    setupChooseAPlayer();\r\n    setupMovePlayer();\r\n    setupChooseAnExtreme();\r\n    setupChooseOne()\r\n    setupPlayerPositionCondition()\r\n}","import _ from 'lodash';\r\n\r\nexport function createStartingDemographics(): { x: number, y: number }[] {\r\n    /*\r\n    return new Array(500).fill(0).map(()=>({\r\n\r\n        x: Math.random()*2-1,\r\n        y: Math.random()*2-1,\r\n    }))\r\n    */\r\n    const RAND_COUNT = 6;\r\n    const randoms = new Array(RAND_COUNT).fill(0).map(()=>({\r\n           x: Math.random()*0.9,\r\n           y: Math.random()*0.9\r\n       }))\r\n   const eighth =  [\r\n       {x: 0.2001, y:0},\r\n         {x: 0.15, y: 0.15}, {x: 0.4, y: 0.1}, {x: 0.7, y: 0.1},\r\n         {x:0.05, y:0.05}, {x:0.3, y:0.3}, {x:0.45, y:0.45}, {x:0.75, y:0.7},\r\n         {x: 0, y: 0.9}, {x: 0.1, y: 0.9},\r\n        {x: 0, y: 0},  {x: 0.4, y:0},\r\n       ...randoms\r\n      ]\r\n   const quadrant=  flipAcrossDiagonal(eighth);\r\n   const all = reflectAcrossBothAxes(quadrant);\r\n   return mergeByDistance(all)\r\n}\r\n\r\nfunction flipAcrossDiagonal(eight: { x: number, y: number }[] ): { x: number, y: number }[] {\r\n   return eight.flatMap(coord => ([\r\n       coord,\r\n      {x:coord.y, y:coord.x}\r\n   ]));\r\n\r\n}\r\nfunction reflectAcrossBothAxes(quadrant: { x: number, y: number }[] ): { x: number, y: number }[] {\r\n   return quadrant.flatMap(coord => ([\r\n       coord,\r\n      {x: -1 *coord.x, y: coord.y},\r\n      {x: coord.x, y: -1 *coord.y},\r\n      {x: -1 *coord.x, y: -1 *coord.y}\r\n   ]));\r\n}\r\n\r\nfunction mergeByDistance(points: { x: number, y: number }[], thresholdSquared=0.005 ): { x: number, y: number }[] {\r\n    const pointGroups:{ x: number, y: number }[][] = []\r\n    for(let point of points){\r\n        let putInGroup = false;\r\n        for(let group of pointGroups){\r\n            const [other] = group;\r\n            const dx = other.x - point.x;\r\n            const dy = other.y - point.y;\r\n            const distSquared = dx*dx + dy*dy;\r\n            if(distSquared < thresholdSquared){\r\n               group.push(point);\r\n               putInGroup = true;\r\n               break;\r\n            }\r\n        }\r\n        if(!putInGroup){\r\n            pointGroups.push([point]);\r\n        }\r\n    }\r\n    return pointGroups.map(group => group.map(({x,y})=>({x:x/group.length,y:y/group.length})).reduce((a,b)=>({\r\n        x: a.x + b.x,\r\n        y: a.y + b.y,\r\n    })))\r\n}","import {Game, GameStatus} from \"../mcts/mcts\";\r\nimport chalk from 'chalk'\r\nimport {Card, ChoiceActionCard, EffectCard, ItemCard, PlayerKey} from \"./Card\";\r\nimport {DrawCardEffect} from \"./Components/Effects/RandomTransferEffect\";\r\nimport {resolveActivePlayer, resolveOpponent} from \"./Components/setup\";\r\nimport TextTemplate, {ChoiceAction, Fizzle} from \"./Components/TextTemplate\";\r\nimport {ConditionalEffect} from \"./Components/Effects/ConditionalEffect\";\r\nimport {EventParams, EventType, OnEventAbility} from \"./Components/Abilities/OnEventAbility\";\r\nimport _ from 'lodash'\r\nimport {createStartingDemographics} from \"./CreateStartingDemographics\";\r\nimport ListEffect from \"./Components/Effects/ListEffect\";\r\nimport {ChangePlayerValue} from \"./Components/Effects/ChangePlayerValue\";\r\n\r\n\r\nexport type CardGameChain = CardGameMove|CardGameMove[]\r\n\r\nexport interface CardGamePlayerState {\r\n    readonly popularity: number;\r\n    readonly capital: number;\r\n    readonly position: {readonly x: number,  readonly y: number};\r\n    readonly hand: readonly number[];\r\n    readonly board: readonly number[];\r\n    readonly discardPile: readonly number[];\r\n    readonly deck: readonly number[];\r\n}\r\nexport type CardGameReturnState = Omit<CardGameState, \"cancelState\">\r\n\r\nexport interface CardGameState {\r\n    readonly activePlayer: 1|2;\r\n    readonly isFirstTurn: boolean;\r\n    readonly step: 'draw'|'play'|'choice'\r\n    readonly roundsUntilElection: number;\r\n    readonly cardPlayedThisTurn: boolean;\r\n    readonly endRoundAfterThisTurn: boolean;\r\n    readonly demographics: readonly {x:number, y:number}[]\r\n    readonly playerOne: CardGamePlayerState\r\n    readonly playerTwo: CardGamePlayerState;\r\n    readonly cardBeingPlayed?:number,\r\n    readonly log?:string[],\r\n    readonly cancelState?: CardGameReturnState,\r\n}\r\n\r\ninterface CardGamePlayCardMove {type:\"play\"; cardNumber:number}\r\ninterface CardGameDiscardCardMove{type:\"discard\"; cardNumber:number}\r\ninterface CardGameEndMove {type:\"end\"}\r\ninterface CardGameCancelMove {type:\"cancel\"}\r\nexport interface CardGameChoiceMove {type:\"choice\", choice:number}\r\nexport type CardGameMove = CardGameEndMove | CardGamePlayCardMove | CardGameDiscardCardMove | CardGameChoiceMove | CardGameCancelMove;\r\n\r\nexport const POP_RANGE = 1/75;\r\n\r\nconst PASS_TURN_DRAW_EFFECT = new ListEffect(\r\n    new ChangePlayerValue(resolveOpponent, 1, 'popularity'),\r\n    new DrawCardEffect(resolveOpponent, 1)\r\n)\r\n\r\nexport default class CardGame extends Game<CardGameState, CardGameMove>{\r\n\r\n    cardIndex:Record<number, Card>;\r\n    deckOne:number[];\r\n    deckTwo:number[];\r\n    static STARTING_HAND_SIZE: number = 6;\r\n\r\n    constructor(cardIndex:Record<number,Card>, deckOne?:number[], deckTwo?:number[]){\r\n        super();\r\n        this.cardIndex = cardIndex;\r\n        this.deckOne = deckOne ? deckOne : Object.keys(this.cardIndex).map(i=>parseFloat(i));\r\n        this.deckTwo = deckTwo ? deckTwo : this.deckOne;\r\n    }\r\n\r\n    applyMove(state: CardGameState, move: CardGameMove): CardGameState {\r\n        if(move.type === \"end\"){\r\n            return this.onTurnEnd(state);\r\n        }else if(move.type === \"play\"){\r\n            return this.applyCardPlay(state, move.cardNumber);\r\n        }else if(move.type === \"discard\"){\r\n            return this.applyCardDiscard(state, move.cardNumber)\r\n        }else if(move.type === \"choice\"){\r\n            return this.applyChoiceMove(state, move)\r\n        }else if(move.type === \"cancel\"){\r\n            return this.applyCancelMove(state)\r\n        }\r\n        throw new Error(\"Unknown move\")\r\n    }\r\n\r\n    getSensibleMoves(state: CardGameState): CardGameChain[] {\r\n        if(state.roundsUntilElection === 1 && state.endRoundAfterThisTurn){\r\n            const votes = this.getVotes(state);\r\n            if(votes[state.activePlayer] > votes[(3-state.activePlayer) as 1|2]) return [{type:'end'}]\r\n        }\r\n        if(state.cardPlayedThisTurn) return [{type:'end'}]\r\n        return this.getCardMoves(state).filter((chain)=>{\r\n            const cardNumber = Array.isArray(chain) ? chain[0].cardNumber : chain.cardNumber;\r\n            if(!this.cardIndex[cardNumber]){\r\n               throw new Error(\"Can't find card \"+cardNumber)\r\n            }\r\n            const {effect} = (this.cardIndex[cardNumber] as EffectCard);\r\n            if(effect?.constructor.name !== \"ConditionalEffect\") {\r\n                return true;\r\n            }\r\n            const {condition} = (effect as ConditionalEffect)\r\n            const playerKey = state.activePlayer === 1 ? 'playerOne' : 'playerTwo';\r\n            return condition.resolveValue(state,{playerKey}, this)\r\n        })\r\n    }\r\n\r\n    getDemographicVote(state:CardGameState, pos:{x:number, y:number}):1|2|undefined{\r\n        const MARGIN = 0.002;\r\n\r\n        const bPop = state.playerOne.popularity;\r\n        const rPop = state.playerTwo.popularity;\r\n\r\n        const bdistSquared = Math.pow(state.playerOne.position.x - pos.x, 2) +  Math.pow(state.playerOne.position.y - pos.y, 2)\r\n        const rdistSquared = Math.pow(state.playerTwo.position.x - pos.x, 2) +  Math.pow(state.playerTwo.position.y - pos.y, 2)\r\n\r\n        const rScore =  rPop * POP_RANGE - rdistSquared;\r\n        const bScore =  bPop * POP_RANGE -  bdistSquared;\r\n\r\n        if(bScore - MARGIN > rScore && bScore > 0.0) return 1;\r\n        if(rScore - MARGIN > bScore && rScore > 0.0) return 2;\r\n        return undefined;\r\n    }\r\n\r\n    getVotes(state:CardGameState):{1:number, 2:number}{\r\n        const votes =  _.chain(state.demographics)\r\n            .map(pos=>this.getDemographicVote(state, pos))\r\n            .filter(_.identity)\r\n            .countBy()\r\n            .value() as {1:number, 2:number}\r\n        return {\r\n            1: votes[1]||0,\r\n            2: votes[2]||0\r\n        };\r\n    }\r\n\r\n    getStatus(state: CardGameState): GameStatus {\r\n        if(state.roundsUntilElection > 0) return GameStatus.IN_PLAY;\r\n        const votes = this.getVotes(state);\r\n        if(votes[1] > votes[2]) return GameStatus.WIN;\r\n        if(votes[1] < votes[2]) return GameStatus.LOSE;\r\n        return GameStatus.DRAW;\r\n    }\r\n\r\n    getValidMoves(state: CardGameState): (CardGameChain)[] {\r\n        if(state.cardBeingPlayed!==undefined){\r\n            const playerKey = state.activePlayer  === 1 ? 'playerOne' : 'playerTwo';\r\n            const card = this.cardIndex[state.cardBeingPlayed];\r\n            if(!ChoiceActionCard.is(card)) throw new Error(\"Not a choice card!\")\r\n            return card.choiceAction.getChoices(state, {playerKey}, this);\r\n        }\r\n        if(state.step === 'draw') return this.getDiscardMoves(state);\r\n        return [{type:\"end\"}, ...this.getCardMoves(state)]\r\n    }\r\n\r\n    newGame(): CardGameState {\r\n        const newPlayer = {\r\n            hand:[],\r\n            discardPile:[],\r\n            board:[],\r\n            capital: 3,\r\n            popularity: 22,\r\n        }\r\n        const preGame:CardGameState = {\r\n            activePlayer: 1,\r\n            roundsUntilElection: 4,\r\n            demographics: createStartingDemographics(),\r\n            endRoundAfterThisTurn: false,\r\n            cardPlayedThisTurn: false,\r\n            step: 'play',\r\n            isFirstTurn: true,\r\n            playerOne:{\r\n                ...newPlayer,\r\n                deck: this.deckOne,\r\n                position:{x:0.2, y:0},\r\n            },\r\n            playerTwo:{\r\n                ...newPlayer,\r\n                deck: this.deckTwo,\r\n                position:{x:-0.2, y:0},\r\n            }\r\n        };\r\n        const blueDrawCardsEffect = new DrawCardEffect(resolveActivePlayer, CardGame.STARTING_HAND_SIZE - 1);\r\n        const redDrawCardsEffect = new DrawCardEffect(resolveActivePlayer, CardGame.STARTING_HAND_SIZE);\r\n        const p1Draw =  blueDrawCardsEffect.applyEffect(preGame,{playerKey: \"playerOne\"}, this);\r\n        return redDrawCardsEffect.applyEffect(p1Draw,{playerKey: \"playerTwo\"}, this);\r\n    }\r\n\r\n    print( {playerOne, playerTwo, ...state}: CardGameState): void {\r\n        console.log(chalk.white(JSON.stringify(state,null,4)))\r\n        console.log(chalk.blue(JSON.stringify(playerOne,null,4)))\r\n        console.log(chalk.red(JSON.stringify(playerTwo,null,4)))\r\n    }\r\n\r\n    randomizeHiddenInfo(state: CardGameState): CardGameState {\r\n        const opponentKey = state.activePlayer === 1 ? 'playerTwo' : 'playerOne'\r\n\r\n        // Put their hand back into the deck, then draw up to the same number\r\n        const deck = [...state[opponentKey].deck, ...state[opponentKey].hand];\r\n        const hand = []\r\n        for(let i = 0; i < state[opponentKey].hand.length; i++){\r\n           const drawIndex = Math.floor(Math.random() * deck.length);\r\n            hand.push(...deck.splice(drawIndex, 1))\r\n        }\r\n\r\n        return {\r\n            ...state,\r\n            [opponentKey]:{\r\n                ...state[opponentKey],\r\n                hand,\r\n                deck\r\n            }\r\n        };\r\n    }\r\n\r\n     getCardMoves(state: CardGameState):(CardGamePlayCardMove|[CardGamePlayCardMove,CardGameChoiceMove])[] {\r\n        if(state.step != 'play') return [];\r\n        const playerKey = state.activePlayer === 1 ? 'playerOne' : 'playerTwo';\r\n        const activePlayer = state[playerKey];\r\n        return _.flatMap(activePlayer.hand, cardNumber=>{\r\n            const playMove:CardGamePlayCardMove = {type:\"play\", cardNumber};\r\n            const card = this.cardIndex[cardNumber];\r\n            if(ChoiceActionCard.is(card)){\r\n                const choices:CardGameChoiceMove[] =  card.choiceAction.getChoices(state, {playerKey} , this);\r\n                const chain = choices.map(choice => [playMove, choice] as [CardGamePlayCardMove,CardGameChoiceMove])\r\n                return chain as (CardGamePlayCardMove|[CardGamePlayCardMove,CardGameChoiceMove])[]\r\n            }\r\n            return [playMove];\r\n        })\r\n    }\r\n   private getDiscardMoves(state: CardGameState):CardGameDiscardCardMove[] {\r\n        if(state.step != 'draw') return [];\r\n        const activePlayer = state.activePlayer === 1 ? state.playerOne : state.playerTwo;\r\n        return activePlayer.hand.map(cardNumber=>({type:\"discard\", cardNumber}))\r\n    }\r\n\r\n    private onTurnEnd(state: CardGameState):CardGameState {\r\n        const activePlayer = state.activePlayer === 1 ? 2 : 1;\r\n        const playerKey = activePlayer  === 1 ? 'playerOne' : 'playerTwo';\r\n        const roundEnding = state.endRoundAfterThisTurn;\r\n        const afterRoundUpdateState =  roundEnding ? this.onRoundEnd(state) : state;\r\n        const shouldDraw = !roundEnding && !state.cardPlayedThisTurn && state[playerKey].popularity > 0;\r\n        const afterDraw = shouldDraw ? PASS_TURN_DRAW_EFFECT.applyEffectNoFizzle(afterRoundUpdateState, {playerKey}, this) : afterRoundUpdateState;\r\n        const afterTurnEndState:CardGameState =  {\r\n            ...afterDraw,\r\n            step: 'play',\r\n            cardPlayedThisTurn: false,\r\n            isFirstTurn: false,\r\n            endRoundAfterThisTurn: !state.cardPlayedThisTurn && !roundEnding,\r\n            activePlayer,\r\n        }\r\n        return this.processEvent(afterTurnEndState, 'turn_start',{player:playerKey})\r\n    }\r\n\r\n    private applyCardPlay(state: CardGameState, cardNumber: number):CardGameState {\r\n        const card = this.cardIndex[cardNumber];\r\n        return card.play(state, cardNumber, this)\r\n    }\r\n    private applyCardDiscard(state: CardGameState, cardNumber: number):CardGameState {\r\n        const playerKey = state.activePlayer  === 1 ? 'playerOne' : 'playerTwo';\r\n        const player = state[playerKey];\r\n\r\n        const hand = [...player.hand];\r\n        const discardPile = [...player.discardPile];\r\n        discardPile.push(...hand.splice(hand.indexOf(cardNumber), 1))\r\n        return {\r\n            ...state,\r\n            step: hand.length > CardGame.STARTING_HAND_SIZE ? 'draw' :'play',\r\n            [playerKey]:{\r\n                ...player,\r\n                hand,\r\n                discardPile\r\n            }\r\n        }\r\n    }\r\n\r\n    getHeuristic(state: CardGameState):number {\r\n        const votes = this.getVotes(state)\r\n        const bluePoints = votes[1] + 2 * state.playerOne.capital + 0.1 * state.playerOne.hand.length;\r\n        const redPoints = votes[2] + 2 * state.playerOne.capital + 0.1 * state.playerOne.hand.length;\r\n        if(bluePoints === redPoints) return 0;\r\n        return (bluePoints-redPoints)/(redPoints+bluePoints)\r\n    }\r\n\r\n\r\n    processEvent<E extends EventType>(baseState:CardGameState, eventType:E, eventParams: EventParams<E>):CardGameState{\r\n        if(this.getStatus(baseState) != GameStatus.IN_PLAY) return baseState\r\n\r\n        let state = baseState;\r\n        const playerKeys:PlayerKey[] = ['playerOne', 'playerTwo'];\r\n        playerKeys.forEach((playerKey:PlayerKey)=>{\r\n            const itemCardsInPlay = baseState[playerKey].board\r\n                .map(n=>this.cardIndex[n])\r\n                .filter(c=>ItemCard.isItemCard(c)) as ItemCard[]\r\n\r\n            const listeners = itemCardsInPlay\r\n                .map(c=>c.ability)\r\n                .filter(a=>OnEventAbility.isOnEventAbility(a, eventType)) as OnEventAbility<E>[]\r\n\r\n            listeners.forEach(listener=>{\r\n                try{\r\n                    state = listener.trigger(state, eventParams, {playerKey}, this);\r\n                }catch(e){\r\n                    if(!Fizzle.isFizzle(e)) throw e;\r\n                    state = e.returnState;\r\n                }\r\n            })\r\n        })\r\n\r\n        return state;\r\n    }\r\n\r\n    private applyChoiceMove(state: CardGameState, move: CardGameChoiceMove):CardGameState {\r\n        const playerKey = state.activePlayer  === 1 ? 'playerOne' : 'playerTwo';\r\n        const card = this.cardIndex[state.cardBeingPlayed!];\r\n        if(!ChoiceActionCard.is(card)) {\r\n            throw new Error(`${state.cardBeingPlayed} Not a choice card!`)\r\n        }\r\n        const stateAfterEffects = (()=>{\r\n            try{\r\n                return card.choiceAction.applyEffect(move, state, {playerKey}, this);\r\n            }catch(e){\r\n                if(!Fizzle.isFizzle(e))throw e;\r\n                return e.returnState;\r\n            }\r\n        })();\r\n        return {\r\n            ...stateAfterEffects,\r\n            step: 'play',\r\n            cardBeingPlayed: undefined,\r\n            cancelState: undefined\r\n        }\r\n    }\r\n\r\n    private onRoundEnd(state: CardGameState):CardGameState {\r\n        const afterEvents:CardGameState =  {\r\n            ...this.processEvent(state, 'round_end', {}),\r\n            roundsUntilElection: state.roundsUntilElection - 1,\r\n            endRoundAfterThisTurn: false,\r\n        };\r\n        if(afterEvents.roundsUntilElection === 0) return afterEvents;\r\n        const updatePlayer = (player:CardGamePlayerState) => ({\r\n            ...player,\r\n            capital: player.capital + 1,\r\n            hand: []\r\n        })\r\n        const newState:CardGameState = {\r\n            ...afterEvents,\r\n            playerOne: updatePlayer(afterEvents.playerOne),\r\n            playerTwo: updatePlayer(afterEvents.playerTwo),\r\n        }\r\n        const drawEffect = new DrawCardEffect(resolveActivePlayer, 6)\r\n        return drawEffect.applyEffectNoFizzle(drawEffect.applyEffectNoFizzle(newState, {playerKey:'playerTwo'}, this), {playerKey:'playerOne'}, this);\r\n    }\r\n\r\n    getActiveActionChoice(state:CardGameState): ChoiceAction|undefined{\r\n        if(state.cardBeingPlayed === undefined) return undefined;\r\n        const card = this.cardIndex[state.cardBeingPlayed];\r\n        if(!ChoiceActionCard.is(card)) throw new Error(\"Not a choice card!\")\r\n        return card.choiceAction\r\n    }\r\n\r\n    private applyCancelMove(state: CardGameState): CardGameState {\r\n        const playerKey = state.activePlayer  === 1 ? 'playerOne' : 'playerTwo';\r\n        const card = this.cardIndex[state.cardBeingPlayed!];\r\n        if(!ChoiceActionCard.is(card)) {\r\n            throw new Error(`${state.cardBeingPlayed} Not a choice card!`)\r\n        }\r\n        return card.cancel(state);\r\n    }\r\n}","import React, {CSSProperties, useEffect} from 'react'\r\n\r\nconst ARROW_STYLE:CSSProperties= {\r\n    boxSizing: 'border-box',\r\n    position:'absolute',\r\n    background: 'orange',\r\n    width: 14,\r\n    zIndex: 1,\r\n    left: 10,\r\n    top: 90,\r\n    marginBottom: 100,\r\n    transformOrigin:'top',\r\n    display: 'flex',\r\n    flexDirection: \"column-reverse\",\r\n    alignItems: \"center\",\r\n    cursor: 'none',\r\n    pointerEvents: 'none',\r\n}\r\n\r\nconst HEAD_STYLE:CSSProperties= {\r\n    position: 'relative',\r\n    top: 10,\r\n    borderLeft: '20px solid transparent',\r\n    borderRight: '20px solid transparent',\r\n    borderTop: '20px solid orange',\r\n    cursor: 'none',\r\n    pointerEvents: 'none',\r\n}\r\n\r\nconst XOFFSET = 20;\r\nconst YOFFSET = -45;\r\n\r\nconst ChoiceArrow:React.FunctionComponent = ()=>{\r\n    const [height, setHeight] = React.useState(100)\r\n    const [theta, setTheta] = React.useState(45)\r\n    const element = React.useRef<HTMLDivElement>(null);\r\n    const dynamicStyle:CSSProperties = {\r\n        height,\r\n        transform: `rotate(${theta}rad)`\r\n    }\r\n\r\n    useEffect(()=>{\r\n        const listener = (event:MouseEvent)=>{\r\n            if(!element.current) return;\r\n            const domRect = element.current.getBoundingClientRect();\r\n            const deltaX = event.clientX - domRect.x - XOFFSET;\r\n            const deltaY = event.clientY - domRect.y - YOFFSET;\r\n            const theta = Math.atan2(-deltaX, deltaY);\r\n            const height = Math.sqrt(deltaX*deltaX+deltaY*deltaY)\r\n\r\n            setTheta(theta)\r\n            setHeight(height)\r\n        };\r\n        window.addEventListener('mousemove',listener)\r\n        return ()=>window.removeEventListener('mousemove', listener)\r\n    },[element])\r\n    return <div  ref={element}>\r\n        <div style={{...ARROW_STYLE, ...dynamicStyle}}>\r\n            <div style={HEAD_STYLE}/>\r\n        </div>\r\n    </div>\r\n}\r\n\r\nexport default ChoiceArrow;","import React, {useState} from \"react\";\r\n\r\ntype ReactHoverDelayTriggerProps = React.PropsWithChildren< {\r\n    delay: number,\r\n    className?:string,\r\n    handleHoverTrigger: ()=>void,\r\n    handleHoverCancel: ()=>void,\r\n}>\r\nexport default function DelayHover(props:ReactHoverDelayTriggerProps):JSX.Element {\r\n    const [tId, setTId] = useState(0)\r\n    const [hovered, setHovered] = useState(false)\r\n    const {handleHoverCancel, className} = props;\r\n    React.useEffect(()=>{\r\n        //do Nothing\r\n        return ()=>handleHoverCancel();\r\n    },[]);\r\n    return <span\r\n        className={className}\r\n        style={{pointerEvents:'auto'}}\r\n        onMouseOver={()=>{\r\n            if(!hovered){\r\n                const i = window.setTimeout(()=>{\r\n                    props.handleHoverTrigger()\r\n                }, props.delay)\r\n                setHovered(true)\r\n                setTId(i);\r\n            }\r\n        }}\r\n         onMouseOut={()=>{\r\n            clearTimeout(tId)\r\n            setHovered(false)\r\n            props.handleHoverCancel()\r\n        }}\r\n    >\r\n        {props.children}\r\n    </span>\r\n}","import React, {CSSProperties, useEffect} from 'react';\r\nimport {Card, Icon} from \"../cardgame/Card\";\r\nimport _ from 'lodash';\r\n\r\nfunction importAll(r:any) {\r\n  const moduleArr =  r.keys().map((x:any)=>({\r\n      key: x.match(/[\\w-]*(?=\\.png)/)[0],\r\n      icon: r(x).default,\r\n  }));\r\n  return _.chain(moduleArr).keyBy('key').mapValues('icon').value();\r\n}\r\n\r\nconst icons = importAll((require as any).context('./assets/icons', false, /\\.(png)$/)) as Record<string, string>;\r\n\r\nexport type CardComponentProps = {\r\n    style?:CSSProperties,\r\n    card: Card,\r\n    onClick:()=>void;\r\n    isHidden:boolean,\r\n}\r\n\r\nconst CARD_STYLE:CSSProperties = {\r\n    boxSizing: 'border-box',\r\n    display: 'inline-flex',\r\n    backfaceVisibility: \"hidden\",\r\n    border: '8px solid black',\r\n    borderRadius: 20,\r\n    fontFamily: \"'Open Sans', sans-serif\",\r\n    fontSize: 11,\r\n    padding: 8,\r\n    width: 260,\r\n    height: 400,\r\n    zIndex: 0,\r\n    transition: 'transform 0.3s',\r\n    overflow: 'hidden',\r\n    color: 'white',\r\n    background: 'linear-gradient(0deg, rgba(53,62,62,1) 0%, rgba(34,34,34,1) 100%)'\r\n};\r\nconst OUTLINE_WRAPPER_STYLE:CSSProperties = {\r\n    border: '4px solid',\r\n    padding: 12,\r\n    display: 'inline-flex',\r\n    flexDirection: 'column',\r\n    borderRadius: 16,\r\n    flexGrow: 1,\r\n};\r\nconst BACKGROUND_ICONS_STYLE:CSSProperties = {\r\n    position: 'absolute',\r\n    top: '-50%',\r\n    left: '-50%',\r\n    width: '200%',\r\n    height: '200%',\r\n    backgroundSize: '40px 40px',\r\n    backgroundRepeat: 'repeat',\r\n    opacity: 0.05,\r\n    transform: 'rotate(-30deg)',\r\n    transformOrigin: 'center center',\r\n}\r\nconst BACKFACE_STYLE:CSSProperties = {\r\n    boxSizing: 'border-box',\r\n    position: \"absolute\",\r\n    top: 0,\r\n    left: 0,\r\n    backgroundColor: 'lightgray',\r\n    border: '8px solid black',\r\n    borderRadius: 20,\r\n    width: 260,\r\n    height: 400,\r\n    zIndex: -1,\r\n    transition: 'transform 0.3s',\r\n}\r\nconst CARD_TITLE_STYLE:CSSProperties ={\r\n    fontWeight: 'bold',\r\n    fontFamily: 'Indie Flower',\r\n    lineHeight: 1,\r\n    height: 45,\r\n    padding: 5,\r\n    overflow: 'hidden',\r\n    fontSize: 22,\r\n    textAlign: 'center',\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    justifyContent: 'space-around',\r\n}\r\nconst CARD_COST_STYLE:CSSProperties = {\r\n    ...CARD_TITLE_STYLE,\r\n    fontSize: 18,\r\n    height: 10\r\n}\r\nconst CARD_TEXT_STYLE:CSSProperties = {\r\n    flexGrow: 1,\r\n    fontSize: 24,\r\n    padding: 5,\r\n    overflow: 'hidden',\r\n    display: 'flex',\r\n    textAlign: 'left',\r\n}\r\n\r\nconst VERTICAL_CENTER_STYLE:CSSProperties = {\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    justifyContent: 'space-around',\r\n}\r\n\r\nconst HIDDEN_STYLE = {\r\n    transform: 'rotate3d(0,1,0,180deg)'\r\n}\r\n\r\n\r\n\r\nfunction VerticalCenter(props:React.PropsWithChildren<{}>){\r\n    return <div style={VERTICAL_CENTER_STYLE}>\r\n        <div>\r\n         {props.children}\r\n        </div>\r\n    </div>\r\n}\r\n\r\nexport type HSV = [number, number, number];\r\n\r\nexport function IconComponent(props:{icon:Icon, hsv:HSV, size:string}){\r\n    const {icon,hsv} = props;\r\n    const iconName = typeof icon === 'string' ? icon : icon.icon;\r\n    return <div style={{textAlign: 'center'}}>\r\n        <img src={icons[iconName]} width={props.size} height={props.size}/>\r\n    </div>\r\n}\r\n\r\nfunction TextFillSpace(props:React.PropsWithChildren<{style:CSSProperties}>){\r\n    const ref = React.useRef<HTMLDivElement>(null);\r\n    const [fontSize, setFontSize] = React.useState(props.style.fontSize);\r\n    useEffect(()=>{\r\n        if(!ref.current) return;\r\n        let size = fontSize as number;\r\n        for(let i = 0; i < 100 && (ref.current.clientHeight < ref.current.scrollHeight ||ref.current.clientWidth < ref.current.scrollWidth) ; i++){\r\n            size -= 0.1;\r\n            ref.current.style.fontSize = `${size}px`;\r\n        }\r\n        if(fontSize!=size){\r\n            ref.current.style.fontSize = `${size}px`;\r\n            setFontSize(size);\r\n        }\r\n    },[ref.current, ref]);\r\n\r\n    return <div style={{...props.style, fontSize}} ref={ref}>\r\n        {props.children}\r\n    </div>\r\n}\r\n\r\nconst CardComponent = (props:CardComponentProps) => {\r\n    const rotationStyle = {...(props.isHidden ? HIDDEN_STYLE : {})};\r\n    const icon = React.useMemo(()=>props.card.getIcon(), [props.card]);\r\n    const iconName = typeof icon === 'string' ? icon : icon.icon;\r\n    const backgroundImage = `url(${icons[iconName]})`;\r\n    const hsv:HSV = [180, 70, 50];\r\n    return <div style={{position:'relative', overflow:'hidden', ...props.style}} onClick={props.onClick}>\r\n        <div style={{...rotationStyle, ...CARD_STYLE, }}>\r\n           <div style={{...BACKGROUND_ICONS_STYLE, backgroundImage}}/>\r\n           <div style={OUTLINE_WRAPPER_STYLE}>\r\n               {props.card.cost !== 0 && <div style={CARD_COST_STYLE}>\r\n                   {Array(props.card.cost + 1).join('')}\r\n               </div>}\r\n                <TextFillSpace style={CARD_TITLE_STYLE}>\r\n                    <div>\r\n                        {props.card.getName()}\r\n                    </div>\r\n                </TextFillSpace>\r\n            <VerticalCenter>\r\n                    <IconComponent icon={icon} hsv={hsv} size=\"120px\"/>\r\n            </VerticalCenter>\r\n            <TextFillSpace style={CARD_TEXT_STYLE}>\r\n                <VerticalCenter>\r\n                    {props.card.getText()}\r\n                </VerticalCenter>\r\n            </TextFillSpace>\r\n           </div>\r\n        </div>\r\n        <div style={{...BACKFACE_STYLE, ...rotationStyle}}/>\r\n    </div>\r\n}\r\n\r\nexport default CardComponent;","import React, {CSSProperties, FunctionComponent} from \"react\";\r\nimport {Card, ChoiceActionCard} from \"../cardgame/Card\";\r\nimport ChoiceArrow from \"./ChoiceArrow\";\r\nimport ReactHoverDelayTrigger from 'react-hover-delay-trigger'\r\nimport CardGame, {CardGameMove, CardGameState} from \"../cardgame/CardGame\";\r\nimport DelayHover from \"./DelayHover\";\r\nimport {ChooseOne} from \"../cardgame/Components/ChoiceActions/ChooseOne\";\r\nimport CardComponent from \"./CardComponent\";\r\n\r\ntype CardProps = {\r\n    card:Card,\r\n    onClick:()=>void,\r\n    setPreview:(move?:CardGameMove)=>void,\r\n    gamestate:CardGameState;\r\n    game:CardGame;\r\n    isOpponent:boolean;\r\n    beingPlayed:boolean;\r\n    canBeDiscarded:boolean;\r\n    canBePlayed:boolean;\r\n    isHidden:boolean;\r\n    onBoard:boolean;\r\n}\r\n\r\nconst BEING_PLAYED_CARD_STYLE:CSSProperties = {\r\n    color: 'blue',\r\n    borderColor: 'black',\r\n    transform: \"scale(1.3)\",\r\n    zIndex: 2,\r\n    cursor: 'pointer',\r\n    opacity: 0.5,\r\n    margin: '0 70px',\r\n    pointerEvents: 'none',\r\n    transition: 'margin 0.3s, opacity 0.3s ease-in 1s'\r\n}\r\nconst CAN_BE_DISCADED_STYLE = {\r\n    borderColor: 'red',\r\n    borderWidth: 3,\r\n    cursor: 'pointer'\r\n}\r\nconst CAN_BE_PLAYED_STYLE = {\r\n    borderColor: 'blue',\r\n    borderWidth: 3,\r\n    cursor: 'pointer',\r\n}\r\n\r\nconst MOVE_DOWN_STYLE = {\r\n    top: 460,\r\n}\r\nconst MOVE_UP_STYLE = {\r\n    top: -460,\r\n}\r\n\r\n\r\nconst VANISHED_STYLE = {\r\n    transform: 'scale(0)'\r\n}\r\n\r\nconst CHOICE_BUBBLE_STYLE = {\r\n    display: 'inline-block',\r\n    margin: 5,\r\n    background: 'rgba(255, 128, 0, 0.5)',\r\n    padding: 20,\r\n    borderRadius: 15\r\n}\r\n\r\nconst WRAPPER_STYLE:CSSProperties = {\r\n    position: \"relative\",\r\n     transition: 'transform 0.3s, margin 0.35s ease-in 0.3s, top 0.4s ease-in-out 0.5s',\r\n   display:'inline-block',\r\n    top:0,\r\n    zIndex: 1,\r\n}\r\n\r\nconst CardWrapper:FunctionComponent<CardProps> = (props)=> {\r\n    const [hasAppearedOnBoard, setHasAppearedOnBoard] = React.useState(props.onBoard && !props.beingPlayed)\r\n    React.useEffect(() => {\r\n        if (props.onBoard && props.beingPlayed) {\r\n            const n = setTimeout(() => {\r\n                setHasAppearedOnBoard(true)\r\n            }, 800)\r\n            return () => window.clearTimeout(n)\r\n        } else if (props.onBoard && !props.beingPlayed) {\r\n            const n = setTimeout(() => {\r\n                setHasAppearedOnBoard(false)\r\n            }, 800)\r\n            return () => window.clearTimeout(n)\r\n        }\r\n    })\r\n\r\n    const {card, beingPlayed} = props;\r\n    const situationalStyle = props.canBeDiscarded ? CAN_BE_DISCADED_STYLE :\r\n        props.canBePlayed ? CAN_BE_PLAYED_STYLE :\r\n            hasAppearedOnBoard ? VANISHED_STYLE :\r\n                {};\r\n    const positionStyling = (props.beingPlayed && props.isOpponent) ? MOVE_DOWN_STYLE :\r\n        (props.beingPlayed && !props.isOpponent) ? MOVE_UP_STYLE :\r\n            {};\r\n    const onClick = props.canBeDiscarded || props.canBePlayed ? props.onClick : () => {};\r\n\r\n    const activeChoice = props.game.getActiveActionChoice(props.gamestate) as ChooseOne|undefined;\r\n    const chooseOneActive = activeChoice?.constructor === ChooseOne;\r\n    const choiceTexts:string[] = activeChoice && activeChoice.constructor === ChooseOne ? [activeChoice.aText, activeChoice.bText] : []\r\n\r\n    return <DelayHover\r\n            delay={400}\r\n            handleHoverTrigger={()=>{\r\n                if(props.canBePlayed){\r\n                    props.setPreview({type:'play', cardNumber:props.card.cardNumber})\r\n                }\r\n            }}\r\n            handleHoverCancel={()=>{\r\n                props.setPreview()\r\n            }}\r\n          >\r\n        <div style={{...WRAPPER_STYLE, ...positionStyling}}>\r\n            {<div style={{\r\n                position: 'absolute',\r\n                top:-200,\r\n                left: -150,\r\n                width: 300,\r\n                transition:'opacity 0.4s',\r\n                opacity: props.beingPlayed && chooseOneActive ? 1 : 0,\r\n            }}>\r\n                {[1,2].map(i=>\r\n                    <div style={CHOICE_BUBBLE_STYLE} className={'glow'}>\r\n                        {choiceTexts[i-1]}\r\n                    </div>\r\n                )}\r\n            </div>}\r\n        <CardComponent style={{...beingPlayed ? BEING_PLAYED_CARD_STYLE : {}, ...situationalStyle}} onClick={onClick} card={card} isHidden={props.isHidden}/>\r\n        {props.beingPlayed && ChoiceActionCard.is(card) && !props.isOpponent && <ChoiceArrow/>}\r\n    </div>\r\n        </DelayHover>\r\n}\r\n\r\nexport default CardWrapper;","export default __webpack_public_path__ + \"static/media/bg.e49eda7f.png\";","import React, {useEffect, useState} from \"react\";\r\ntype GetComponentProps<T> = T extends React.ComponentType<infer P> | React.Component<infer P> ? P : never\r\n\r\ntype KeysMatching<T, V> = {[K in keyof T]-?: T[K] extends V ? K : never}[keyof T];\r\ntype TransitionPropsProps<X extends Record<string, unknown>> = {\r\n    component: (props:X)=>JSX.Element,\r\n    propList:KeysMatching<X, number>[]\r\n} & X\r\n\r\nfunction TransitionProps<X extends Record<string, unknown>>({\r\n            component,\r\n           propList,\r\n           ...rest\r\n}:TransitionPropsProps<X>):JSX.Element {\r\n  const [visibleProps, setVisibleProps] = useState(rest);\r\n\r\n  useEffect(() => {\r\n    setTimeout(() => {\r\n      const newVisibleProps:any = {};\r\n      let requiresUpdate = false;\r\n      for (let key of propList) {\r\n        const currentValue = visibleProps[key as string] as number;\r\n        const targetValue = rest[key as string] as number;\r\n        const diff = targetValue - currentValue\r\n          if(Math.abs(diff)>0.005){\r\n              requiresUpdate=true;\r\n          }\r\n        const newValue = currentValue + diff/4;\r\n        newVisibleProps[key] = newValue;\r\n      }\r\n      if(requiresUpdate) setVisibleProps(newVisibleProps);\r\n    },60);\r\n  }, [rest, visibleProps]);\r\n\r\n  return component({...rest as any, ...visibleProps});\r\n};\r\n\r\nexport default TransitionProps;","import {Card} from \"../cardgame/Card\";\r\nimport React, {CSSProperties} from \"react\";\r\nimport { usePopperTooltip } from \"react-popper-tooltip\";\r\nimport \"react-popper-tooltip/dist/styles.css\";\r\nimport bg from './assets/bg.png'\r\nimport CardGame, {CardGameChoiceMove, CardGameMove, CardGameState, POP_RANGE} from \"../cardgame/CardGame\";\r\nimport { Shaders, Node, GLSL } from \"gl-react\";\r\nimport { Surface } from \"gl-react-dom\";\r\nimport TransitionProps from \"./TransitionProps\";\r\nimport {ChooseAPlayer} from \"../cardgame/Components/ChoiceActions/ChooseAPlayer\";\r\nimport {EXTREMES} from \"../cardgame/Components/Effects/MoveDemographicEffect\";\r\nimport {ChooseAnExtreme, ID_BY_EXTREME} from \"../cardgame/Components/ChoiceActions/ChooseAnExtreme\";\r\nimport DelayHover from \"./DelayHover\";\r\n\r\ntype DemographicDisplayProps = {\r\n    gamestate: CardGameState,\r\n    game: CardGame,\r\n    onChoiceClick: (move:CardGameChoiceMove)=>void,\r\n    setPreview: (move?:CardGameMove)=>void;\r\n    previewState?: CardGameState;\r\n}\r\n\r\nconst COMPASS_STYLE:CSSProperties = {\r\n    height: 500,\r\n    width: 500,\r\n    border: '1px solid black',\r\n    position: 'relative',\r\n    margin: 10,\r\n    overflow: 'hidden',\r\n    marginBottom: 160,\r\n}\r\nconst PLAYER_STYLE:CSSProperties = {\r\n    width: 30,\r\n    height: 30,\r\n    borderRadius: '100%',\r\n    border: '1px solid black',\r\n    position: 'absolute',\r\n    top: -15,\r\n    left: -15,\r\n    transition: 'background 0.3s, transform 0.3s'\r\n}\r\nconst DEMOGRAPHIC_STYLE:CSSProperties = {\r\n    width: 10,\r\n    height: 10,\r\n    borderRadius: '20%',\r\n    border: '1px solid black',\r\n    position: 'absolute',\r\n    top: -5,\r\n    left: -5,\r\n    transition: 'background 0.3s, transform 0.3s',\r\n    pointerEvents:'none',\r\n}\r\n\r\nconst VOTES_BAR_STYLE:CSSProperties = {\r\n    border: '1px solid black',\r\n    height: 25,\r\n    overflow: 'hidden',\r\n    color: 'white'\r\n}\r\n\r\nfunction coordsToTransform({x,y}:{x:number, y:number}){\r\n    return `translate(${(x+1)*250}px,${(y+1)*250 }px)`;\r\n}\r\n\r\nconst shaders = Shaders.create({\r\n  helloBlue: {\r\n    frag: GLSL`\r\nprecision highp float;\r\nvarying vec2 uv;\r\nuniform float bluePop;\r\nuniform float blueX;\r\nuniform float blueY;\r\nuniform float redPop;\r\nuniform float redX;\r\nuniform float redY;\r\nuniform float pbluePop;\r\nuniform float pblueX;\r\nuniform float pblueY;\r\nuniform float predPop;\r\nuniform float predX;\r\nuniform float predY;\r\nfloat distSquared( vec2 A, vec2 B )\r\n{\r\n    vec2 C = A - B;\r\n    return dot( C, C );\r\n}\r\n\r\nvoid main() {\r\n  vec2 bluePos = vec2(blueX, 1.0-blueY);\r\n  vec2 redPos = vec2(redX, 1.0-redY);\r\n  vec2 pBluePos = vec2(pblueX, 1.0-pblueY);\r\n  vec2 pRedPos = vec2(predX, 1.0-predY);\r\n  \r\n  float blueScore = bluePop - distSquared(bluePos, uv);\r\n  float redScore = redPop- distSquared(redPos, uv);\r\n  float pBlueScore = pbluePop - distSquared(pBluePos, uv);\r\n  float pRedScore = predPop - distSquared(pRedPos, uv);\r\n  \r\n  bool blueWins = blueScore > 0.0 && blueScore > redScore ;\r\n  bool redWins = redScore > 0.0 && blueScore < redScore ;\r\n  bool pBlueWins = pBlueScore > 0.0 && pBlueScore > pRedScore;\r\n  bool pRedWins = pRedScore > 0.0 && pBlueScore < redScore ;\r\n  \r\n  bool noWins = !blueWins && !redWins && !pBlueWins && !pRedWins;\r\n  \r\n  vec3 redColor = vec3(0.8,0.1,0.1);\r\n  vec3 blueColor = vec3(0.15,0.15,0.8);\r\n  vec3 grayColor = vec3(.7,0.7,0.7);\r\n  \r\n  vec3 col = (redWins||pRedWins) && !pBlueWins ? redColor :\r\n           (blueWins||pBlueWins) && !pRedWins  ? blueColor :\r\n           grayColor;\r\n    \r\n  vec3 gains = (!redWins && pRedWins) || (!blueWins && pBlueWins) ? vec3(0.2) : vec3(0);\r\n vec3 losses = (redWins && !pRedWins) || (blueWins && !pBlueWins) ? vec3(0.2) : vec3(0);\r\n  \r\n  gl_FragColor = vec4(col + gains - losses , 1.0);\r\n}`\r\n  }\r\n});\r\n\r\ntype BackgroundProps = {\r\n    blueX: number,\r\n    blueY:number,\r\n    bluePop:number,\r\n    redX:number,\r\n    redY:number,\r\n    redPop:number,\r\n    pblueX: number,\r\n    pblueY:number,\r\n    pbluePop:number,\r\n    predX:number,\r\n    predY:number,\r\n    predPop:number,\r\n}\r\n\r\nconst Background = (props:BackgroundProps) => {\r\n    const { blueX, redPop, redX, bluePop, blueY, redY,\r\n    pblueX, predPop, predX, pbluePop, pblueY, predY} = props;\r\n    const coef = POP_RANGE * 0.25;\r\n    return <>\r\n        <img src={bg} style={{position:'absolute'}}/>\r\n        <Surface width={500} height={500} style={{mixBlendMode:'multiply'}}>\r\n        <Node shader={shaders.helloBlue} uniforms={{\r\n            blueX:blueX/2 + 0.5,\r\n            blueY:blueY/2 + 0.5,\r\n            bluePop:bluePop*coef,\r\n            redX:redX/2 + 0.5,\r\n            redY:redY/2 + 0.5,\r\n            redPop:redPop*coef,\r\n            pblueX:pblueX/2 + 0.5,\r\n            pblueY:pblueY/2 + 0.5,\r\n            pbluePop:pbluePop*coef,\r\n            predX:predX/2 + 0.5,\r\n            predY:predY/2 + 0.5,\r\n            predPop:predPop*coef,\r\n        }} />\r\n    </Surface>\r\n    </>\r\n  }\r\n\r\nclass AnimatedBackground extends React.Component<BackgroundProps> {\r\n  render() {\r\n   return  <TransitionProps\r\n       component={Background}\r\n       propList={['blueX', 'blueY', 'bluePop', 'redX', 'redY', 'redPop', 'pblueX', 'pblueY', 'pbluePop', 'predX', 'predY', 'predPop']}\r\n       blueX={this.props.blueX}\r\n       blueY={this.props.blueY}\r\n       bluePop={this.props.bluePop}\r\n       redX={this.props.redX}\r\n       redY={this.props.redY}\r\n       redPop={this.props.redPop}\r\n       pblueX={this.props.pblueX}\r\n       pblueY={this.props.pblueY}\r\n       pbluePop={this.props.pbluePop}\r\n       predX={this.props.predX}\r\n       predY={this.props.predY}\r\n       predPop={this.props.predPop}\r\n   />\r\n  }\r\n}\r\n\r\ntype VoteBarsProps = {\r\n    redVotes: number,\r\n    blueVotes:number,\r\n    style?:CSSProperties,\r\n}\r\nconst VoteBars = ({redVotes, blueVotes, style}:VoteBarsProps)=>\r\n    <div style={{display: 'flex', width: 200, ...style}}>\r\n        <div style={{flexGrow:blueVotes, background:'blue', ...VOTES_BAR_STYLE}}>{Math.round(blueVotes)}</div>\r\n        <div style={{flexGrow:redVotes, background:'red', ...VOTES_BAR_STYLE}}>{Math.round(redVotes)}</div>\r\n    </div>\r\n\r\nconst DemographicDisplay:React.FunctionComponent<DemographicDisplayProps> = props=>{\r\n    const {gamestate:{playerOne, playerTwo},previewState, onChoiceClick, game} = props;\r\n    const votes = props.game.getVotes(props.gamestate);\r\n    const previewVotes = previewState ? props.game.getVotes(previewState) : votes;\r\n    const isChoosingPlayer = game.getActiveActionChoice(props.gamestate)?.constructor === ChooseAPlayer;\r\n    const isChoosingExtreme = game.getActiveActionChoice(props.gamestate)?.constructor === ChooseAnExtreme;\r\n\r\n    const bluePlayer =\r\n            <DelayHover\r\n                delay={400}\r\n                handleHoverTrigger={()=>{\r\n                    if(isChoosingPlayer){\r\n                        props.setPreview({type:'choice', choice:1})\r\n                    }\r\n                }}\r\n                handleHoverCancel={()=>{\r\n                    props.setPreview()\r\n                }}\r\n              >\r\n                <div\r\n                    className={isChoosingPlayer ? 'glow' : ''}\r\n                    style={{...PLAYER_STYLE, background:'blue', transform:coordsToTransform(props.gamestate.playerOne.position)}}\r\n                    onClick={()=>isChoosingPlayer && onChoiceClick({type:'choice', choice:1})}\r\n                />\r\n            </DelayHover>\r\n    const redPlayer =\r\n            <DelayHover\r\n                delay={400}\r\n                handleHoverTrigger={()=>{\r\n                    if(isChoosingPlayer){\r\n                        props.setPreview({type:'choice', choice:2})\r\n                    }\r\n                }}\r\n                handleHoverCancel={()=>{\r\n                    props.setPreview()\r\n                }}\r\n              >\r\n                <div\r\n                    className={isChoosingPlayer ? 'glow' : ''}\r\n                    style={{...PLAYER_STYLE, background:'red', transform:coordsToTransform(props.gamestate.playerTwo.position)}}\r\n                    onClick={()=>isChoosingPlayer && onChoiceClick({type:'choice', choice:2})}\r\n                />\r\n            </DelayHover>\r\n\r\n    return <div style={{display:'flex', justifyContent:'space-evenly'}}>\r\n            <div style={COMPASS_STYLE}>\r\n            <AnimatedBackground\r\n                bluePop={playerOne.popularity}\r\n                blueX={playerOne.position.x}\r\n                blueY={playerOne.position.y}\r\n                redPop={playerTwo.popularity}\r\n                redX={playerTwo.position.x}\r\n                redY={playerTwo.position.y}\r\n                pbluePop={props.previewState ? props.previewState.playerOne.popularity : playerOne.popularity}\r\n                pblueX={props.previewState ? props.previewState.playerOne.position.x : playerOne.position.x}\r\n                pblueY={props.previewState ? props.previewState.playerOne.position.y : playerOne.position.y}\r\n                predPop={props.previewState ? props.previewState.playerTwo.popularity : playerTwo.popularity}\r\n                predX={props.previewState ? props.previewState.playerTwo.position.x : playerTwo.position.x}\r\n                predY={props.previewState ? props.previewState.playerTwo.position.y : playerTwo.position.y}\r\n            />\r\n                {bluePlayer}\r\n                {redPlayer}\r\n            {(['playerOne', 'playerTwo'] as ('playerOne'|'playerTwo')[]).map((playerKey)=><div\r\n                style={{...PLAYER_STYLE,\r\n                    borderColor:'white',\r\n                    pointerEvents: 'none',\r\n                    opacity: (props.previewState &&\r\n                        (props.previewState[playerKey].position.x != props.gamestate[playerKey].position.x || props.previewState[playerKey].position.y != props.gamestate[playerKey].position.y)) ?\r\n                        1 : 0,\r\n                    transform:props.previewState ? coordsToTransform(props.previewState[playerKey].position) : coordsToTransform(props.gamestate[playerKey].position)\r\n                }}\r\n            />)}\r\n            {props.gamestate.demographics.map(({x,y}, i)=>{\r\n                const vote = props.game.getDemographicVote(props.gamestate, {x,y})\r\n                const background = vote === 1 ? 'blue' :\r\n                                    vote ===2 ? 'red' :\r\n                                        'gray';\r\n                const positionStyling:CSSProperties = {\r\n                    transform: coordsToTransform({x,y}),\r\n                    background\r\n                }\r\n                const preview = props.previewState?.demographics[i];\r\n                const ghostStyling:CSSProperties = {\r\n                    transform: preview ? coordsToTransform(preview) : positionStyling.transform,\r\n                    opacity: preview && (preview.x !== x || preview.y !== y) ? .5 : 0,\r\n                    borderColor:'white',\r\n                    background\r\n                }\r\n                return <>\r\n                     <div style={{...DEMOGRAPHIC_STYLE, ...positionStyling}} key={i}/>\r\n                    <div style={{...DEMOGRAPHIC_STYLE,  ...ghostStyling}} key={`${i}_preview`}/>\r\n                </>\r\n            })}\r\n            {isChoosingExtreme && Object.entries(EXTREMES).map(([extreme, point])=>\r\n                 <DelayHover\r\n                delay={400}\r\n                handleHoverTrigger={()=>{\r\n                    props.setPreview({type:'choice', choice:ID_BY_EXTREME[extreme]})\r\n                }}\r\n                handleHoverCancel={()=>{\r\n                    props.setPreview()\r\n                }}\r\n              >\r\n                <div\r\n                    className={'glow'}\r\n                    onClick={()=>onChoiceClick({type:'choice', choice:ID_BY_EXTREME[extreme]})}\r\n                    style={{\r\n                        position: \"absolute\",\r\n                        backgroundColor: 'rgba(255, 128, 0, 0.5)',\r\n                        top: -75,\r\n                        left: -75,\r\n                        width: 150,\r\n                        height: 150,\r\n                        borderRadius: 500,\r\n                        transform:coordsToTransform(point)\r\n                    }}\r\n                />\r\n                 </DelayHover>\r\n            )}\r\n        </div>\r\n            <div style={{textAlign:'center'}}>\r\n                Election in\r\n                <div style={{fontSize:'150%', fontWeight:'bold'}}>\r\n                    {props.gamestate.roundsUntilElection}\r\n                </div>\r\n                Rounds\r\n                <div>\r\n                    {props.gamestate.cardPlayedThisTurn ? 'Card has been Played this turn' : '-'}\r\n                </div>\r\n                <div>\r\n                    {props.gamestate.endRoundAfterThisTurn ? 'Round will end if turn ended now' : '-'}\r\n                </div>\r\n                <TransitionProps\r\n                    component={VoteBars}\r\n                    propList={['blueVotes', 'redVotes']}\r\n                    blueVotes={votes[1]||0}\r\n                    redVotes={votes[2]||0}\r\n                />\r\n                <TransitionProps\r\n                    style={{\r\n                        opacity: previewState ? .4 : 0,\r\n                        transition: 'opacity 0.4s'\r\n                    }}\r\n                    component={VoteBars}\r\n                    propList={['blueVotes', 'redVotes']}\r\n                    blueVotes={previewVotes[1]||0}\r\n                    redVotes={previewVotes[2]||0}\r\n                />\r\n            </div>\r\n    </div>\r\n};\r\n\r\nexport default DemographicDisplay;","import {Card} from \"../cardgame/Card\";\r\nimport React, {CSSProperties} from \"react\";\r\nimport { usePopperTooltip } from \"react-popper-tooltip\";\r\nimport \"react-popper-tooltip/dist/styles.css\";\r\n\r\ntype CardPileProps = {\r\n    label: string,\r\n    cards:(Card|'?')[],\r\n}\r\n\r\nconst PILE_STYLE:CSSProperties = {\r\n    border: '1px solid black',\r\n    fontSize: 10,\r\n    borderRadius: 3,\r\n    width: 40,\r\n    height: 60,\r\n    margin: 5,\r\n    display: 'inline-block'\r\n}\r\nconst CARD_LIST_STYLE:CSSProperties = {\r\n    maxHeight: 200,\r\n    fontSize: 10,\r\n    textAlign: 'left',\r\n    width: 150,\r\n    overflowY: 'auto'\r\n}\r\n\r\nconst CardPile:React.FunctionComponent<CardPileProps> = props=>{\r\n    const {\r\n        label,\r\n        cards\r\n    } = props;\r\n    const {\r\n        getArrowProps,\r\n        getTooltipProps,\r\n        setTooltipRef,\r\n        setTriggerRef,\r\n        visible\r\n      } = usePopperTooltip({ interactive: true, delayHide: 100 });\r\n\r\n    return <>\r\n            <div style={PILE_STYLE} ref={setTriggerRef}>\r\n                {label}\r\n                <div>{cards.length}</div>\r\n            </div>\r\n         {visible && (\r\n          <div\r\n            ref={setTooltipRef}\r\n            {...getTooltipProps({ className: \"tooltip-container\" })}\r\n          >\r\n              {cards.length===0 && <i>Empty</i>}\r\n              <ul style={CARD_LIST_STYLE}>\r\n                  {cards.map((card, i)=><li key={i}>\r\n                      <b>{typeof card === 'string' ? card : card.getName()}</b>\r\n                      {' '}\r\n                        {typeof card !== 'string' && card.getText()}\r\n                  </li>)}\r\n              </ul>\r\n            <div {...getArrowProps({ className: \"tooltip-arrow\" })} />\r\n          </div>\r\n        )}\r\n        </>\r\n}\r\n\r\nexport default CardPile;","import CardWrapper from \"./CardWrapper\";\r\nimport FlipMove from \"react-flip-move\";\r\nimport React from \"react\";\r\nimport CardGame, {CardGameMove, CardGamePlayerState, CardGameState} from \"../cardgame/CardGame\";\r\nimport DelayHover from \"./DelayHover\";\r\n\r\nconst HAND_STYLE = {\r\n    display: 'inline-flex',\r\n    width: 1000,\r\n    justifyContent:'center',\r\n    zIndex: 2,\r\n}\r\n\r\ntype PlayerHandProps = {\r\n        game:CardGame,\r\n        displayHand:number[],\r\n        gamestate:CardGameState,\r\n        onCardClick:(cardNumber:number)=>void,\r\n        setPreview:(move?:CardGameMove)=>void,\r\n        isOpponent:boolean,\r\n        isActive:boolean,\r\n        player:CardGamePlayerState,\r\n        cardsBeingPlayed:number[],\r\n}\r\n\r\nfunction getTransform(i:number, outOf:number, reverse:boolean):string {\r\n    const r = i/(outOf-1);\r\n    const deg = (4*(1-r) - 4*r) * (reverse ? -1 : 1);\r\n    return `scale(0.6) rotate(${deg}deg)`\r\n}\r\n\r\nfunction PlayerHand(props:PlayerHandProps){\r\n    const {\r\n        game,\r\n        displayHand,\r\n        gamestate,\r\n        onCardClick,\r\n        setPreview,\r\n        isOpponent,\r\n        isActive,\r\n        player,\r\n        cardsBeingPlayed\r\n    } = props;\r\n    return <FlipMove style={{...HAND_STYLE}}>\r\n                {displayHand.map((n:number, i)=><div\r\n                    key={n+' '+game.cardIndex[n].getName()}\r\n                    style={{position: 'relative'} }\r\n                    className=\"zoom-focus\"\r\n                >\r\n                    <CardWrapper\r\n                        gamestate={gamestate}\r\n                        game={game}\r\n                        onClick={()=>onCardClick(n)}\r\n                        setPreview={setPreview}\r\n                        isOpponent={isOpponent}\r\n                        isHidden={isOpponent && !cardsBeingPlayed.includes(n)}\r\n                        card={game.cardIndex[n]}\r\n                        canBePlayed={isActive && !isOpponent && gamestate.step === 'play' && !cardsBeingPlayed.includes(n)}\r\n                        canBeDiscarded={isActive && !isOpponent && gamestate.step === 'draw' && !cardsBeingPlayed.includes(n)}\r\n                        beingPlayed={cardsBeingPlayed.includes(n)}\r\n                        onBoard={player.board.includes(n)}\r\n                    />\r\n                </div>)}\r\n            </FlipMove>\r\n}\r\n\r\nexport default PlayerHand;","\r\nimport React, {CSSProperties} from \"react\";\r\nimport { usePopperTooltip } from \"react-popper-tooltip\";\r\nimport \"react-popper-tooltip/dist/styles.css\";\r\n\r\n\r\ntype TooltipOptions = Parameters<typeof usePopperTooltip>\r\ntype TooltipProps = React.PropsWithChildren<{target:JSX.Element, style?:CSSProperties, opts?:Partial<TooltipOptions[0]>}>\r\n\r\nconst Tooltip:React.FunctionComponent<TooltipProps> = props=>{\r\n    const {\r\n        target,\r\n        style,\r\n        children,\r\n        opts\r\n    } = props;\r\n    const {\r\n        getArrowProps,\r\n        getTooltipProps,\r\n        setTooltipRef,\r\n        setTriggerRef,\r\n        visible\r\n      } = usePopperTooltip({ ...opts });\r\n\r\n    return <>\r\n        <div style={style} ref={setTriggerRef}>{target}</div>\r\n         {visible && (\r\n          <div\r\n            ref={setTooltipRef}\r\n            {...getTooltipProps({ className: \"tooltip-container\" })}\r\n          >\r\n              {children}\r\n            <div {...getArrowProps({ className: \"tooltip-arrow\" })} />\r\n          </div>\r\n        )}\r\n        </>\r\n}\r\n\r\nexport default Tooltip;","import CardGame, {CardGameMove} from \"../cardgame/CardGame\";\r\nimport FlipMove from \"react-flip-move\";\r\nimport {IconComponent} from \"./CardComponent\";\r\nimport React from \"react\";\r\nimport Tooltip from \"./Tooltip\";\r\n\r\nexport type MoveHistoryEntry = {player:1|2, move:CardGameMove}\r\nexport type MoveHistoryElementProps =MoveHistoryEntry & {game:CardGame};\r\ntype MoveHistoryProps = {\r\n    game: CardGame,\r\n    moveHistory: MoveHistoryEntry[]\r\n}\r\n\r\nfunction MoveHistoryElement({move, player, game}:MoveHistoryElementProps){\r\n    if(move.type !== \"play\") return null;\r\n    const card = game.cardIndex[move.cardNumber];\r\n    const icon = card.getIcon()\r\n    const iconName = typeof icon === 'string' ? icon : icon.icon;\r\n    return <div className={`player-${player}`}>\r\n        <Tooltip\r\n            opts={{placement:'right'}}\r\n            target={\r\n                <IconComponent\r\n                    icon={iconName}\r\n                    hsv={[0,0,0]}\r\n                    size=\"30px\"\r\n                />\r\n            }\r\n        >\r\n            <div style={{width: 300}}>\r\n                <b>\r\n                    {card.getName()}\r\n                </b>\r\n            </div>\r\n            {card.getText()}\r\n        </Tooltip>\r\n    </div>\r\n}\r\n\r\nfunction MoveHistory({moveHistory, game}:MoveHistoryProps){\r\n    return <div className=\"move-history-wrapper\">\r\n        <FlipMove className=\"move-history\">\r\n        {moveHistory.map(m=><div>\r\n            <MoveHistoryElement player={m.player} move={m.move} game={game}/>\r\n        </div>)}\r\n    </FlipMove>\r\n    </div>\r\n}\r\n\r\nexport default MoveHistory","import CardGame, {CardGameChoiceMove, CardGameMove, CardGamePlayerState, CardGameState} from \"../cardgame/CardGame\";\r\nimport React, {CSSProperties, FunctionComponent, useEffect} from \"react\";\r\nimport CardWrapper  from \"./CardWrapper\";\r\nimport DemographicDisplay from \"./DemographicDisplay\";\r\n\r\nimport _ from 'lodash'\r\n\r\nimport FlipMove from 'react-flip-move';\r\nimport CardPile from \"./CardPile\";\r\nimport ChoiceArrow from \"./ChoiceArrow\";\r\nimport {ChoiceActionCard} from \"../cardgame/Card\";\r\nimport PlayerHand from \"./PlayerHand\";\r\nimport {isA} from \"../../node_modules.deltemetoo/expect/build/jasmineUtils\";\r\nimport MoveHistory, {MoveHistoryElementProps, MoveHistoryEntry} from \"./MoveHistory\";\r\n\r\ntype GameBoardProps = {\r\n    gamestate: CardGameState;\r\n    game: CardGame,\r\n    lastmove: CardGameMove;\r\n    previewState?: CardGameState;\r\n    onCardClick: (n:number)=>void;\r\n    setPreview: (move?:CardGameMove)=>void,\r\n    onChoiceClick: (move:CardGameChoiceMove)=>void,\r\n    moveHistory:MoveHistoryEntry[],\r\n\r\n}\r\ntype PlayerDisplayProps = {\r\n    isHidden: boolean;\r\n    isActive: boolean;\r\n    lastmove?: CardGameMove;\r\n    player: CardGamePlayerState;\r\n    gamestate: CardGameState;\r\n    game: CardGame;\r\n    onCardClick: (n:number)=>void;\r\n    setPreview: (move?:CardGameMove)=>void,\r\n}\r\n\r\nconst WRAPPER_STYLE:CSSProperties = {\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n    placeContent: 'center',\r\n}\r\n\r\nconst ACTIVE_WRAPPER_STYLE = {\r\n    ...WRAPPER_STYLE,\r\n    background: 'gold',\r\n}\r\n\r\nconst HEALTH_WRAPPER_STYLE:CSSProperties = {\r\n    fontSize: 80,\r\n    position: \"relative\",\r\n}\r\nconst HEALTH_STYLE:CSSProperties = {\r\n    position: \"absolute\",\r\n    bottom:40,\r\n    left: 25,\r\n    width: 20,\r\n    fontSize: 16,\r\n    color: \"white\",\r\n    textAlign: 'center'\r\n}\r\n\r\nconst PLAYER_BOARD_STYLE:CSSProperties = {\r\n    height: 200,\r\n    display: 'flex',\r\n    justifyContent:'center',\r\n    alignItems: 'center',\r\n    placeContent: 'center',\r\n\r\n}\r\n\r\nconst PlayerDisplay:FunctionComponent<PlayerDisplayProps> = ({onCardClick, setPreview, game, player, isActive, isHidden, lastmove, gamestate})=>{\r\n    const cardsBeingPlayed = lastmove && lastmove.type === 'play' ? [lastmove.cardNumber] : []\r\n\r\n    const displayHand = [...player.hand, ...cardsBeingPlayed].sort((a,b)=>a-b);\r\n\r\n    const board = <div >\r\n        <FlipMove style={{...PLAYER_BOARD_STYLE}}>\r\n            {player.board.map(n=><div key={n+' '+game.cardIndex[n].getName()}>\r\n                <CardWrapper\r\n                    gamestate={gamestate}\r\n                    game={game}\r\n                    onClick={()=>{}}\r\n                    setPreview={()=>{}}\r\n                    isOpponent={isHidden}\r\n                    isHidden={false}\r\n                    card={game.cardIndex[n]}\r\n                    canBePlayed={false}\r\n                    canBeDiscarded={false}\r\n                    beingPlayed={false}\r\n                    onBoard={true}\r\n                />\r\n            </div>)}\r\n        </FlipMove>\r\n    </div>\r\n\r\n    return <div style={isActive ? ACTIVE_WRAPPER_STYLE : WRAPPER_STYLE}>\r\n            {!isHidden && board}\r\n            <div style={HEALTH_WRAPPER_STYLE}>\r\n                \r\n                <div style={HEALTH_STYLE}>\r\n                    {player.capital}\r\n                </div>\r\n            </div>\r\n            <div style={HEALTH_WRAPPER_STYLE}>\r\n                \r\n                <div style={HEALTH_STYLE}>\r\n                    {player.popularity}\r\n                </div>\r\n            </div>\r\n            <PlayerHand\r\n                game={game}\r\n                displayHand={displayHand}\r\n                gamestate={gamestate}\r\n                onCardClick={onCardClick}\r\n                setPreview={setPreview}\r\n                isOpponent={isHidden}\r\n                isActive={isActive}\r\n                player={player}\r\n                cardsBeingPlayed={cardsBeingPlayed}\r\n            />\r\n            <CardPile\r\n                label=\"deck\"\r\n                cards={player.deck.map(n=>isHidden ? '?' : game.cardIndex[n] )}\r\n            />\r\n            <CardPile\r\n                label=\"discard\"\r\n                cards={player.discardPile.map(n=>game.cardIndex[n])}\r\n            />\r\n            {isHidden && board}\r\n        </div>\r\n};\r\n\r\nconst GameBoard:FunctionComponent<GameBoardProps> = (props)=>{\r\n    const {gamestate, game, lastmove, onCardClick, onChoiceClick, setPreview, previewState, moveHistory} = props;\r\n    return <>\r\n        <div>\r\n            Step: {gamestate.step}\r\n        </div>\r\n        <MoveHistory moveHistory={moveHistory} game={game}/>\r\n        <PlayerDisplay onCardClick={()=>{}} setPreview={()=>{}} game={game} gamestate={gamestate} player={gamestate.playerTwo} lastmove={gamestate.activePlayer === 2 ? lastmove: undefined} isActive={gamestate.activePlayer === 2} isHidden={true}/>\r\n        <DemographicDisplay\r\n            gamestate={gamestate}\r\n            game={game}\r\n            previewState={previewState}\r\n            onChoiceClick={onChoiceClick}\r\n            setPreview={setPreview}\r\n        />\r\n        <PlayerDisplay onCardClick={onCardClick} setPreview={setPreview} game={game} gamestate={gamestate} player={gamestate.playerOne} lastmove={gamestate.activePlayer === 1 ? lastmove: undefined} isActive={gamestate.activePlayer === 1} isHidden={false}/>\r\n    </>\r\n}\r\n\r\nexport default GameBoard;","\r\n// @ts-ignore\r\n// eslint-disable-next-line\r\nimport Worker from 'comlink-loader!./worker'; // inline loader\r\n\r\nexport default Worker;","\r\nimport parse from 'csv-parse/lib/sync'\r\nimport {Card, ChoiceActionCard, EffectCard, ItemCard} from \"../Card\";\r\nimport TextTemplate from \"../Components/TextTemplate\";\r\nimport ExampleDeckCsv from './ExampleDeck.json'\r\n\r\ntype RawCard = {\r\n    name: string,\r\n    text: string,\r\n    type: 'effect'|'choice'|'policy'\r\n    cost: number\r\n}\r\n\r\nfunction parseCard(raw:RawCard, cardNumber:number):Card {\r\n    const {name, text, cost, type} = raw;\r\n    if(type === 'effect'){\r\n        const effect = TextTemplate.parse('Eff', text);\r\n        return new EffectCard(effect, text, name, cardNumber, cost);\r\n    }else if(type === 'choice'){\r\n        const effect = TextTemplate.parse('ChoiceAction', text);\r\n        return new ChoiceActionCard(effect, text, name, cardNumber, cost);\r\n    }else if(type === 'policy'){\r\n        const ability = TextTemplate.parse('Ability', text);\r\n        return new ItemCard(ability, text, name, cardNumber, cost);\r\n    }\r\n    throw new Error(\"Unknown Card Type \"+type)\r\n}\r\n\r\n\r\nfunction getExampleDeck():Record<number, Card>{\r\n    if(Object.values(TextTemplate.templates).some(arr=>arr.length === 0)) {\r\n        throw new Error(\"Text Templates not setup\")\r\n    }\r\n    const rawCards:RawCard[] = ExampleDeckCsv as RawCard[];\r\n    return [1,2,3].flatMap(_=>rawCards).map(parseCard)\r\n}\r\n\r\n\r\nexport default getExampleDeck;","import CardGame, {CardGameChain, CardGameMove, CardGameState} from \"../../cardgame/CardGame\";\r\nimport {GameStatus} from \"../../mcts/mcts\";\r\nimport GameBoard from \"../GameBoard\";\r\nimport {WorkerResponse} from \"../worker/worker\";\r\nimport Worker from \"../worker\";\r\nimport {Card} from \"../../cardgame/Card\";\r\nimport setupEffects from \"../../cardgame/Components/setup\";\r\nimport {useMemo} from \"react\";\r\nimport * as React from \"react\";\r\nimport getExampleDeck from \"../../cardgame/Data/ExampleDecks\";\r\nimport './App.css';\r\nimport delay from \"delay\";\r\nimport { MoveHistoryEntry} from \"../MoveHistory\";\r\n\r\n\r\ntype CombinedGameState = {\r\n    state: CardGameState,\r\n    lastMove?: CardGameChain,\r\n    moveHistory:MoveHistoryEntry[],\r\n}\r\n\r\nfunction getMoveFromCardClick(gamestate:CardGameState, cardNumber:number):CardGameMove{\r\n    if(gamestate.step==='draw')return {type:'discard', cardNumber};\r\n    else return {type:'play', cardNumber}\r\n}\r\n\r\nconst WATCH_MODE = false;\r\n\r\nconst worker = new Worker();\r\n\r\nfunction Main() {\r\n    setupEffects();\r\n  const cardIndex:Record<number, Card> = useMemo(()=>getExampleDeck(), []);\r\n  const game = useMemo(()=>new CardGame(cardIndex), [cardIndex]);\r\n\r\n  const [combinedGameState, setCombinedGameState] = React.useState<CombinedGameState>({\r\n      state: game.newGame(),\r\n      moveHistory: [],\r\n  });\r\n  const status = useMemo(()=>game.getStatus(combinedGameState.state),[game, combinedGameState.state])\r\n\r\n  const [mood, setMood] = React.useState('...');\r\n  const [previewState, setPreviewState] = React.useState<CardGameState|undefined>()\r\n\r\n    const [isLoading, setIsLoading] = React.useState(false);\r\n\r\n    React.useEffect(()=>{\r\n        let nextTimeout:number = 0;\r\n        const loop = async ()=>{\r\n            if((combinedGameState.state.activePlayer === 2 || WATCH_MODE) && !isLoading && game.getStatus(combinedGameState.state) === GameStatus.IN_PLAY){\r\n                setIsLoading(true)\r\n                const delay_time = (combinedGameState.lastMove as CardGameMove)?.type === 'end' ? 1000 : 2500;\r\n                const [{mood, move}]:[WorkerResponse, void] = await Promise.all([worker.processData(combinedGameState.state), delay(delay_time)])\r\n                const newState = game.applyMoveChain(combinedGameState.state, move);\r\n                setMood(mood)\r\n                setIsLoading(false)\r\n                setPreviewState(undefined)\r\n                const lastMove = Array.isArray(move) ? move[0] : move;\r\n                setCombinedGameState({\r\n                    state:newState,\r\n                    lastMove: lastMove,\r\n                    moveHistory: [...combinedGameState.moveHistory, {move: lastMove, player:combinedGameState.state.activePlayer}]\r\n                })\r\n            }\r\n        }\r\n        nextTimeout = window.setTimeout(loop,0);\r\n        return ()=>window.clearTimeout(nextTimeout);\r\n    },[combinedGameState, game, isLoading])\r\n    const lastmove  = (Array.isArray(combinedGameState.lastMove)?combinedGameState.lastMove[0] : combinedGameState.lastMove )||{type:'end'}\r\n    const canEndTurn = game.getValidMoves(combinedGameState.state).find(m=>!Array.isArray(m) && m.type===\"end\");\r\n\r\n    function applyMove(move:CardGameMove){\r\n        if(status !== GameStatus.IN_PLAY)return;\r\n        const newState = game.applyMove(combinedGameState.state, move);\r\n        setPreviewState(undefined)\r\n        const moveHistory = move.type === 'cancel' ? combinedGameState.moveHistory.slice(0, combinedGameState.moveHistory.length-1) :  [...combinedGameState.moveHistory, {move, player:combinedGameState.state.activePlayer}];\r\n        setCombinedGameState({\r\n            state:newState,\r\n            lastMove: move,\r\n            moveHistory\r\n        })\r\n    }\r\n\r\n    React.useEffect(()=>{\r\n        const handler = (event:Event) => {\r\n            if(combinedGameState.state.activePlayer !== 1 || combinedGameState.state.step !== 'choice') {\r\n                return;\r\n            }\r\n            event.preventDefault();\r\n            applyMove({type:'cancel'})\r\n        };\r\n        document.addEventListener(\"contextmenu\", handler);\r\n\r\n        return ()=>{\r\n            document.removeEventListener(\"contextmenu\", handler)\r\n        }\r\n    }, [combinedGameState])\r\n\r\n  return (\r\n    <div className=\"App\">\r\n        {status !== GameStatus.IN_PLAY && <h1>{status}</h1>}\r\n      <GameBoard\r\n          gamestate={combinedGameState.state}\r\n          game={game}\r\n          lastmove={lastmove}\r\n          previewState={previewState}\r\n          moveHistory={combinedGameState.moveHistory}\r\n          onCardClick={(n)=>{\r\n              const move = getMoveFromCardClick(combinedGameState.state,n)\r\n              applyMove(move)\r\n          }}\r\n          onChoiceClick={(move)=>{\r\n              applyMove(move)\r\n          }}\r\n          setPreview={move=>setPreviewState( move && game.applyMove(combinedGameState.state, move))}\r\n      />\r\n\r\n      <button\r\n          disabled={status!==GameStatus.IN_PLAY || combinedGameState.state.activePlayer === 2 || !canEndTurn}\r\n          onClick={()=>{\r\n              const move:CardGameMove = {type:\"end\"}\r\n              applyMove(move)\r\n          }}\r\n      >\r\n          {combinedGameState.state.endRoundAfterThisTurn ? 'End Round' : 'End Turn'}\r\n      </button>\r\n\r\n        <div>\r\n            {mood}\r\n        </div>\r\n        {isLoading && 'loading'}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Main;\r\n","import React from \"react\";\nimport Main from \"./client/pages/main\";\nimport AllCards from \"./client/pages/allCards\";\n\nfunction App(){\n    return <Main/>\n}\n\nexport default App;","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n","var wrap = require('comlink').wrap,Worker = require(\"!worker-loader?{}!C:/Users/Kai/PycharmProjects/mcts/card-game-ai/node_modules/comlink-loader/dist/comlink-worker-loader.js!C:\\\\Users\\\\Kai\\\\PycharmProjects\\\\mcts\\\\card-game-ai\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js??ref--5-oneOf-2!C:\\\\Users\\\\Kai\\\\PycharmProjects\\\\mcts\\\\card-game-ai\\\\src\\\\client\\\\worker\\\\worker.ts\"),inst;module.exports = function f() {if (this instanceof f) return wrap(Worker());return inst || (inst = wrap(Worker()));};","var map = {\n\t\"./card-draw.png\": 67,\n\t\"./card-exchange.png\": 68,\n\t\"./card-pickup.png\": 69,\n\t\"./card-random.png\": 70,\n\t\"./contract.png\": 71,\n\t\"./expand.png\": 72,\n\t\"./move.png\": 73,\n\t\"./overhead.png\": 74,\n\t\"./quill-ink.png\": 75,\n\t\"./star.png\": 76\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 66;","export default __webpack_public_path__ + \"static/media/card-draw.2b111e73.png\";","export default __webpack_public_path__ + \"static/media/card-exchange.6c1700d6.png\";","export default __webpack_public_path__ + \"static/media/card-pickup.ec1ec04f.png\";","export default __webpack_public_path__ + \"static/media/card-random.a5195cfa.png\";","export default __webpack_public_path__ + \"static/media/contract.f2e4fc9b.png\";","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAYAAAD0eNT6AAAgAElEQVR4Xu3d7XrbOLKFUenKO33lmieZpNvtODYlArULxDp/j0RQqwjiHed83G/+iwABAgQIENhO4L7dL/aDCRAgQIAAgZsA8BAQIECAAIENBQTAhkP3kwkQIECAgADwDBAgQIAAgQ0FBMCGQ/eTCRAgQICAAPAMECBAgACBDQUEwIZD95MJECBAgIAA8AwQIECAAIENBQTAhkP3kwkQIECAgADwDBAgQIAAgQ0FBMCGQ/eTCRAgQICAAPAMECBAgACBDQUEwIZD95MJECBAgIAA8AwQIECAAIENBQTAhkP3kwkQIECAgADwDBAgQIAAgQ0FBMCGQ/eTCRAgQICAAPAMECBAgACBDQUEwIZD95MJECBAgIAA8AwQIECAAIENBQTAhkP3kwkQIECAgADwDBAgQIAAgQ0FBMCGQ/eTCRAgQICAAPAMECBAgACBDQUEwIZD95MJECBAgIAA8AwQIECAAIENBQTAhkP3kwkQIECAgADwDBAgQIAAgQ0FBMCGQ/eTCRAgQICAAPAMECBAgACBDQUEwIZD95MJECBAgIAA8AwQIECAAIENBQTAhkP3kwkQIECAgADwDBAgQIAAgQ0FBMCGQ/eTCRAgQICAAPAMECBAgACBDQUEwIZD95MJECBAgIAA8AwQIECAAIENBQTAhkP3kwkQIECAgADwDBAgQIAAgQ0FBMCGQ/eTCRAgQICAAPAMECBAgACBDQUEwIZD95MJECBAgIAA8AwQIECAAIENBQTAhkP3kwkQIECAgADwDBAgQIAAgQ0FBMCGQ/eTCRAgQICAAPAMECBAgACBDQUEwIZD95MJECBAgIAA8AwQIECAAIENBQTAhkP3kwkQIECAgADwDBAgQIAAgQ0FBMCGQ/eTCRAgQICAAPAMECBAgACBDQUEwIZD95MJECBAgIAA8AwQIECAAIENBQTAhkP3kwkQIECAgADwDBAgQIAAgQ0FBMCGQ/eTCRAgQIDAtgHweDwexr+twN/3+/3btr/eD789Ho/v8/8LxZ4C9/t927Pv7cS3RRAAe2782+3m8N929P/94SJg3wdBAPx/9gJg3z2w4y93+O849U9+swjY84EQAALAPwHstfcd/nvN+/CvFQGHqS7zQQEgAATAZbbzlz/E4f8l0d4fEAF7zV8ACAABsMeed/jvMefTv1IEnCZc5gICQAAIgGW268s36vB/mW7PL4qAPeYuAASAALj2Xnf4X3u+036dCJhG2+bCAkAACIA223H4jTj8h5PudUERcO15CwABIACuuccd/teca/mvEgHl5GULCgABIADKtlvZQg7/Muo9FhIB15yzABAAAuBae9vhf615tvk1IqDNKIbdiAAQAAJg2HaKX8jhHx/BtW9ABFxrvgJAAAiAa+xph/815tj+V4iA9iM6fIMCQAAIgMPbpe0HHf5tR3PNGxMB15irABAAAmDtvezwX3t+y969CFh2dP/cuAAQAAJg3X3s8F93dpe4cxGw9hgFgAAQAGvuYYf/mnO73F2LgHVHKgAEgABYb/86/Neb2aXvWASsOV4BIAAEwFp71+G/1ry2uVsRsN6oBYAAEADr7FuH/zqz2vJORcBaYxcAAkAArLFnHf5rzGn7uxQB6zwCAkAACID++9Xh339G7vCNgAhY43EQAAJAAPTeqw7/3vNxd38QEAH9Hw0BIAAEQN996vDvOxt3dkBABBxACn5EAAgAARDcgJ8s7fDvORd39aSACHgSrPDjAkAACIDCDXdwKYf/QSgfW0NABPSckwAQAAKg1950+Peah7sZJCACBkEOvIwAEAACYOCGOnkph/9JQF/vLSACes1HAAgAAdBjTzr8e8zBXUwWEAGTgZ+4vAAQAALgiQ0z6aMO/0mwLttTQAT0mIsAEAACILsXHf5Zf6uHBERACP7NsgJAAAiA3D50+OfsrdxAQARkhyAABIAAyOxBh3/G3arNBERAbiACQAAIgPr95/CvN7diYwERkBmOABAAAqB27zn8a72ttoiACKgflAAQAAKgbt85/OusrbSggAioHZoAEAACoGbPOfxrnK2yuIAIqBugABAAAmD+fnP4zze2woUEREDNMAWAABAAc/eaw3+ur6tfVEAEzB+sABAAAmDePnP4z7N15Q0ERMDcIQsAASAA5uwxh/8cV1fdTEAEzBu4ABAAAmD8/nL4jzd1xY0FRMCc4QsAASAAxu4th/9YT1cj8ENABIx/EASAABAA4/aVw3+cpSsR+E1ABIx9KASAABAAY/aUw3+Mo6sQ+FRABIx7QASAABAA5/eTw/+8oSsQOCwgAg5TffpBASAABMC5veTwP+fn2wReEhABL7H950sCQAAIgHP7SACc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\"","export default __webpack_public_path__ + \"static/media/move.26dbfb84.png\";","export default __webpack_public_path__ + \"static/media/overhead.f48ba000.png\";","export default __webpack_public_path__ + \"static/media/quill-ink.d61129e8.png\";","export default __webpack_public_path__ + \"static/media/star.d313c182.png\";"],"sourceRoot":""}