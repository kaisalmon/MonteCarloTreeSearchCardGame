{"version":3,"sources":["cardgame/TextTemplate.ts","cardgame/Components/Effects/ListEffect.ts","cardgame/Components/Effects/RandomTransferEffect.ts","cardgame/Components/Effects/ChangeHealthEffect.ts","cardgame/Components/Effects/setup.ts","cardgame/Card.ts","cardgame/Data/ExampleDecks.ts","MCTS/mcts.ts","cardgame/CardGame.ts","client/CardDisplay.tsx","client/CardPile.tsx","client/GameBoard.tsx","App.tsx","reportWebVitals.ts","index.tsx"],"names":["TextTemplate","constructor","slot","template","factory","regex","slots","this","RegExp","replace","matchAll","map","match","templates","push","text","candidates","filter","toLowerCase","length","Error","errors","results","matches","subTexts","splice","args","i","parse","e","x","result","Eff","Player","N","ListEffect","a","b","applyEffect","state","playerKey","afterA","RandomTransferEffect","target","from","to","targetKey","resolvePlayerKey","player","fromPile","toPile","drawIndex","Math","floor","random","DrawCardEffect","super","resolveSelf","ChangeHealthEffect","amount","health","_","resolveOpponent","n","numberToWords","toWords","Card","preEffect","cardNumber","hand","indexOf","postEffect","discardPile","play","activePlayer","afterPreEffect","afterEffect","EffectCard","getName","name","getText","effect","cardText","promptSync","GameStatus","getPlayerGoal","WIN","LOSE","RandomStrategy","mood","pickMove","game","sensibleMove","sample","getSensibleMoves","validMove","getValidMoves","MCTSStrategy","samples","depth","inPlayHeuristic","simulationStrategy","evaluations","move","score","outOf","unfinished","playerGoal","forEach","evaluation","stateWithScrambledUnknowns","randomizeHiddenInfo","newState","applyMove","simulation","simulateGame","status","DRAW","IN_PLAY","undefined","heuristic","desire","highestEval","maxBy","highestScore","bestMoves","minBy","JSON","stringify","toFixed","goal","curState","getStatus","message","includes","CardGame","cardIndex","deckOne","deckTwo","Object","keys","parseInt","type","applyEndMove","applyCardPlay","applyCardDiscard","p1Dead","playerOne","deck","p2Dead","playerTwo","step","getDiscardMoves","getCardMoves","newGame","newPlayer","board","preGame","print","console","log","chalk","white","blue","red","opponentKey","getHeuristic","bluePoints","max","redPoints","CARD_STYLE","position","backgroundColor","border","fontSize","borderRadius","width","height","margin","top","display","transition","cursor","overflow","zIndex","CARD_TITLE_STYLE","fontWeight","BEING_PLAYED_CARD_STYLE","color","borderColor","transform","marginLeft","marginRight","CAN_BE_DISCADED_STYLE","borderWidth","CAN_BE_PLAYED_STYLE","MOVE_DOWN_STYLE","MOVE_UP_STYLE","HIDDEN_STYLING","CardDisplay","props","card","beingPlayed","situationalStyle","canBeDiscarded","canBePlayed","positionStyling","isOpponent","hiddenStyling","isHidden","onClick","style","PILE_STYLE","CARD_LIST_STYLE","maxHeight","textAlign","overflowY","CardPile","label","cards","getArrowProps","getTooltipProps","setTooltipRef","setTriggerRef","visible","usePopperTooltip","interactive","delayHide","ref","className","WRAPPER_STYLE","alignItems","placeContent","ACTIVE_WRAPPER_STYLE","background","HAND_STYLE","minWidth","justifyContent","HEALTH_WRAPPER_STYLE","HEALTH_STYLE","bottom","left","PlayerDisplay","onCardClick","isActive","lastmove","gamestate","showingTempCards","setShowingTempCards","React","useState","cardsBeingPlayed","displayHand","sort","GameBoard","App","useMemo","setup","playerStrat","greedyStrat","gs","opponentStrat","setGamestate","t","setT","NaN","setMood","setLastMove","getMoveFromCardClick","disabled","performance","now","strat","find","m","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.8f14fc4c.chunk.js","sourcesContent":["import {CardGameState} from \"./CardGame\";\r\nimport {PlayerKey} from \"./Card\";\r\n\r\ntype Component = ResolveSlot<any>\r\ntype GetSlot<T extends Component> = T extends ResolveSlot<infer R> ? R : any;\r\ntype Slot = 'Eff'|'Player'|'N'\r\ntype ResolveSlot<SLOT extends Slot> = SLOT extends 'Eff' ? Effect\r\n                                    : SLOT extends 'Player' ? PlayerTarget\r\n                                    : SLOT extends 'N' ? number\r\n                                    : never;\r\n\r\n\r\nexport type Resolver<T> = {\r\n   resolvePlayerKey(state:CardGameState, playerKey:PlayerKey):T;\r\n}\r\n\r\nexport type PlayerTarget = Resolver<PlayerKey>\r\n\r\nexport interface Effect{\r\n  applyEffect(state:CardGameState, playerKey:PlayerKey):CardGameState;\r\n}\r\n\r\nexport default class TextTemplate<T extends Component, ARGS extends Component[]>{\r\n  template: string;\r\n  regex: RegExp;\r\n  slots: Slot[];\r\n  factory:(...args:ARGS)=>T;\r\n\r\n  static templates:{\r\n    [S in Slot]: TextTemplate<ResolveSlot<S>, Component[]>[]\r\n  } = {\r\n    Eff: [],\r\n    Player: [],\r\n    N:[]\r\n  }\r\n\r\n  constructor(slot: GetSlot<T>, template:string, factory:(...args:ARGS)=>T){\r\n    this.template = template;\r\n    this.regex = new RegExp('^'+template.replace(/%\\w+/g, '(.+)?')+'$');\r\n    this.factory = factory;\r\n    this.slots = [...this.template.matchAll(/%(\\w+)/gi)].map(match=>match[1]) as Slot[]\r\n    TextTemplate.templates[slot].push(this as any);\r\n  }\r\n\r\n  static parse<SLOT extends Slot>(slot: SLOT, text:string):ResolveSlot<SLOT>{\r\n    const templates = TextTemplate.templates[slot] as TextTemplate<ResolveSlot<SLOT>, Component[]>[];\r\n    if(text === undefined){\r\n      debugger\r\n    }\r\n    const candidates = templates.filter((template:TextTemplate<Component, Component[]>) => text.toLowerCase().match(template.regex));\r\n    if(candidates.length === 0) throw new Error(`Invalid text for slot ${slot}: ${text}`);\r\n    const errors:Error[] = [];\r\n    const results = candidates.map((template:TextTemplate<Component, Component[]>)=>{\r\n      try{\r\n        const matches = text.toLowerCase().match(template.regex);\r\n        const subTexts = matches ? matches.splice(1) : [];\r\n        const args = template.slots.map((slot, i)=>{\r\n          return TextTemplate.parse(slot, subTexts[i])\r\n        })\r\n        return template.factory(...args as any) as unknown as ResolveSlot<SLOT>;\r\n      }catch(e){\r\n        errors.push(e);\r\n        return undefined;\r\n      }\r\n    }).filter(x=>x);\r\n    if(results.length === 0){\r\n      if(errors.length > 1){\r\n        throw new Error(\"Invalid text: \"+text);\r\n      }else{\r\n        throw errors[0];\r\n      }\r\n    }\r\n    // TODO: select by shortest depth\r\n    const [result] = results;\r\n    if(!result){\r\n      throw Error()\r\n    }\r\n    return result;\r\n  }\r\n}","import TextTemplate, {Effect} from \"../../TextTemplate\";\r\nimport {CardGameState} from \"../../CardGame\";\r\nimport {PlayerKey} from \"../../Card\";\r\n\r\nclass ListEffect implements Effect{\r\n    a:Effect;\r\n    b:Effect;\r\n    constructor(a:Effect, b:Effect) {\r\n        this.a = a;\r\n        this.b = b;\r\n    }\r\n    applyEffect(state: CardGameState, playerKey:PlayerKey): CardGameState {\r\n        const afterA = this.a.applyEffect(state, playerKey);\r\n        return this.b.applyEffect(afterA, playerKey);\r\n    }\r\n}\r\n\r\nexport default function setup(){\r\n    new TextTemplate('Eff', '%Eff and %Eff', (a:Effect, b:Effect)=>new ListEffect(a,b));\r\n    new TextTemplate('Eff', '%Eff, and %Eff', (a:Effect, b:Effect)=>new ListEffect(a,b));\r\n    new TextTemplate('Eff', '%Eff, %Eff', (a:Effect, b:Effect)=>new ListEffect(a,b));\r\n    new TextTemplate('Eff', '%Eff then %Eff', (a:Effect, b:Effect)=>new ListEffect(a,b));\r\n    new TextTemplate('Eff', '%Eff, then %Eff', (a:Effect, b:Effect)=>new ListEffect(a,b));\r\n}","import TextTemplate, {Effect, PlayerTarget} from \"../../TextTemplate\";\r\nimport {CardGamePlayerState, CardGameState} from \"../../CardGame\";\r\nimport {PlayerKey} from \"../../Card\";\r\nimport {resolveSelf} from \"./setup\";\r\n\r\ntype KeysMatching<T, V> = {[K in keyof T]-?: T[K] extends V ? K : never}[keyof T];\r\n\r\nclass RandomTransferEffect implements Effect{\r\n    target:PlayerTarget\r\n    from:KeysMatching<CardGamePlayerState, readonly number[]>;\r\n    to:KeysMatching<CardGamePlayerState, readonly number[]>;\r\n    constructor(target:PlayerTarget, from:KeysMatching<CardGamePlayerState, readonly number[]>, to:KeysMatching<CardGamePlayerState, readonly number[]>) {\r\n        this.target = target;\r\n        this.from = from;\r\n        this.to = to;\r\n    }\r\n\r\n    applyEffect(state: CardGameState, playerKey:PlayerKey): CardGameState {\r\n        const targetKey = this.target.resolvePlayerKey(state, playerKey);\r\n        const player = state[targetKey];\r\n        const fromPile = [...player[this.from]];\r\n        const toPile = [...player[this.to]];\r\n        const drawIndex = Math.floor(Math.random() * fromPile.length);\r\n        toPile.push(...fromPile.splice(drawIndex, 1))\r\n        return {\r\n            ...state,\r\n            [targetKey]:{\r\n                ...player,\r\n                [this.to]:toPile,\r\n                [this.from]:fromPile\r\n            }\r\n        }\r\n    }\r\n}\r\nclass DrawCardEffect extends RandomTransferEffect{\r\n    constructor(target?:PlayerTarget) {\r\n        super(target || resolveSelf,'deck', 'hand');\r\n    }\r\n}\r\n\r\nexport default function setup(){\r\n    new TextTemplate('Eff', '%Player draws? a card', (target:PlayerTarget)=>new DrawCardEffect(target));\r\n\r\n    new TextTemplate('Eff', 'draw a card', ()=>new DrawCardEffect());\r\n    new TextTemplate('Eff', 'draw the top card of your deck', ()=>new DrawCardEffect());\r\n    new TextTemplate('Eff', 'draw a card from your deck', ()=>new DrawCardEffect());\r\n\r\n    new TextTemplate('Eff', 'discard a random card(?: from your hand)', ()=>new RandomTransferEffect(resolveSelf, 'hand','discardPile'));\r\n    new TextTemplate('Eff', '%Player discards? a random card(?: from your hand)', (target:PlayerTarget)=>new RandomTransferEffect(target, 'hand','discardPile'));\r\n\r\n    new TextTemplate('Eff', 'discard the top card (?:from|of) your deck', ()=>new RandomTransferEffect(resolveSelf, 'deck','discardPile'));\r\n    new TextTemplate('Eff', '%Player discards? the top card (?:from|of) (?:their|your) deck', (target:PlayerTarget)=>new RandomTransferEffect(target, 'deck','discardPile'));\r\n}","import TextTemplate, {Effect, PlayerTarget} from \"../../TextTemplate\";\r\nimport {CardGameState} from \"../../CardGame\";\r\nimport {PlayerKey} from \"../../Card\";\r\n\r\nclass ChangeHealthEffect implements Effect{\r\n    target:PlayerTarget\r\n    amount:number;\r\n    constructor(target:PlayerTarget, amount:number) {\r\n        this.target=target;\r\n        this.amount=amount;\r\n    }\r\n    applyEffect(state: CardGameState, playerKey:PlayerKey): CardGameState {\r\n        const targetKey = this.target.resolvePlayerKey(state, playerKey);\r\n        return {\r\n            ...state,\r\n            [targetKey]:{\r\n                ...state[targetKey],\r\n                health:state[targetKey].health + this.amount\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport default function setup(){\r\n    new TextTemplate('Eff', 'deal %N damage to %Player', (n:number, target:PlayerTarget)=>new ChangeHealthEffect(target, -n));\r\n    new TextTemplate('Eff', 'remove %N damage to %Player', (n:number, target:PlayerTarget)=>new ChangeHealthEffect(target, n));\r\n    new TextTemplate('Eff', '%Player loses? %N health', (target:PlayerTarget, n:number)=>new ChangeHealthEffect(target, -n));\r\n    new TextTemplate('Eff', '%Player gains? %N health', (target:PlayerTarget, n:number)=>new ChangeHealthEffect(target, n));\r\n}","import setupList from './ListEffect';\r\nimport setupDraw from './RandomTransferEffect';\r\nimport setupDamage from './ChangeHealthEffect';\r\nimport TextTemplate, {PlayerTarget} from \"../../TextTemplate\";\r\nimport {PlayerKey} from \"../../Card\";\r\nimport numberToWords from 'number-to-words';\r\n\r\nexport const resolveSelf:PlayerTarget = {\r\n    resolvePlayerKey(_, playerKey: PlayerKey):PlayerKey {\r\n        return playerKey;\r\n    }\r\n}\r\nconst resolveOpponent:PlayerTarget = {\r\n    resolvePlayerKey(_, playerKey: PlayerKey):PlayerKey {\r\n        return playerKey === 'playerOne' ? 'playerTwo' : 'playerOne';\r\n    }\r\n}\r\n\r\n\r\nexport default function () {\r\n    for(let n = 0; n < 25;n++){\r\n        new TextTemplate('N',numberToWords.toWords(n),()=>n)\r\n        new TextTemplate('N',`${n}`,()=>n)\r\n    }\r\n    new TextTemplate('Player','yourself',()=>resolveSelf)\r\n    new TextTemplate('Player','you',()=>resolveSelf)\r\n    new TextTemplate('Player','your opponent',()=>resolveOpponent)\r\n    new TextTemplate('Player','the other player',()=>resolveOpponent)\r\n    setupList();\r\n    setupDraw();\r\n    setupDamage();\r\n}","import {CardGameState} from \"./CardGame\";\r\nimport {Effect} from \"./TextTemplate\";\r\n\r\nexport type PlayerKey = 'playerOne'|'playerTwo'\r\n\r\nexport abstract class Card{\r\n    abstract getName():string;\r\n    abstract getText():string;\r\n    abstract applyEffect(state:CardGameState, playerKey:PlayerKey):CardGameState;\r\n\r\n    private preEffect(state:CardGameState, cardNumber:number, playerKey:PlayerKey):CardGameState{\r\n        const player = state[playerKey];\r\n        const hand = [...player.hand]\r\n        hand.splice(hand.indexOf(cardNumber), 1);\r\n        return {\r\n            ...state,\r\n            [playerKey]: {\r\n                ...player,\r\n                hand\r\n            }\r\n        }\r\n    }\r\n\r\n    protected postEffect(state:CardGameState, cardNumber:number, playerKey:PlayerKey):CardGameState{\r\n        return {\r\n            ...state,\r\n            [playerKey]: {\r\n                ...state[playerKey],\r\n                discardPile: [cardNumber, ...state[playerKey].discardPile]\r\n            }\r\n        }\r\n    }\r\n\r\n    play(state:CardGameState, cardNumber:number):CardGameState{\r\n        const playerKey = state.activePlayer  === 1 ? 'playerOne' : 'playerTwo';\r\n        const afterPreEffect = this.preEffect(state,cardNumber,playerKey);\r\n        const afterEffect = this.applyEffect(afterPreEffect, playerKey);\r\n        return this.postEffect(afterEffect,cardNumber,playerKey);\r\n    }\r\n}\r\n\r\nexport class EffectCard extends Card{\r\n    effect: Effect;\r\n    name: string;\r\n    text: string;\r\n    getName(): string {\r\n        return this.name;\r\n    }\r\n\r\n    getText(): string {\r\n        return this.text;\r\n    }\r\n    constructor(effect:Effect, text:string, name:string) {\r\n        super();\r\n        this.effect = effect;\r\n        this.text = text;\r\n        this.name = name;\r\n    }\r\n    applyEffect(state: CardGameState, playerKey:PlayerKey): CardGameState {\r\n        return this.effect.applyEffect(state, playerKey)\r\n    }\r\n}\r\n\r\nexport abstract class ItemCard extends Card{\r\n    applyEffect(state: CardGameState): CardGameState {\r\n        return state;\r\n    }\r\n\r\n    protected postEffect(state:CardGameState, cardNumber:number, playerKey:PlayerKey):CardGameState{\r\n        return {\r\n            ...state,\r\n            [playerKey]: {\r\n                ...state[playerKey],\r\n                board: [cardNumber, ...state[playerKey].board]\r\n            }\r\n        }\r\n    }\r\n    abstract getName():string;\r\n    abstract getText():string;\r\n}\r\n","import setup from '../Components/Effects/setup';\r\nimport {Card, EffectCard} from \"../Card\";\r\nimport TextTemplate from \"../TextTemplate\";\r\n\r\nconst cardText = [\r\n    'Deal one damage to your opponent',\r\n    'Deal two damage to your opponent',\r\n    'Deal three damage to your opponent and deal one damage to yourself',\r\n    'Deal one damage to yourself then draw a card',\r\n    'Deal one damage to yourself then draw a card',\r\n    'You gain one health',\r\n    'You gain one health and you draw a card',\r\n    'Your opponent discards the top card from their deck',\r\n    'Discard the top card from your deck, then you gain two health',\r\n    'Deal two damage to your opponent',\r\n    'Deal three damage to your opponent',\r\n]\r\n\r\nexport default function():Record<number, Card>{\r\n    setup()\r\n    return [...cardText,...cardText,...cardText,...cardText].map((text, i)=>{\r\n        const effect = TextTemplate.parse('Eff', text);\r\n        return new EffectCard(effect,text, `#${i}`);\r\n    })\r\n}","import _ from 'lodash';\r\nimport promptSync from 'prompt-sync'\r\nconst prompt = promptSync();\r\n\r\nexport enum GameStatus{\r\n    IN_PLAY='IN_PLAY',\r\n    LOSE='RED_WIN',\r\n    WIN='BLUE_WIN',\r\n    DRAW='DRAW'\r\n}\r\n\r\nconst getPlayerGoal = (player:1|2) => player === 1 ? GameStatus.WIN : GameStatus.LOSE;\r\n\r\ninterface GameState{\r\n    activePlayer: 1|2,\r\n}\r\n\r\nexport interface Game<STATE extends GameState, T>{\r\n    newGame():STATE;\r\n     getValidMoves(state:STATE):T[];\r\n     print(state:STATE):void;\r\n     getSensibleMoves(state:STATE):T[];\r\n     randomizeHiddenInfo(state:STATE):STATE;\r\n     applyMove(state:STATE, move:T):STATE;\r\n     getStatus(state:STATE):GameStatus;\r\n}\r\n\r\nexport interface Strategy<STATE extends GameState, T>{\r\n    mood: string;\r\n    pickMove(game:Game<STATE,T>, state:STATE):T;\r\n}\r\n\r\nexport type StateFromGame<G> = G extends Game<infer U,any> ?  U : never;\r\nexport type MoveFromGame<G> = G extends Game<any, infer U> ?  U : never;\r\n\r\nexport class RandomStrategy<STATE extends GameState, T> implements Strategy<STATE, T>{\r\n    mood = \"none\";\r\n    pickMove(game:Game<STATE, T>, state: STATE): T {\r\n        const sensibleMove = _.sample(game.getSensibleMoves(state))\r\n        if (sensibleMove){\r\n            this.mood = \"Sensible\"\r\n            return sensibleMove;\r\n        }else{\r\n            this.mood = \"Not Sensible\"\r\n        }\r\n        const validMove = _.sample(game.getValidMoves(state))\r\n        if (validMove) {\r\n            return validMove;\r\n        }\r\n        throw new Error('No valid moves')\r\n    }\r\n}\r\n\r\nexport class InputStrategy<STATE extends GameState, T> implements Strategy<STATE, T> {\r\n    mood=\"player\"\r\n    transform:(str:string)=>T;\r\n    constructor(transform:(str:string)=>T) {\r\n        this.transform = transform;\r\n    }\r\n\r\n    pickMove(game: Game<STATE, T>, state: STATE): T {\r\n        game.print(state);\r\n        return this.transform(prompt(\"What's your move?\"))\r\n    }\r\n\r\n}\r\nexport class GreedyStrategy<STATE extends GameState, T> extends RandomStrategy<STATE, T> {\r\n    mood = \"greedy\"\r\n    pickMove(game: Game<STATE, T>, state: STATE): T {\r\n        const playerGoal = getPlayerGoal(state.activePlayer);\r\n        const winningMove = game.getValidMoves(state).find(move=>game.getStatus(game.applyMove(state,move)) === playerGoal)\r\n        if(winningMove) {\r\n            return winningMove;\r\n        }\r\n        return super.pickMove(game, state);\r\n    }\r\n}\r\n\r\nexport class MCTSStrategy<STATE extends GameState, T>implements Strategy<STATE, T>{\r\n    mood = \"waiting...\"\r\n    simulationStrategy: Strategy<STATE, T>;\r\n    samples:number;\r\n    depth:number;\r\n    inPlayHeuristic:(state:STATE)=>number;\r\n\r\n    constructor(samples=60, depth=100, inPlayHeuristic: (state:STATE)=>number = ()=>0, simulationStrategy:Strategy<STATE, T> = new RandomStrategy()) {\r\n        this.simulationStrategy = simulationStrategy;\r\n        this.depth = depth;\r\n        this.samples = samples;\r\n        this.inPlayHeuristic = inPlayHeuristic;\r\n    }\r\n\r\n    pickMove(game:Game<STATE, T>, state: STATE): T {\r\n        const evaluations = game.getValidMoves(state).map(move=>({move, score:0, outOf:0, depth: 0,unfinished:0}));\r\n        if(evaluations.length === 0) throw new Error('No valid moves')\r\n        const playerGoal = getPlayerGoal(state.activePlayer);\r\n        for(let i = 0; i < this.samples; i++){\r\n            evaluations.forEach(evaluation=>{\r\n                const stateWithScrambledUnknowns = game.randomizeHiddenInfo(state);\r\n                const newState = game.applyMove(stateWithScrambledUnknowns, evaluation.move);\r\n                const simulation = this.simulateGame(game, newState) ;\r\n                evaluation.outOf++;\r\n                if(simulation.status === playerGoal){\r\n                    evaluation.score++;\r\n                }else if(simulation.status !== GameStatus.DRAW && simulation.status !== GameStatus.IN_PLAY){\r\n                    evaluation.score--;\r\n                }else if(simulation.heuristic !== undefined){\r\n                    const desire = state.activePlayer === 1 ? 1 : -1;\r\n                    evaluation.score += simulation.heuristic * desire ;\r\n                    evaluation.unfinished++;\r\n                }\r\n                evaluation.depth += simulation.length;\r\n            })\r\n        }\r\n        const highestEval =  _.maxBy(evaluations, 'score')!;\r\n        const highestScore = highestEval.score / highestEval.outOf\r\n        const bestMoves = evaluations.filter(({score,outOf})=>(score/outOf) > highestScore - 0.01)\r\n\r\n        if(highestScore > 0.9) {\r\n            const result = _.minBy(bestMoves, 'depth')!\r\n            this.mood = JSON.stringify({\r\n                score: (result.score/result.outOf).toFixed(2),\r\n                goal: 'Minimizing Length to Victory',\r\n                depth: (result.depth / result.outOf).toFixed(2),\r\n                unfinished: (result.unfinished / result.outOf).toFixed(2)\r\n            })\r\n            return result.move;\r\n        }else if(highestScore < -0.9){\r\n            const result = _.maxBy(bestMoves, 'depth')!\r\n            this.mood = JSON.stringify({\r\n                score: (result.score/result.outOf).toFixed(2),\r\n                goal: 'Delaying time till loss',\r\n                depth: (result.depth / result.outOf).toFixed(2),\r\n                unfinished: (result.unfinished / result.outOf).toFixed(2)\r\n            })\r\n            return result.move;\r\n        }else{\r\n            const result =  _.maxBy(bestMoves, 'score')!\r\n            this.mood = JSON.stringify({\r\n                score: (result.score / result.outOf).toFixed(3),\r\n                depth: (result.depth / result.outOf).toFixed(2),\r\n                unfinished: (result.unfinished / result.outOf).toFixed(2)\r\n            })\r\n            return  result.move;\r\n        }\r\n    }\r\n    simulateGame(game:Game<STATE, T>, state:STATE):{status:GameStatus, length:number, heuristic?:number}{\r\n        let curState = state;\r\n        for(let i = 0; i < this.depth; i++){\r\n            const status = game.getStatus(curState);\r\n            if(status !== GameStatus.IN_PLAY) return {status, length: i};\r\n            try{\r\n                const move = this.simulationStrategy.pickMove(game, curState);\r\n                if(!move) return {status: GameStatus.DRAW, length: i};\r\n                curState = game.applyMove(curState, move);\r\n            }catch(e){\r\n                if(e.message.includes('No valid move')) return {status: GameStatus.DRAW, length: i};\r\n                throw e;\r\n            }\r\n        }\r\n        return {status: GameStatus.IN_PLAY, length: this.depth, heuristic: this.inPlayHeuristic(curState)};\r\n    }\r\n}\r\n\r\n","import {Game, GameStatus} from \"../MCTS/mcts\";\r\nimport chalk from 'chalk'\r\nimport {Card} from \"./Card\";\r\n\r\nexport interface CardGamePlayerState {\r\n    readonly health: number;\r\n    readonly hand: readonly number[];\r\n    readonly board: readonly number[];\r\n    readonly discardPile: readonly number[];\r\n    readonly deck: readonly number[];\r\n}\r\n\r\nexport interface CardGameState {\r\n    readonly activePlayer: 1|2;\r\n    readonly step: 'draw'|'play'\r\n    readonly playerOne: CardGamePlayerState\r\n    readonly playerTwo: CardGamePlayerState;\r\n    readonly log?:string[],\r\n}\r\n\r\ninterface CardGamePlayCardMove {type:\"play\"; cardNumber:number}\r\ninterface CardGameDiscardCardMove{type:\"discard\"; cardNumber:number}\r\ninterface CardGameEndMove {type:\"end\"}\r\nexport type CardGameMove = CardGameEndMove | CardGamePlayCardMove | CardGameDiscardCardMove;\r\n\r\nconst HAND_SIZE = 6;\r\n\r\nexport default class CardGame implements Game<CardGameState, CardGameMove>{\r\n\r\n    cardIndex:Record<number, Card>;\r\n    deckOne:number[];\r\n    deckTwo:number[];\r\n\r\n    constructor(cardIndex:Record<number,Card>, deckOne?:number[], deckTwo?:number[]){\r\n        this.cardIndex = cardIndex;\r\n        this.deckOne = deckOne ? deckOne : Object.keys(this.cardIndex).map(i=>parseInt(i));\r\n        this.deckTwo = deckTwo ? deckTwo : this.deckOne;\r\n    }\r\n\r\n    applyMove(state: CardGameState, move: CardGameMove): CardGameState {\r\n        if(move.type === \"end\"){\r\n            return this.applyEndMove(state);\r\n        }else if(move.type === \"play\"){\r\n            return this.applyCardPlay(state, move.cardNumber)\r\n        }else if(move.type === \"discard\"){\r\n            return this.applyCardDiscard(state, move.cardNumber)\r\n        }\r\n        throw new Error(\"Unknown move\")\r\n    }\r\n\r\n    getSensibleMoves(state: CardGameState): CardGameMove[] {\r\n        return [];\r\n    }\r\n\r\n    getStatus(state: CardGameState): GameStatus {\r\n        const p1Dead = state.playerOne.deck.length === 0 ||  state.playerOne.health <= 0;\r\n        const p2Dead = state.playerTwo.deck.length === 0 ||  state.playerTwo.health <= 0;\r\n        if(p1Dead && p2Dead) return GameStatus.DRAW;\r\n        if(p1Dead) return GameStatus.LOSE;\r\n        if(p2Dead) return GameStatus.WIN;\r\n        return GameStatus.IN_PLAY;\r\n    }\r\n\r\n    getValidMoves(state: CardGameState): CardGameMove[] {\r\n        if(state.step === 'draw'){\r\n            return this.getDiscardMoves(state);\r\n        }\r\n        return [{type:\"end\"}, ...this.getCardMoves(state)]\r\n    }\r\n\r\n    newGame(): CardGameState {\r\n        const newPlayer = {\r\n            hand:[],\r\n            health: 30,\r\n            discardPile:[],\r\n            board:[]\r\n        }\r\n        const preGame:CardGameState = {\r\n            activePlayer: 2, //Will flip when we run end turn logic\r\n            step: 'play', // Will also flip\r\n            playerOne:{\r\n                deck: this.deckOne,\r\n                ...newPlayer\r\n            },\r\n            playerTwo:{\r\n                deck: this.deckTwo,\r\n                ...newPlayer\r\n            }\r\n        };\r\n        return this.applyEndMove(preGame);\r\n    }\r\n\r\n    print( {playerOne, playerTwo, ...state}: CardGameState): void {\r\n        console.log(chalk.white(JSON.stringify(state,null,4)))\r\n        console.log(chalk.blue(JSON.stringify(playerOne,null,4)))\r\n        console.log(chalk.red(JSON.stringify(playerTwo,null,4)))\r\n    }\r\n\r\n    randomizeHiddenInfo(state: CardGameState): CardGameState {\r\n        const opponentKey = state.activePlayer === 1 ? 'playerTwo' : 'playerOne'\r\n\r\n        // Put their hand back into the deck, then draw up to the same number\r\n        const deck = [...state[opponentKey].deck, ...state[opponentKey].hand];\r\n        const hand = []\r\n        for(let i = 0; i < state[opponentKey].hand.length; i++){\r\n           const drawIndex = Math.floor(Math.random() * deck.length);\r\n            hand.push(...deck.splice(drawIndex, 1))\r\n        }\r\n\r\n        return {\r\n            ...state,\r\n            [opponentKey]:{\r\n                ...state[opponentKey],\r\n                hand,\r\n                deck\r\n            }\r\n        };\r\n    }\r\n\r\n    private getCardMoves(state: CardGameState):CardGamePlayCardMove[] {\r\n        const activePlayer = state.activePlayer === 1 ? state.playerOne : state.playerTwo;\r\n        return activePlayer.hand.map(cardNumber=>({type:\"play\", cardNumber}))\r\n    }\r\n   private getDiscardMoves(state: CardGameState):CardGameDiscardCardMove[] {\r\n        const activePlayer = state.activePlayer === 1 ? state.playerOne : state.playerTwo;\r\n        return activePlayer.hand.map(cardNumber=>({type:\"discard\", cardNumber}))\r\n    }\r\n\r\n    private applyEndMove(state: CardGameState):CardGameState {\r\n        const DRAW_UP_TO = 7;\r\n\r\n        const activePlayer = state.activePlayer === 1 ? 2 : 1;\r\n        const playerKey = activePlayer  === 1 ? 'playerOne' : 'playerTwo';\r\n        const player = state[playerKey];\r\n\r\n        const deck = [...player.deck];\r\n        const hand = [...player.hand];\r\n\r\n        while(hand.length < DRAW_UP_TO && deck.length > 0){\r\n            const drawIndex = Math.floor(Math.random() * deck.length);\r\n            hand.push(...deck.splice(drawIndex, 1))\r\n        }\r\n\r\n        const newPlayer:CardGamePlayerState = {\r\n            ...player,\r\n            deck,\r\n            hand\r\n        }\r\n\r\n        return {\r\n            ...state,\r\n            step: 'draw',\r\n            [playerKey]: newPlayer,\r\n            activePlayer,\r\n        }\r\n    }\r\n\r\n    private applyCardPlay(state: CardGameState, cardNumber: number):CardGameState {\r\n        const card = this.cardIndex[cardNumber];\r\n        return card.play(state, cardNumber)\r\n    }\r\n    private applyCardDiscard(state: CardGameState, cardNumber: number):CardGameState {\r\n        const playerKey = state.activePlayer  === 1 ? 'playerOne' : 'playerTwo';\r\n        const player = state[playerKey];\r\n\r\n        const hand = [...player.hand];\r\n        const discardPile = [...player.discardPile];\r\n        discardPile.push(...hand.splice(hand.indexOf(cardNumber), 1))\r\n        return {\r\n            ...state,\r\n            step: hand.length > HAND_SIZE ? 'draw' :'play',\r\n            [playerKey]:{\r\n                ...player,\r\n                hand,\r\n                discardPile\r\n            }\r\n        }\r\n    }\r\n\r\n    getHeuristic(state: CardGameState):number {\r\n        const bluePoints = Math.max(0, state.playerOne.health * state.playerOne.deck.length)\r\n        const redPoints = Math.max(0, state.playerTwo.health * state.playerTwo.deck.length)\r\n        if(bluePoints === redPoints) return 0;\r\n        return (bluePoints-redPoints)/(redPoints+bluePoints)\r\n    }\r\n}","import React, {CSSProperties, FunctionComponent} from \"react\";\r\nimport {Card} from \"../cardgame/Card\";\r\n\r\ntype CardProps = {\r\n    card:Card,\r\n    onClick:()=>void,\r\n    isOpponent:boolean;\r\n    beingPlayed:boolean;\r\n    canBeDiscarded:boolean;\r\n    canBePlayed:boolean;\r\n    isHidden:boolean;\r\n}\r\n\r\nconst CARD_STYLE:CSSProperties ={\r\n    position: \"relative\",\r\n    backgroundColor: 'white',\r\n    border: '1px solid black',\r\n    fontSize: 11,\r\n    borderRadius: 3,\r\n    width: 80,\r\n    height: 120,\r\n    margin: 5,\r\n    top:0,\r\n    display: 'inline-block',\r\n    transition: 'transform 0.3s, margin 0.35s ease-in 0.3s, top 0.4s ease-in-out 0.5s',\r\n    cursor: 'not-allowed',\r\n    overflow: 'hidden',\r\n    zIndex: 0,\r\n}\r\nconst CARD_TITLE_STYLE:CSSProperties ={\r\n    fontWeight: 'bold',\r\n    fontSize: 16,\r\n}\r\nconst BEING_PLAYED_CARD_STYLE = {\r\n    ...CARD_STYLE,\r\n    color: 'blue',\r\n    borderColor: 'black',\r\n    transform: \"scale(1.3)\",\r\n    marginLeft: -40,\r\n    marginRight: -40,\r\n    zIndex: 1,\r\n}\r\nconst CAN_BE_DISCADED_STYLE = {\r\n    ...CARD_STYLE,\r\n    borderColor: 'red',\r\n    borderWidth: 3,\r\n    cursor: 'pointer'\r\n}\r\nconst CAN_BE_PLAYED_STYLE = {\r\n    ...CARD_STYLE,\r\n    borderColor: 'blue',\r\n    borderWidth: 3,\r\n    cursor: 'pointer',\r\n}\r\n\r\nconst MOVE_DOWN_STYLE = {\r\n    top: 160,\r\n}\r\nconst MOVE_UP_STYLE = {\r\n    top: -160,\r\n}\r\n\r\nconst HIDDEN_STYLING = {\r\n    backgroundColor: 'darkgray',\r\n    color: 'darkgray',\r\n    transform: 'rotate3d(0,1,0,0.5turn)'\r\n}\r\n\r\nconst CardDisplay:FunctionComponent<CardProps> = (props)=>{\r\n    const {card, beingPlayed} = props;\r\n    const situationalStyle = props.canBeDiscarded ? CAN_BE_DISCADED_STYLE :\r\n                            props.canBePlayed ? CAN_BE_PLAYED_STYLE :\r\n                                {};\r\n    const positionStyling = (props.beingPlayed && props.isOpponent) ? MOVE_DOWN_STYLE :\r\n                            (props.beingPlayed && !props.isOpponent) ? MOVE_UP_STYLE :\r\n                                {};\r\n    const hiddenStyling = props.isHidden ? HIDDEN_STYLING : {}\r\n    const onClick = props.canBeDiscarded || props.canBePlayed ? props.onClick : ()=>{};\r\n    return <div style={{...beingPlayed ? BEING_PLAYED_CARD_STYLE : CARD_STYLE, ...situationalStyle, ...positionStyling, ...hiddenStyling}} onClick={onClick}>\r\n        <div style={CARD_TITLE_STYLE}>\r\n            {card.getName()}\r\n        </div>\r\n          <div>\r\n            {card.getText()}\r\n        </div>\r\n    </div>\r\n}\r\n\r\nexport default CardDisplay;","import {Card} from \"../cardgame/Card\";\r\nimport React, {CSSProperties} from \"react\";\r\nimport { usePopperTooltip } from \"react-popper-tooltip\";\r\nimport \"react-popper-tooltip/dist/styles.css\";\r\n\r\ntype CardPileProps = {\r\n    label: string,\r\n    cards:(Card|'?')[],\r\n}\r\n\r\nconst PILE_STYLE:CSSProperties = {\r\n    border: '1px solid black',\r\n    fontSize: 10,\r\n    borderRadius: 3,\r\n    width: 40,\r\n    height: 60,\r\n    margin: 5,\r\n    display: 'inline-block'\r\n}\r\nconst CARD_LIST_STYLE:CSSProperties = {\r\n    maxHeight: 200,\r\n    fontSize: 10,\r\n    textAlign: 'left',\r\n    width: 150,\r\n    overflowY: 'auto'\r\n}\r\n\r\nconst CardPile:React.FunctionComponent<CardPileProps> = props=>{\r\n    const {\r\n        label,\r\n        cards\r\n    } = props;\r\n        const {\r\n    getArrowProps,\r\n    getTooltipProps,\r\n    setTooltipRef,\r\n    setTriggerRef,\r\n    visible\r\n  } = usePopperTooltip({ interactive: true, delayHide: 100 });\r\n\r\n    return <>\r\n            <div style={PILE_STYLE} ref={setTriggerRef}>\r\n                {props.label}\r\n                <div>{cards.length}</div>\r\n            </div>\r\n         {visible && (\r\n          <div\r\n            ref={setTooltipRef}\r\n            {...getTooltipProps({ className: \"tooltip-container\" })}\r\n          >\r\n              {cards.length===0 && <i>Empty</i>}\r\n              <ul style={CARD_LIST_STYLE}>\r\n                  {cards.map(card=><li>\r\n                      <b>{typeof card === 'string' ? card : card.getName()}</b>\r\n                      {' '}\r\n                        {typeof card !== 'string' && card.getText()}\r\n                  </li>)}\r\n              </ul>\r\n            <div {...getArrowProps({ className: \"tooltip-arrow\" })} />\r\n          </div>\r\n        )}\r\n        </>\r\n}\r\n\r\nexport default CardPile;","import CardGame, {CardGameMove, CardGamePlayerState, CardGameState} from \"../cardgame/CardGame\";\r\nimport React, {CSSProperties, FunctionComponent, useEffect} from \"react\";\r\nimport CardDisplay  from \"./CardDisplay\";\r\n\r\nimport FlipMove from 'react-flip-move';\r\nimport CardPile from \"./CardPile\";\r\n\r\ntype GameBoardProps = {\r\n    gamestate: CardGameState;\r\n    game: CardGame,\r\n    lastmove: CardGameMove;\r\n    onCardClick: (n:number)=>void;\r\n}\r\ntype PlayerDisplayProps = {\r\n    isHidden: boolean;\r\n    isActive: boolean;\r\n    lastmove?: CardGameMove;\r\n    player: CardGamePlayerState;\r\n    gamestate: CardGameState;\r\n    game: CardGame;\r\n    onCardClick: (n:number)=>void;\r\n}\r\n\r\nconst WRAPPER_STYLE:CSSProperties = {\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n    placeContent: 'center',\r\n}\r\n\r\nconst ACTIVE_WRAPPER_STYLE = {\r\n    ...WRAPPER_STYLE,\r\n    background: 'gold',\r\n}\r\n\r\nconst HAND_STYLE = {\r\n    display: 'inline-flex',\r\n    minWidth: 400,\r\n    justifyContent:'center'\r\n}\r\nconst HEALTH_WRAPPER_STYLE:CSSProperties = {\r\n    fontSize: 60,\r\n    position: \"relative\",\r\n}\r\nconst HEALTH_STYLE:CSSProperties = {\r\n    position: \"absolute\",\r\n    bottom:25,\r\n    left: 18,\r\n    width: 20,\r\n    fontSize: 16,\r\n    color: \"white\",\r\n    textAlign: 'center'\r\n}\r\n\r\nconst PlayerDisplay:FunctionComponent<PlayerDisplayProps> = ({onCardClick, game, player, isActive, isHidden, lastmove, gamestate})=>{\r\n    const [showingTempCards, setShowingTempCards] = React.useState(true)\r\n    const cardsBeingPlayed = lastmove && lastmove.type === 'play' ? [lastmove.cardNumber] : []\r\n\r\n\r\n    const displayHand = [...player.hand, ...cardsBeingPlayed].sort((a,b)=>a-b)\r\n\r\n    return <div style={isActive ? ACTIVE_WRAPPER_STYLE : WRAPPER_STYLE}>\r\n        <div style={HEALTH_WRAPPER_STYLE}>\r\n            ❤\r\n           <div style={HEALTH_STYLE}>\r\n            {player.health}\r\n        </div>\r\n        </div>\r\n        <FlipMove style={{...HAND_STYLE}}>\r\n            {displayHand.length === 0 &&  (<pre>(Empty Hand)</pre>)}\r\n            {displayHand.map(n=>(showingTempCards || !cardsBeingPlayed.includes(n)) && <div key={n}>\r\n                <CardDisplay\r\n                    onClick={()=>onCardClick(n)}\r\n                    isOpponent={isHidden}\r\n                    isHidden={isHidden && !cardsBeingPlayed.includes(n)}\r\n                    card={game.cardIndex[n]}\r\n                    canBePlayed={isActive && !isHidden && gamestate.step === 'play' && !cardsBeingPlayed.includes(n)}\r\n                    canBeDiscarded={isActive && !isHidden && gamestate.step === 'draw' && !cardsBeingPlayed.includes(n)}\r\n                    beingPlayed={cardsBeingPlayed.includes(n)}\r\n                />\r\n            </div>)}\r\n        </FlipMove>\r\n        <CardPile\r\n            label=\"deck\"\r\n            cards={player.deck.map(n=>isHidden ? '?' : game.cardIndex[n] )}\r\n        />\r\n        <CardPile\r\n            label=\"discard\"\r\n            cards={player.discardPile.map(n=>game.cardIndex[n])}\r\n        />\r\n    </div>\r\n}\r\n\r\nconst GameBoard:FunctionComponent<GameBoardProps> = (props)=>{\r\n    const {gamestate, game, lastmove, onCardClick} = props;\r\n    return <>\r\n        <div>\r\n            Step: {gamestate.step}\r\n        </div>\r\n        <PlayerDisplay onCardClick={()=>{}} game={game} gamestate={gamestate} player={gamestate.playerTwo} lastmove={gamestate.activePlayer === 2 ? lastmove: undefined} isActive={gamestate.activePlayer === 2} isHidden={true}/>\r\n        <div style={{height: \"50vh\"}}></div>\r\n        <PlayerDisplay onCardClick={onCardClick} game={game} gamestate={gamestate} player={gamestate.playerOne} lastmove={gamestate.activePlayer === 1 ? lastmove: undefined} isActive={gamestate.activePlayer === 1} isHidden={false}/>\r\n    </>\r\n}\r\n\r\nexport default GameBoard;","import React, {useMemo} from 'react';\nimport './App.css';\nimport {Card} from \"./cardgame/Card\";\nimport loadExampleDeck from \"./cardgame/Data/ExampleDecks\";\nimport CardGame, {CardGameMove, CardGameState} from \"./cardgame/CardGame\";\nimport {GameStatus, MCTSStrategy, MoveFromGame, RandomStrategy, StateFromGame, Strategy} from \"./MCTS/mcts\";\nimport GameBoard from \"./client/GameBoard\";\n\nfunction getMoveFromCardClick(gamestate:CardGameState, cardNumber:number):CardGameMove{\n    if(gamestate.step=='draw')return {type:'discard', cardNumber}\n    else return {type:'play', cardNumber}\n}\n\nfunction App() {\n  const cardIndex:Record<number, Card> = useMemo(()=>loadExampleDeck(), []);\n  const deck = useMemo(()=>Object.keys(cardIndex).map(n=>parseInt(n)), [cardIndex]);\n  const game = useMemo(()=>new CardGame(cardIndex, deck), [cardIndex, deck]);\n  const playerStrat:Strategy<StateFromGame<typeof game>, MoveFromGame<typeof game>> = new RandomStrategy()\n  const greedyStrat:Strategy<StateFromGame<typeof game>, MoveFromGame<typeof game>> = new MCTSStrategy(1,1,(gs)=>game.getHeuristic(gs));\n  const opponentStrat:Strategy<StateFromGame<typeof game>, MoveFromGame<typeof game>> = new MCTSStrategy(45,45,(gs)=>game.getHeuristic(gs), greedyStrat)\n  const [gamestate, setGamestate] = React.useState(game.newGame());\n  const status = useMemo(()=>game.getStatus(gamestate),[game, gamestate])\n\n  const [t, setT] = React.useState(NaN);\n  const [mood, setMood] = React.useState(opponentStrat.mood);\n  const [lastmove, setLastMove] = React.useState<CardGameMove>({type:\"end\"});\n\n  return (\n    <div className=\"App\">\n        {status !== GameStatus.IN_PLAY && <h1>{status}</h1>}\n      <GameBoard\n          gamestate={gamestate}\n          game={game}\n          lastmove={lastmove}\n          onCardClick={(n)=>{\n              if(status !== GameStatus.IN_PLAY)return;\n              const move = getMoveFromCardClick(gamestate,n)\n              const newState = game.applyMove(gamestate, move);\n              setGamestate(newState)\n              setLastMove(move)\n          }}\n      />\n      <button\n          disabled={status!==GameStatus.IN_PLAY || gamestate.activePlayer === 1}\n          onClick={()=>{\n              const t = performance.now()\n              const strat = (gamestate.activePlayer === 1 ? playerStrat : opponentStrat);\n              const move = strat.pickMove(game,gamestate)\n              setT(performance.now() - t)\n              const newState = game.applyMove(gamestate, move);\n              setGamestate(newState)\n              setMood(strat.mood)\n              setLastMove(move)\n          }}\n      >\n          step AI {t ? `(${t.toFixed(2)} ms)` : ''}\n      </button>\n\n      <button\n          disabled={status!==GameStatus.IN_PLAY || gamestate.activePlayer === 2 || !game.getValidMoves(gamestate).find(m=>m.type===\"end\")}\n          onClick={()=>{\n              const move:CardGameMove = {type:\"end\"}\n              const newState = game.applyMove(gamestate, move);\n              setGamestate(newState)\n              setLastMove(move)\n          }}\n      >\n         End Turn\n      </button>\n        <div>\n            {mood}\n        </div>\n    </div>\n  );\n}\n\nexport default App;\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}