(this["webpackJsonpcard-game-ai"]=this["webpackJsonpcard-game-ai"]||[]).push([[0],{120:function(e,t,r){e.exports=function(){return new Worker(r.p+"45d7cd155e67df9ceabd.worker.js")}},121:function(e,t,r){"use strict";r.r(t);var s=r(1),o=r.n(s),i=r(8),a=r.n(i),n=(r(50),r(51),r(2)),l=r.n(n);class c{constructor(e){this.value=void 0,this.value=e}resolveValue(e,t,r){return this.value}}class d{applyEffectNoThrow(e,t,r){try{return this.applyEffect(e,t,r)}catch(s){if(!h.isFizzle(s))throw s;return s.returnState}}}class p{constructor(e,t,r){this.template=void 0,this.regex=void 0,this.slots=void 0,this.factory=void 0,this.template=t;const s=t.toLowerCase().replace(/%\w+\s+/g,"(.*\\s+|)?").replace(/%\w+/g,"(.*|)?");this.regex=new RegExp("^"+s+"$"),this.factory=r,this.slots=[...this.template.matchAll(/%(\w+)/gi)].map((e=>e[1])),p.templates[e].push(this)}static parse(e,t){const r=(t||"").trim(),s=p.templates[e].filter((e=>r.toLowerCase().match(e.regex)));if(0===s.length)throw new Error(`Invalid text for slot ${e}: ${r}`);const o=[],i=s.map((e=>{try{const t=r.toLowerCase().match(e.regex),s=t?t.splice(1):[],o=e.slots.map(((e,t)=>p.parse(e,s[t])));return e.factory(...o)}catch(t){return void o.push(t)}})).filter((e=>e));if(0===i.length){const e=l.a.uniq(o.map((e=>e.message)));throw e.length>1?new Error(e.join("; ")):o[0]}const[a]=i;if(!a)throw Error();return a}static clear(){this.templates={Eff:[],ChoiceAction:[],Player:[],N:[],Cond:[],Ability:[],Demos:[],Position:[]}}}p.templates={Eff:[],Player:[],N:[],Cond:[],ChoiceAction:[],Ability:[],Demos:[],Position:[]};class h extends Error{constructor(e){super("Effect Fizzle!"),this.isFizzle=!0,this.returnState=void 0,this.returnState=e}static isFizzle(e){return e.isFizzle}}class u{constructor(e){this.cardNumber=void 0,this.cardNumber=e}preEffect(e,t){const r=e[t],s=[...r.hand],{isFirstTurn:o}=e;return s.splice(s.indexOf(this.cardNumber),1),{...e,[t]:{...r,popularity:r.popularity-0,hand:s}}}postEffect(e,t){return{...e,cardPlayedThisTurn:!0,endRoundAfterThisTurn:!1,[t]:{...e[t],discardPile:[this.cardNumber,...e[t].discardPile]}}}play(e,t,r){const s=1===e.activePlayer?"playerOne":"playerTwo";try{const t=this.preEffect(e,s),o=this.applyEffect(t,s,r);return this.postEffect(o,s)}catch(o){if(!h.isFizzle(o))throw o;return this.postEffect(o.returnState,s)}}}class y extends u{getName(){return this.name}getText(){return this.text}constructor(e,t,r,s){super(s),this.effect=void 0,this.name=void 0,this.text=void 0,this.effect=e,this.text=t,this.name=r}applyEffect(e,t,r){const s={playerKey:t};return this.effect.applyEffect(e,s,r)}}class f extends u{getName(){return this.name}getText(){return this.text}constructor(e,t,r,s){super(s),this.choiceAction=void 0,this.name=void 0,this.text=void 0,this.choiceAction=e,this.text=t,this.name=r}applyEffect(e,t,r){return{...e,step:"choice",cardBeingPlayed:this.cardNumber}}postEffect(e,t){return e}static is(e){return!!e&&e.hasOwnProperty("choiceAction")}}class m extends u{getName(){return this.name}getText(){return this.text}constructor(e,t,r,s){super(s),this.ability=void 0,this.name=void 0,this.text=void 0,this.ability=e,this.text=t,this.name=r}applyEffect(e){return e}postEffect(e,t){return{...e,cardPlayedThisTurn:!0,endRoundAfterThisTurn:!1,[t]:{...e[t],board:[this.cardNumber,...e[t].board]}}}static isItemCard(e){return e.hasOwnProperty("ability")}}const v=["All demographics shift towards the hearts extreme","All demographics shift towards the diamonds extreme","All demographics shift towards the clubs extreme","All demographics shift towards the spades extreme","You shift towards the hearts extreme. Gain one popularity","You shift towards the spades extreme. Your opponent loses one popularity","You shift towards the diamonds extreme. Draw a card","You shift towards the clubs extreme. Your opponent discards a random card","Gain three popularity","Lose two popularity, your followers shift towards you","gain three popularity, your followers shift away from you"],g=[],w=["Choose a player. That player draws 2 cards and loses 3 popularity","Choose an extreme. All demographics shift towards that extreme","Choose an extreme. Shift towards that extreme","Choose an extreme. Gain one popularity and shift towards that extreme"];var b=r(36),x=r.n(b);r(37);x()();let P;!function(e){e.IN_PLAY="IN_PLAY",e.LOSE="RED_WIN",e.WIN="BLUE_WIN",e.DRAW="DRAW"}(P||(P={}));var E=r(12),j=r.n(E);class O extends d{constructor(e,t,r,s){super(),this.target=void 0,this.from=void 0,this.to=void 0,this.n=void 0,this.target=e,this.from=t,this.to=r,this.n=s}applyEffect(e,t,r){let s=e;for(let o=0;o<this.n;o++)s=this.transfer(s,t,r);return s}transfer(e,t,r){const s=this.target.resolveValue(e,t,r),o=e[s],i=[...o[this.from]],a=[...o[this.to]];if(0===i.length||"hand"===this.to&&a.length>Q.MAX_HAND_SIZE)throw new h(e);const n=Math.floor(Math.random()*i.length);return a.push(...i.splice(n,1)),{...e,[s]:{...o,[this.to]:a,[this.from]:i}}}}class T extends O{constructor(e,t){super(e,"deck","hand",t)}transfer(e,t,r){const s=super.transfer(e,t,r),o=this.target.resolveValue(e,t,r);return r.processEvent(s,"player_draws",{player:o,cardNumbers:l.a.xor(s[o].hand,e[o].hand),from:"deck"})}}class C extends d{constructor(e,t){super(),this.a=void 0,this.b=void 0,this.a=e,this.b=t}applyEffect(e,t,r){const s=this.a.applyEffect(e,t,r);return this.b.applyEffect(s,t,r)}}class A extends d{constructor(e,t,r){super(),this.target=void 0,this.amount=void 0,this.field=void 0,this.target=e,this.amount=t,this.field=r}applyEffect(e,t,r){const{field:s}=this,o=this.target.resolveValue(e,t,r);return{...e,[o]:{...e[o],[s]:e[o][s]+this.amount}}}}class N extends d{constructor(e,t){super(),this.eff=void 0,this.condition=void 0,this.eff=e,this.condition=t}applyEffect(e,t,r){return this.condition.resolveValue(e,t,r)?this.eff.applyEffect(e,t,r):e}}class k{constructor(e,t,r){this.target=void 0,this.n=void 0,this.mapping=void 0,this.target=e,this.n=t,this.mapping=r}resolveValue(e,t,r){const s=e[this.target.resolveValue(e,t,r)];return this.mapping(s)<this.n}}class S{constructor(e,t){this.abilityType="onEventAbility",this.eventType=void 0,this.eff=void 0,this.eventType=e,this.eff=t}trigger(e,t,r,s){const o={...r,...(null===t||void 0===t?void 0:t.player)&&{lastPlayer:t.player},eventType:this.eventType,eventParams:t};return this.eff.applyEffect(e,o,s)}static isOnEventAbility(e,t){return"onEventAbility"===e.abilityType&&e.eventType===t}}class M extends S{constructor(e,t,r){super(e,t),this.filter=void 0,this.filter=r}trigger(e,t,r,s){return this.filter.resolveValue(e,r,s)!=t.player?e:super.trigger(e,t,r,s)}}var I=r(38),V=r.n(I);class z{constructor(e){this.eff=void 0,this.eff=e}applyEffect(e,t,r,s){return this.eff.applyEffect(t,{...r,lastPlayer:1===e.choice?"playerOne":"playerTwo"},s)}getChoices(e,t,r){return[{type:"choice",choice:1},{type:"choice",choice:2}]}}class B extends d{constructor(e){super(),this.target=void 0,this.target=e}applyEffect(e,t,r){const s=this.target.resolveValue(e,t,r);return{...e,[s]:{...e[s],position:this.shift(e[s].position,e,t,r)}}}}class Y extends B{constructor(e,t,r){super(e),this.point=void 0,this.stepSize=void 0,this.point=t,this.stepSize=r}static shiftTowardsPoint(e,t,r,s,o,i){const a=e.resolveValue(s,o,i),n=a.x-r.x,l=a.y-r.y,c=Math.sqrt(n*n+l*l),d=t>0?Math.min(c,t):t,p=e=>Math.max(-1,Math.min(1,e));return{x:p(r.x+n/c*d),y:p(r.y+l/c*d)}}shift(e,t,r,s){return Y.shiftTowardsPoint(this.point,this.stepSize,e,t,r,s)}}class R extends d{constructor(e){super(),this.demos=void 0,this.demos=e}applyEffect(e,t,r){const s=this.demos.resolveValue(e,t,r);return{...e,demographics:e.demographics.map(((o,i)=>s.includes(i)?this.shift(o,e,t,r):o))}}}class D extends R{constructor(e,t,r){super(e),this.point=void 0,this.stepSize=void 0,this.point=t,this.stepSize=r}shift(e,t,r,s){return Y.shiftTowardsPoint(this.point,this.stepSize,e,t,r,s)}}class L{resolveValue(e,t){return e.demographics.map(((e,t)=>t))}}class _{constructor(e){this.playerTarget=void 0,this.playerTarget=e}resolveValue(e,t,r){const s="playerOne"===this.playerTarget.resolveValue(e,t,r)?1:2;return e.demographics.map(((e,t)=>({demo:e,i:t}))).filter((({demo:t})=>r.getDemographicVote(e,t)===s)).map((({i:e})=>e))}}class W{constructor(e){this.playerTarget=void 0,this.playerTarget=e}resolveValue(e,t,r){return e[this.playerTarget.resolveValue(e,t,r)].position}}const X={hearts:{x:1,y:-1},clubs:{x:-1,y:-1},diamonds:{x:1,y:1},spades:{x:-1,y:1}};const F={1:X.hearts,2:X.clubs,3:X.diamonds,4:X.spades},H={hearts:1,clubs:2,diamonds:3,spades:4};class K{constructor(e){this.eff=void 0,this.eff=e}applyEffect(e,t,r,s){return this.eff.applyEffect(t,{...r,lastExtreme:F[e.choice]},s)}getChoices(e,t,r){return[{type:"choice",choice:1},{type:"choice",choice:2},{type:"choice",choice:3},{type:"choice",choice:4}]}}class ${resolveValue(e,t){if(!t.lastExtreme)throw new h(e);return t.lastExtreme}}function G(e){return e.hasOwnProperty("target")}const U={resolveValue:(e,t)=>(t.lastPlayer=t.playerKey,t.playerKey)},q={resolveValue(e,t){const r="playerOne"===t.playerKey?"playerTwo":"playerOne";return t.lastPlayer=r,r}},J={resolveValue:(e,t)=>t.lastPlayer||t.playerKey};var Z=function(){new p("N","a",(()=>1));for(let e=0;e<25;e++)new p("N",V.a.toWords(e),(()=>e)),new p("N",`${e}`,(()=>e));new p("Player","yourself",(()=>U)),new p("Player","you",(()=>U)),new p("Player","your",(()=>U)),new p("Player","your opponent",(()=>q)),new p("Player","your opponent'?s",(()=>q)),new p("Player","the other player",(()=>q)),new p("Player","they",(()=>J)),new p("Player","them",(()=>J)),new p("Player","their",(()=>J)),new p("Player","that player",(()=>J)),new p("Player","",(()=>J)),new p("Eff","%Eff and %Eff",((e,t)=>new C(e,t))),new p("Eff","%Eff, and %Eff",((e,t)=>new C(e,t))),new p("Eff","%Eff, %Eff",((e,t)=>new C(e,t))),new p("Eff","%Eff\\. %Eff",((e,t)=>new C(e,t))),new p("Eff","%Eff then %Eff",((e,t)=>new C(e,t))),new p("Eff","%Eff, then %Eff",((e,t)=>new C(e,t))),new p("Eff","%Player draws? %N cards?",((e,t)=>new T(e,t))),new p("Eff","%Player draws? up to %N cards?",((e,t)=>new T(e,t))),new p("Eff","%Player discards? %N random cards?",((e,t)=>new O(e,"hand","discardPile",t))),new p("Eff","%Player discards? the top card (?:from|of) (?:their|your) deck",(e=>new O(e,"deck","discardPile",1))),new p("Eff","%Player discards? %N cards? from the top of (?:their|your) deck",((e,t)=>new O(e,"deck","discardPile",t))),new p("Eff","%Player draws? %N random cards? from (?:their|your) discard pile",((e,t)=>new O(e,"discardPile","hand",t))),new p("Eff","%Player loses? %N popularity",((e,t)=>new A(e,-t,"popularity"))),new p("Eff","%Player gains? %N popularity",((e,t)=>new A(e,t,"popularity"))),function(){const e=(e,t)=>(G(e)&&G(t)&&t.target===J&&(t.target=e.target,e.target=J),new N(e,t));new p("Eff","%Eff, if %Cond",e),new p("Eff","%Eff if %Cond",e),new p("Eff","If %Cond, %Eff",((e,t)=>new N(t,e)))}(),new p("Cond","%Player\\s?(?:has|have) less than %N cards in (?:their|your) hand",((e,t)=>new k(e,t,(e=>e.hand.length)))),new p("Cond","%Player\\s?(?:has|have) less than %N popularity",((e,t)=>new k(e,t,(e=>e.popularity)))),[{eventType:"player_draws",text:"draws? a card"},{eventType:"player_take_damage",text:"takes damage"}].forEach((({eventType:e,text:t})=>{new p("Ability",`When(?:ever) %Player ${t}, %Eff`,((t,r)=>new M(e,r,t))),new p("Ability",`When(?:ever) a player ${t}, %Eff`,(t=>new S(e,t)))})),new p("Ability","At the start of each turn, %Eff",(e=>new S("turn_start",e))),new p("Ability","At the start of your turn, %Eff",(e=>new M("turn_start",e,U))),new p("Demos","All demographics",(()=>new L)),new p("Demos","%Player followers",(e=>new _(e))),Object.entries(X).forEach((([e,t])=>{new p("Position",`the ${e} extreme`,(()=>new c(t)))})),new p("Position","the cente?re?",(()=>new c({x:0,y:0}))),new p("Position","%Player",(e=>new W(e))),new p("Eff","%Demos shift towards %Position",((e,t)=>new D(e,t,1/21))),new p("Eff","%Demos shift away from %Position",((e,t)=>new D(e,t,-1/21))),new p("ChoiceAction","Choose a player. %Eff",(e=>new z(e))),new p("Eff","%Player shift towards %Position",((e,t)=>new Y(e,t,2/21))),new p("Eff","%Player shift away from %Position",((e,t)=>new Y(e,t,-2/21))),new p("ChoiceAction","Choose an extreme. %Eff",(e=>new K(e))),new p("Position","that extreme",(e=>new $))};class Q extends class{applyMoveChain(e,t){return Array.isArray(t)?t.reduce(((e,t)=>this.applyMove(e,t)),e):this.applyMove(e,t)}}{constructor(e,t,r){super(),this.cardIndex=void 0,this.deckOne=void 0,this.deckTwo=void 0,this.cardIndex=e,this.deckOne=t||Object.keys(this.cardIndex).map((e=>parseInt(e))),this.deckTwo=r||this.deckOne}applyMove(e,t){if("end"===t.type)return this.onTurnEnd(e);if("play"===t.type)return this.applyCardPlay(e,t.cardNumber);if("discard"===t.type)return this.applyCardDiscard(e,t.cardNumber);if("choice"===t.type)return this.applyChoiceMove(e,t);throw new Error("Unknown move")}getSensibleMoves(e){if(1===e.roundsUntilElection&&e.endRoundAfterThisTurn){const t=this.getVotes(e);if(t[e.activePlayer]>t[3-e.activePlayer])return[{type:"end"}]}return e.cardPlayedThisTurn?[{type:"end"}]:this.getCardMoves(e).filter((t=>{const r=Array.isArray(t)?t[0].cardNumber:t.cardNumber;if(!this.cardIndex[r])throw new Error("Can't find card "+r);const{effect:s}=this.cardIndex[r];if("ConditionalEffect"!==(null===s||void 0===s?void 0:s.constructor.name))return!0;const{condition:o}=s,i=1===e.activePlayer?"playerOne":"playerTwo";return o.resolveValue(e,{playerKey:i},this)}))}getDemographicVote(e,t){const r=e.playerOne.popularity,s=e.playerTwo.popularity,o=Math.pow(e.playerOne.position.x-t.x,2)+Math.pow(e.playerOne.position.y-t.y,2),i=s/100-(Math.pow(e.playerTwo.position.x-t.x,2)+Math.pow(e.playerTwo.position.y-t.y,2)),a=r/100-o;return a>i&&a>0?1:i>a&&i>0?2:void 0}getVotes(e){const t=l.a.chain(e.demographics).map((t=>this.getDemographicVote(e,t))).filter(l.a.identity).countBy().value();return{1:t[1]||0,2:t[2]||0}}getStatus(e){if(e.roundsUntilElection>0)return P.IN_PLAY;const t=this.getVotes(e);return t[1]>t[2]?P.WIN:t[1]<t[2]?P.LOSE:P.DRAW}getValidMoves(e){if(void 0!==e.cardBeingPlayed){const t=1===e.activePlayer?"playerOne":"playerTwo",r=this.cardIndex[e.cardBeingPlayed];if(!f.is(r))throw new Error("Not a choice card!");return r.choiceAction.getChoices(e,{playerKey:t},this)}return"draw"===e.step?this.getDiscardMoves(e):[{type:"end"},...this.getCardMoves(e)]}newGame(){const e={hand:[],discardPile:[],board:[]},t={activePlayer:1,roundsUntilElection:4,demographics:new Array(50).fill(0).map((()=>({x:Math.random()+Math.random()-1,y:Math.random()+Math.random()-1}))),endRoundAfterThisTurn:!1,cardPlayedThisTurn:!1,step:"play",isFirstTurn:!0,playerOne:{...e,deck:this.deckOne,popularity:10,position:{x:.2,y:0}},playerTwo:{deck:this.deckTwo,position:{x:-.2,y:0},popularity:10,...e}},r=new T(U,1),s=new T(U,Q.MAX_HAND_SIZE),o=r.applyEffect(t,{playerKey:"playerOne"},this);return s.applyEffect(o,{playerKey:"playerTwo"},this)}print({playerOne:e,playerTwo:t,...r}){console.log(j.a.white(JSON.stringify(r,null,4))),console.log(j.a.blue(JSON.stringify(e,null,4))),console.log(j.a.red(JSON.stringify(t,null,4)))}randomizeHiddenInfo(e){const t=1===e.activePlayer?"playerTwo":"playerOne",r=[...e[t].deck,...e[t].hand],s=[];for(let o=0;o<e[t].hand.length;o++){const e=Math.floor(Math.random()*r.length);s.push(...r.splice(e,1))}return{...e,[t]:{...e[t],hand:s,deck:r}}}getCardMoves(e){if("play"!=e.step)return[];const t=1===e.activePlayer?"playerOne":"playerTwo",r=e[t];return l.a.flatMap(r.hand,(r=>{const s={type:"play",cardNumber:r},o=this.cardIndex[r];if(f.is(o)){return o.choiceAction.getChoices(e,{playerKey:t},this).map((e=>[s,e]))}return[s]}))}getDiscardMoves(e){if("draw"!=e.step)return[];return(1===e.activePlayer?e.playerOne:e.playerTwo).hand.map((e=>({type:"discard",cardNumber:e})))}onTurnEnd(e){const t=1===e.activePlayer?2:1,r=1===t?"playerOne":"playerTwo",s=e.endRoundAfterThisTurn,o={...s?this.onRoundEnd(e):e,step:"play",cardPlayedThisTurn:!1,isFirstTurn:!1,endRoundAfterThisTurn:!e.cardPlayedThisTurn&&!s,activePlayer:t};return this.processEvent(o,"turn_start",{player:r})}applyCardPlay(e,t){return this.cardIndex[t].play(e,t,this)}applyCardDiscard(e,t){const r=1===e.activePlayer?"playerOne":"playerTwo",s=e[r],o=[...s.hand],i=[...s.discardPile];return i.push(...o.splice(o.indexOf(t),1)),{...e,step:o.length>Q.MAX_HAND_SIZE?"draw":"play",[r]:{...s,hand:o,discardPile:i}}}getHeuristic(e){const t=this.getVotes(e),r=t[1],s=t[2];return r===s?0:(r-s)/(s+r)}processEvent(e,t,r){if(this.getStatus(e)!=P.IN_PLAY)return e;let s=e;return["playerOne","playerTwo"].forEach((o=>{e[o].board.map((e=>this.cardIndex[e])).filter((e=>m.isItemCard(e))).map((e=>e.ability)).filter((e=>S.isOnEventAbility(e,t))).forEach((e=>{try{s=e.trigger(s,r,{playerKey:o},this)}catch(t){if(!h.isFizzle(t))throw t;s=t.returnState}}))})),s}applyChoiceMove(e,t){const r=1===e.activePlayer?"playerOne":"playerTwo",s=this.cardIndex[e.cardBeingPlayed];if(!f.is(s))throw new Error(`${e.cardBeingPlayed} Not a choice card!`);return{...(()=>{try{return s.choiceAction.applyEffect(t,e,{playerKey:r},this)}catch(o){if(!h.isFizzle(o))throw o;return o.returnState}})(),step:"play",cardBeingPlayed:void 0}}onRoundEnd(e){const t=e=>({...e,hand:[]}),r={...e,endRoundIfNoCardPlayedThisTurn:!1,roundsUntilElection:e.roundsUntilElection-1,playerOne:t(e.playerOne),playerTwo:t(e.playerTwo)},s=new T(U,6);return s.applyEffectNoThrow(s.applyEffectNoThrow(r,{playerKey:"playerTwo"},this),{playerKey:"playerOne"},this)}getActiveActionChoice(e){if(void 0===e.cardBeingPlayed)return;const t=this.cardIndex[e.cardBeingPlayed];if(!f.is(t))throw new Error("Not a choice card!");return t.choiceAction}}Q.MAX_HAND_SIZE=6;var ee=r(0);const te={boxSizing:"border-box",position:"absolute",background:"orange",width:14,zIndex:1,left:10,top:90,marginBottom:100,transformOrigin:"top",display:"flex",flexDirection:"column-reverse",alignItems:"center",cursor:"none",pointerEvents:"none"},re={position:"relative",top:10,borderLeft:"20px solid transparent",borderRight:"20px solid transparent",borderTop:"20px solid orange",cursor:"none",pointerEvents:"none"};var se=()=>{const[e,t]=o.a.useState(100),[r,i]=o.a.useState(45),a=o.a.useRef(null),n={height:e,transform:`rotate(${r}rad)`};return Object(s.useEffect)((()=>{const e=e=>{if(!a.current)return;const r=a.current.getBoundingClientRect(),s=e.clientX-r.x-20,o=e.clientY-r.y- -45,n=Math.atan2(-s,o),l=Math.sqrt(s*s+o*o);i(n),t(l)};return window.addEventListener("mousemove",e),()=>window.removeEventListener("mousemove",e)}),[a]),Object(ee.jsx)("div",{ref:a,children:Object(ee.jsx)("div",{style:{...te,...n},children:Object(ee.jsx)("div",{style:re})})})};const oe={backgroundColor:"white",borderWidth:"1px",borderColor:"black",borderStyle:"solid",fontSize:11,borderRadius:3,width:80,height:120,marginLeft:5,marginTop:5,marginRight:5,marginBottom:5,top:0,display:"inline-block",transition:"transform 0.3s, margin 0.35s ease-in 0.3s, top 0.4s ease-in-out 0.5s",cursor:"not-allowed",overflow:"hidden",zIndex:0},ie={fontWeight:"bold",fontSize:16},ae={...oe,color:"blue",borderColor:"black",transform:"scale(1.3)",marginLeft:-40,marginRight:-40,zIndex:1},ne={...oe,borderColor:"red",borderWidth:3,cursor:"pointer"},le={...oe,borderColor:"blue",borderWidth:3,cursor:"pointer"},ce={top:160},de={top:-160},pe={backgroundColor:"darkgray",color:"darkgray",transform:"rotate3d(0,1,0,0.5turn)"},he={transform:"scale(0)"},ue={position:"relative",transition:"transform 0.3s, margin 0.35s ease-in 0.3s, top 0.4s ease-in-out 0.5s",display:"inline-block",top:0,zIndex:1};var ye=e=>{const[t,r]=o.a.useState(e.onBoard&&!e.beingPlayed);o.a.useEffect((()=>{if(e.onBoard&&e.beingPlayed){const e=setTimeout((()=>{r(!0)}),800);return()=>window.clearTimeout(e)}if(e.onBoard&&!e.beingPlayed){const e=setTimeout((()=>{r(!1)}),800);return()=>window.clearTimeout(e)}}));const{card:s,beingPlayed:i}=e,a=e.canBeDiscarded?ne:e.canBePlayed?le:t?he:{},n=e.beingPlayed&&e.isOpponent?ce:e.beingPlayed&&!e.isOpponent?de:{},l=e.isHidden?pe:{},c=e.canBeDiscarded||e.canBePlayed?e.onClick:()=>{};return Object(ee.jsxs)("div",{style:{...ue,...n},children:[Object(ee.jsxs)("div",{style:{...i?ae:oe,...a,...l},onClick:c,children:[Object(ee.jsx)("div",{style:ie,children:s.getName()}),Object(ee.jsx)("div",{children:s.getText()})]}),e.beingPlayed&&f.is(s)&&!e.isOpponent&&Object(ee.jsx)(se,{})]})},fe=(r(22),r.p+"static/media/bg.e49eda7f.png"),me=r(9),ve=r(39);var ge=function({component:e,propList:t,...r}){const[o,i]=Object(s.useState)(r);return Object(s.useEffect)((()=>{setTimeout((()=>{const e={};let s=!1;for(let i of t){const t=o[i],a=r[i]-t;Math.abs(a)>.005&&(s=!0);const n=t+a/5;e[i]=n}s&&i(e)}),100)}),[r,o]),e({...r,...o})};const we={height:500,width:500,border:"1px solid black",position:"relative",margin:10,overflow:"hidden"},be={width:30,height:30,borderRadius:"100%",border:"1px solid black",position:"absolute",top:-15,left:-15,transition:"background 0.3s, transform 0.3s"},xe={width:10,height:10,borderRadius:"20%",border:"1px solid black",position:"absolute",top:-5,left:-5,transition:"background 0.3s, transform 0.3s",pointerEvents:"none"},Pe={border:"1px solid black",height:25,overflow:"hidden",color:"white"};function Ee({x:e,y:t}){return`translate(${250*(e+1)}px,${250*(t+1)}px)`}const je=me.Shaders.create({helloBlue:{frag:me.GLSL`
precision highp float;
varying vec2 uv;
uniform float bluePop;
uniform float blueX;
uniform float blueY;
uniform float redPop;
uniform float redX;
uniform float redY;
float distSquared( vec2 A, vec2 B )
{
    vec2 C = A - B;
    return dot( C, C );
}

void main() {
  vec2 bluePos = vec2(blueX, 1.0-blueY);
  vec2 redPos = vec2(redX, 1.0-redY);
  float blueScore = bluePop/400.0 - distSquared(bluePos, uv);
  float redScore = redPop/400.0 - distSquared(redPos, uv);
  float blueWins = blueScore > 0.0 && blueScore > redScore ? 1.0 : 0.0;
  float redWins = redScore > 0.0 && blueScore < redScore ? 1.0 : 0.0;
  float noWins = (1.0-redWins)*(1.0-blueWins);
  
  vec3 redColor = vec3(0.8,0.1,0.1);
  vec3 blueColor = vec3(0.15,0.15,0.8);
  vec3 grayColor = vec3(.7,0.7,0.7);
  
  vec3 col = redColor * redWins + blueColor * blueWins + grayColor * noWins;
  
  gl_FragColor = vec4(col, 1.0);
}`}}),Oe=e=>{const{blueX:t,redPop:r,redX:s,bluePop:o,blueY:i,redY:a}=e;return Object(ee.jsxs)(ee.Fragment,{children:[Object(ee.jsx)("img",{src:fe,style:{position:"absolute"}}),Object(ee.jsx)(ve.Surface,{width:500,height:500,style:{mixBlendMode:"multiply"},children:Object(ee.jsx)(me.Node,{shader:je.helloBlue,uniforms:{blueX:t/2+.5,blueY:i/2+.5,bluePop:o,redX:s/2+.5,redY:a/2+.5,redPop:r}})})]})};class Te extends o.a.Component{render(){return Object(ee.jsx)(ge,{component:Oe,propList:["blueX","blueY","bluePop","redX","redY","redPop"],blueX:this.props.blueX,blueY:this.props.blueY,bluePop:this.props.bluePop,redX:this.props.redX,redY:this.props.redY,redPop:this.props.redPop})}}const Ce=({redVotes:e,blueVotes:t})=>Object(ee.jsxs)("div",{style:{display:"flex",width:200},children:[Object(ee.jsx)("div",{style:{flexGrow:t,background:"blue",...Pe},children:Math.round(t)}),Object(ee.jsx)("div",{style:{flexGrow:e,background:"red",...Pe},children:Math.round(e)})]});var Ae=e=>{var t,r;const{gamestate:{playerOne:s,playerTwo:o},onChoiceClick:i,game:a}=e,n=e.game.getVotes(e.gamestate),l=(null===(t=a.getActiveActionChoice(e.gamestate))||void 0===t?void 0:t.constructor)===z,c=(null===(r=a.getActiveActionChoice(e.gamestate))||void 0===r?void 0:r.constructor)===K;return Object(ee.jsxs)("div",{style:{display:"flex",justifyContent:"space-evenly"},children:[Object(ee.jsxs)("div",{style:we,children:[Object(ee.jsx)(Te,{bluePop:s.popularity,blueX:s.position.x,blueY:s.position.y,redPop:o.popularity,redX:o.position.x,redY:o.position.y}),Object(ee.jsx)("div",{className:l?"glow":"",style:{...be,background:"blue",transform:Ee(e.gamestate.playerOne.position)},onClick:()=>l&&i({type:"choice",choice:1})}),Object(ee.jsx)("div",{className:l?"glow":"",style:{...be,background:"red",transform:Ee(e.gamestate.playerTwo.position)},onClick:()=>l&&i({type:"choice",choice:2})}),e.gamestate.demographics.map((({x:t,y:r},s)=>{const o=e.game.getDemographicVote(e.gamestate,{x:t,y:r}),i=1===o?"blue":2===o?"red":"gray",a={transform:Ee({x:t,y:r}),background:i};return Object(ee.jsx)("div",{style:{...xe,...a}},s)})),c&&Object.entries(X).map((([e,t])=>Object(ee.jsx)("div",{className:"glow",onClick:()=>i({type:"choice",choice:H[e]}),style:{position:"absolute",backgroundColor:"rgba(255, 128, 0, 0.5)",top:-75,left:-75,width:150,height:150,borderRadius:500,transform:Ee(t)}})))]}),Object(ee.jsxs)("div",{style:{textAlign:"center"},children:["Election in",Object(ee.jsx)("div",{style:{fontSize:"150%",fontWeight:"bold"},children:e.gamestate.roundsUntilElection}),"Rounds",Object(ee.jsx)("div",{children:e.gamestate.cardPlayedThisTurn?"Card has been Played this turn":"-"}),Object(ee.jsx)("div",{children:e.gamestate.endRoundAfterThisTurn?"Round will end if turn ended now":"-"}),Object(ee.jsx)(ge,{component:Ce,propList:["blueVotes","redVotes"],blueVotes:n[1]||0,redVotes:n[2]||0})]})]})},Ne=r(18),ke=r(43);const Se={border:"1px solid black",fontSize:10,borderRadius:3,width:40,height:60,margin:5,display:"inline-block"},Me={maxHeight:200,fontSize:10,textAlign:"left",width:150,overflowY:"auto"};var Ie=e=>{const{label:t,cards:r}=e,{getArrowProps:s,getTooltipProps:o,setTooltipRef:i,setTriggerRef:a,visible:n}=Object(ke.a)({interactive:!0,delayHide:100});return Object(ee.jsxs)(ee.Fragment,{children:[Object(ee.jsxs)("div",{style:Se,ref:a,children:[t,Object(ee.jsx)("div",{children:r.length})]}),n&&Object(ee.jsxs)("div",{ref:i,...o({className:"tooltip-container"}),children:[0===r.length&&Object(ee.jsx)("i",{children:"Empty"}),Object(ee.jsx)("ul",{style:Me,children:r.map(((e,t)=>Object(ee.jsxs)("li",{children:[Object(ee.jsx)("b",{children:"string"===typeof e?e:e.getName()})," ","string"!==typeof e&&e.getText()]},t)))}),Object(ee.jsx)("div",{...s({className:"tooltip-arrow"})})]})]})};const Ve={display:"flex",alignItems:"center",placeContent:"center"},ze={...Ve,background:"gold"},Be={display:"inline-flex",minWidth:400,justifyContent:"center"},Ye={fontSize:60,position:"relative"},Re={position:"absolute",bottom:25,left:18,width:20,fontSize:16,color:"white",textAlign:"center"},De=({onCardClick:e,game:t,player:r,isActive:s,isHidden:o,lastmove:i,gamestate:a})=>{const n=i&&"play"===i.type?[i.cardNumber]:[],l=[...r.hand,...n].sort(((e,t)=>e-t));Ne.a,r.board.map((e=>Object(ee.jsx)("div",{children:Object(ee.jsx)(ye,{onClick:()=>{},isOpponent:o,isHidden:!1,card:t.cardIndex[e],canBePlayed:!1,canBeDiscarded:!1,beingPlayed:!1,onBoard:!0})},e+" "+t.cardIndex[e].getName())));return Object(ee.jsxs)("div",{style:s?ze:Ve,children:[Object(ee.jsxs)("div",{style:Ye,children:["\u2764",Object(ee.jsx)("div",{style:Re,children:r.popularity})]}),Object(ee.jsx)(Ne.a,{style:{...Be},children:l.map((i=>Object(ee.jsx)("div",{style:{position:"relative"},children:Object(ee.jsx)(ye,{onClick:()=>e(i),isOpponent:o,isHidden:o&&!n.includes(i),card:t.cardIndex[i],canBePlayed:s&&!o&&"play"===a.step&&!n.includes(i),canBeDiscarded:s&&!o&&"draw"===a.step&&!n.includes(i),beingPlayed:n.includes(i),onBoard:r.board.includes(i)})},i+" "+t.cardIndex[i].getName())))}),Object(ee.jsx)(Ie,{label:"deck",cards:r.deck.map((e=>o?"?":t.cardIndex[e]))}),Object(ee.jsx)(Ie,{label:"discard",cards:r.discardPile.map((e=>t.cardIndex[e]))})]})};var Le=e=>{const{gamestate:t,game:r,lastmove:s,onCardClick:o,onChoiceClick:i}=e;return Object(ee.jsxs)(ee.Fragment,{children:[Object(ee.jsxs)("div",{children:["Step: ",t.step]}),Object(ee.jsx)(De,{onCardClick:()=>{},game:r,gamestate:t,player:t.playerTwo,lastmove:2===t.activePlayer?s:void 0,isActive:2===t.activePlayer,isHidden:!0}),Object(ee.jsx)(Ae,{gamestate:t,game:r,onChoiceClick:i}),Object(ee.jsx)(De,{onCardClick:o,game:r,gamestate:t,player:t.playerOne,lastmove:1===t.activePlayer?s:void 0,isActive:1===t.activePlayer,isHidden:!1})]})},_e=r(41),We=r.n(_e).a,Xe=r(42),Fe=r.n(Xe);const He=new We;var Ke=function(){Z();const e=Object(s.useMemo)((()=>function(){if(Object.values(p.templates).some((e=>0===e.length)))throw new Error("Text Templates not setup");return[...[...v,...v].map(((e,t)=>{const r=p.parse("Eff",e);return new y(r,e,`Card ${t}`,t)})),...g.map(((e,t)=>{const r=p.parse("Ability",e),s=2*v.length+t;return new m(r,e,`Card ${s}`,s)})),...w.map(((e,t)=>{const r=2*v.length+g.length+t,s=p.parse("ChoiceAction",e);return new f(s,e,`Card ${r}`,r)}))]}()),[]),t=Object(s.useMemo)((()=>new Q(e)),[e]),[r,i]=o.a.useState({state:t.newGame()}),a=Object(s.useMemo)((()=>t.getStatus(r.state)),[t,r.state]),[n,l]=o.a.useState("..."),[c,d]=o.a.useState(!1);o.a.useEffect((()=>{let e=0;return e=window.setTimeout((async()=>{if(2===r.state.activePlayer&&!c&&t.getStatus(r.state)===P.IN_PLAY){var e;d(!0);const s="end"===(null===(e=r.lastMove)||void 0===e?void 0:e.type)?400:1e3,[{mood:o,move:a}]=await Promise.all([He.processData(r.state),Fe()(s)]),n=t.applyMoveChain(r.state,a);l(o),d(!1),i({state:n,lastMove:Array.isArray(a)?a[0]:a})}}),0),()=>window.clearTimeout(e)}),[r,t,c]);const h=(Array.isArray(r.lastMove)?r.lastMove[0]:r.lastMove)||{type:"end"},u=t.getValidMoves(r.state).find((e=>!Array.isArray(e)&&"end"===e.type));return Object(ee.jsxs)("div",{className:"App",children:[a!==P.IN_PLAY&&Object(ee.jsx)("h1",{children:a}),Object(ee.jsx)(Le,{gamestate:r.state,game:t,lastmove:h,onCardClick:e=>{if(a!==P.IN_PLAY)return;const s=(o=r.state,n=e,"draw"==o.step?{type:"discard",cardNumber:n}:{type:"play",cardNumber:n});var o,n;const l=t.applyMove(r.state,s);i({state:l,lastMove:s})},onChoiceClick:e=>{if(a!==P.IN_PLAY)return;const s=t.applyMove(r.state,e);i({state:s,lastMove:e})}}),Object(ee.jsx)("button",{disabled:a!==P.IN_PLAY||2===r.state.activePlayer||!u,onClick:()=>{const e={type:"end"},s=t.applyMove(r.state,e);i({state:s,lastMove:e})},children:r.state.endRoundAfterThisTurn?"End Round":"End Turn"}),Object(ee.jsx)("div",{children:n}),c&&"loading"]})};var $e=e=>{e&&e instanceof Function&&r.e(3).then(r.bind(null,126)).then((({getCLS:t,getFID:r,getFCP:s,getLCP:o,getTTFB:i})=>{t(e),r(e),s(e),o(e),i(e)}))};a.a.render(Object(ee.jsx)(o.a.StrictMode,{children:Object(ee.jsx)(Ke,{})}),document.getElementById("root")),$e()},41:function(e,t,r){var s,o=r(119).wrap,i=r(120);e.exports=function e(){return this instanceof e?o(i()):s||(s=o(i()))}},50:function(e,t,r){},51:function(e,t,r){}},[[121,1,2]]]);
//# sourceMappingURL=main.0144c763.chunk.js.map